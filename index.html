vu dans <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Intelligence - OSINT Professionnelle</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0a0a0a; /* Very dark black */
            --secondary-color: #1a1a1a; /* Dark grey */
            --accent-color: #8a2be2; /* Blue-violet */
            --danger-color: #cc0000; /* Darker red */
            --success-color: #008000; /* Darker green */
            --warning-color: #ff8c00; /* Dark orange */
            --text-primary: #f8fafc; /* White */
            --text-secondary: #cbd5e1; /* Light grey */
            --purple: #9370db; /* Medium purple */
            --cyan: #4b0082; /* Indigo */
            --pink: #800080; /* Purple */
            --orange: #483d8b; /* Dark slate blue */
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .modal.hidden {
            display: none;
            opacity: 0;
        }

        /* Styles des boutons */
        .btn-primary, .btn-secondary, .btn-auth-login, .btn-auth-register {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            transform: translateY(0);
        }

        .btn-primary:hover, .btn-secondary:hover, .btn-auth-login:hover, .btn-auth-register:hover {
            transform: translateY(-2px);
        }

        .btn-primary:active, .btn-secondary:active, .btn-auth-login:active, .btn-auth-register:active {
            transform: translateY(1px);
        }

        /* Effet de ripple pour les boutons */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Style pour boutons désactivés */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Effet de focus visible */
        button:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* Custom Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-color); /* Dark grey track */
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color); /* Accent color thumb */
            border-radius: 10px;
            border: 3px solid var(--secondary-color); /* Padding around thumb */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--purple); /* Lighter accent on hover */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .cyber-font {
            font-family: 'Orbitron', monospace;
        }

        .glass-effect {
            background: rgba(26, 26, 26, 0.7); /* Darker, more subtle */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3); /* Accent color border */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .glass-card {
            background: rgba(26, 26, 26, 0.8); /* Darker, more subtle */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(138, 43, 226, 0.4); /* Accent color border */
            border-radius: 15px;
        }

        .cyber-grid {
            background-image: 
                linear-gradient(rgba(138, 43, 226, 0.05) 1px, transparent 1px), /* More subtle grid */
                linear-gradient(90deg, rgba(138, 43, 226, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            animation: grid-move 20s linear infinite;
        }

        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, 20px); }
        }

        .neon-border {
            border: 2px solid transparent;
            background: linear-gradient(var(--secondary-color), var(--secondary-color)) padding-box,
                        linear-gradient(45deg, var(--accent-color), var(--purple)) border-box;
            border-radius: 10px;
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        .typing {
            overflow: hidden;
            border-right: .15em solid var(--accent-color);
            white-space: nowrap;
            margin: 0 auto;
            letter-spacing: .15em;
            animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--accent-color); }
        }

        .hidden {
            display: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .tool-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }

        .tool-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(138, 43, 226, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--secondary-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--purple));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .success { background: var(--success-color); }
        .error { background: var(--danger-color); }
        .warning { background: var(--warning-color); }
        .info { background: var(--accent-color); }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .online { background: var(--success-color); }
        .offline { background: var(--danger-color); }
        .warning-status { background: var(--warning-color); }

        .cyber-text {
            background: linear-gradient(45deg, var(--accent-color), var(--purple), var(--cyan));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .gradient-bg-1 {
            background: linear-gradient(135deg, #8a2be2, #9370db); /* Blue-violet to Medium purple */
        }

        .gradient-bg-2 {
            background: linear-gradient(135deg, #008000, #4b0082); /* Darker green to Indigo */
        }

        .gradient-bg-3 {
            background: linear-gradient(135deg, #ff8c00, #483d8b); /* Dark orange to Dark slate blue */
        }

        .gradient-bg-4 {
            background: linear-gradient(135deg, #800080, #cc0000); /* Purple to Darker red */
        }

        .stats-card {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: scale(1.05);
            border-color: rgba(138, 43, 226, 0.8);
        }

        .sidebar {
            width: 280px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(138, 43, 226, 0.3);
            z-index: 40;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .sidebar.closed {
            transform: translateX(-100%);
        }

        .main-content {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
            padding: 20px;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .form-input {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #8a2be2, #9370db); /* Blue-violet to Medium purple */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(138, 43, 226, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: var(--accent-color);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger-color), #8b0000);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(204, 0, 0, 0.4);
        }

        .activity-item {
            padding: 15px;
            border-left: 3px solid var(--accent-color);
            margin-bottom: 10px;
            background: rgba(26, 26, 26, 0.5);
            border-radius: 0 8px 8px 0;
        }

        .chart-container {
            height: 300px;
            background: rgba(26, 26, 26, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .hero-content {
            position: relative;
            z-index: 10;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(138, 43, 226, 0.15) 0%, transparent 70%);
            z-index: 1;
        }

        .feature-icon {
            transition: all 0.3s ease;
        }

        .feature-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .capability-card {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .capability-card:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: translateY(-5px);
        }

        .nav-enhanced {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-link-enhanced {
            position: relative;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-link-enhanced::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(45deg, var(--accent-color), var(--purple));
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link-enhanced:hover::before,
        .nav-link-enhanced.active::before {
            width: 100%;
        }

        .cyber-decoration {
            position: fixed;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .cyber-decoration-1 {
            top: 10%;
            right: 10%;
            font-size: 120px;
            color: var(--accent-color);
            animation: float 8s ease-in-out infinite;
        }

        .cyber-decoration-2 {
            bottom: 15%;
            left: 5%;
            font-size: 80px;
            color: var(--purple);
            animation: float 6s ease-in-out infinite reverse;
        }

        .cyber-decoration-3 {
            top: 40%;
            left: -5%;
            font-size: 100px;
            color: var(--cyan);
            animation: float 10s ease-in-out infinite;
        }

        .profile-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 10px;
            transform: translateY(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .profile-menu.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .profile-menu-item:hover {
            background: rgba(138, 43, 226, 0.2);
            color: white;
        }

        /* Navbar profile small menu (animated) */
        .nav-profile-menu {
            transform-origin: top center;
            transform: translateY(-8px) scale(.98);
            opacity: 0;
            transition: transform 180ms ease, opacity 180ms ease;
            z-index: 9999;
            will-change: transform, opacity, left, top;
            position: absolute; /* default to absolute so we can set left/top */
        }
        .nav-profile-menu.open {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        @keyframes navOpen {
            from { transform: translateY(-6px) scale(.98); opacity: 0 }
            to { transform: translateY(0) scale(1); opacity: 1 }
        }
        .nav-profile-menu.animate-open {
            animation: navOpen 180ms ease both;
        }
        .nav-profile-item {
            cursor: pointer;
            color: var(--text-secondary);
            transition: background 0.15s ease;
        }
        .nav-profile-item:hover {
            background: rgba(255,255,255,0.03);
            color: var(--text-primary);
        }

        /* Small online status dot next to auth button */
        .auth-online-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
            box-shadow: 0 0 0 4px rgba(34,197,94,0.12);
            vertical-align: middle;
            background: #22c55e; /* green */
        }
        .auth-online-dot.hidden { display: none; }

        #authLogoutBtn {
            background: rgba(220,38,38,0.06);
            border: 1px solid rgba(220,38,38,0.12);
            padding: 6px 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        #authLogoutBtn.hidden { display: none; }

        .dashboard-tab {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .dashboard-tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-card {
            background: rgba(26, 26, 26, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            border-color: rgba(138, 43, 226, 0.8);
            transform: translateX(5px);
        }

        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-founder {
            background: linear-gradient(45deg, var(--danger-color), #8b0000);
            color: white;
        }

        .role-admin {
            background: linear-gradient(45deg, var(--warning-color), #cd6600);
            color: white;
        }

        .role-user {
            background: linear-gradient(45deg, var(--accent-color), #6a0dad);
            color: white;
        }

        .scanner-animation {
            position: relative;
            overflow: hidden;
        }

        .scanner-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(-2px); }
            100% { transform: translateY(200px); }
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
            overflow: hidden;
        }

        .matrix-char {
            position: absolute;
            color: var(--accent-color);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            opacity: 0.7;
            animation: matrix-fall linear infinite;
        }

        @keyframes matrix-fall {
            0% { transform: translateY(-100px); opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        .loading-spinner {
            border: 4px solid rgba(138, 43, 226, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--accent-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .settings-content {
            display: none;
        }

        .settings-content.active {
            display: block;
        }

        /* New Home Page Styles */
        .hero-section-new {
            position: relative;
            overflow: hidden;
            padding: 8rem 0; /* Reduced padding */
        }

        .hero-section-new::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        .hero-content-new {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .feature-grid-new {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px; /* Reduced gap */
            margin-top: 40px; /* Reduced margin */
        }

        .feature-item-new {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 25px; /* Reduced padding */
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-item-new:hover {
            transform: translateY(-15px);
            box-shadow: 0 25px 50px rgba(138, 43, 226, 0.4);
        }

        .testimonial-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .testimonial-card:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: scale(1.02);
        }

        .partner-logo {
            filter: grayscale(100%) brightness(150%);
            opacity: 0.6;
            transition: all 0.3s ease;
        }

        .partner-logo:hover {
            filter: grayscale(0%) brightness(100%);
            opacity: 1;
            transform: scale(1.1);
        }

        .faq-item {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .faq-question {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .faq-question:hover {
            background-color: rgba(138, 43, 226, 0.1);
        }

        .faq-answer {
            padding: 0 20px 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            color: var(--text-secondary);
        }

        .faq-item.active .faq-answer {
            max-height: 200px; /* Adjust as needed */
        }

        .faq-item.active .faq-question .fas {
            transform: rotate(180deg);
        }

        .payment-form-container {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
        }

        .payment-input-group {
            margin-bottom: 20px;
        }

        .payment-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .payment-input-group input {
            background: rgba(10, 10, 10, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            width: 100%;
        }

        .payment-summary {
            background: rgba(10, 10, 10, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .payment-summary div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .payment-summary .total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
            border-top: 1px dashed rgba(138, 43, 226, 0.3);
            padding-top: 15px;
            margin-top: 15px;
        }

        .logo-icon {
            display: inline-block;
            width: 24px; /* Adjust size as needed */
            height: 24px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="%238a2be2" d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5.7-33.4-2.3L392 310.6V192.4L525.7 102.1c10.4-8 23-7.9 33.4 .2z"/></svg>'); /* Example SVG for a shield/data icon */
            background-size: contain;
            background-repeat: no-repeat;
            vertical-align: middle;
            margin-right: 8px;
        }

        /* New Navbar Styles */
        .new-navbar {
            background: rgba(10, 10, 10, 0.98); /* Darker, more opaque */
            backdrop-filter: blur(25px);
            border-bottom: 1px solid rgba(138, 43, 226, 0.4); /* Stronger border */
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4); /* More pronounced shadow */
            padding: 0.5rem 1rem; /* More padding */
            height: 4rem; /* Fixed height */
            display: flex;
            align-items: center;
        }

        .new-navbar .nav-link-enhanced {
            padding: 8px 15px; /* Slightly smaller padding for links */
            font-size: 0.9rem; /* Slightly smaller font */
        }

        .new-navbar .nav-link-enhanced::before {
            height: 3px; /* Thicker underline */
        }

        /* New Payment Page Styles */
        .payment-form-container {
            background: rgba(10, 10, 10, 0.95); /* Darker background */
            border: 1px solid rgba(138, 43, 226, 0.5); /* Stronger border */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); /* More shadow */
            padding: 50px; /* More padding */
            border-radius: 20px; /* More rounded corners */
        }

        .payment-input-group input {
            background: rgba(26, 26, 26, 0.9); /* Lighter input background */
            border: 1px solid rgba(138, 43, 226, 0.4);
            padding: 15px; /* More padding */
            font-size: 1.1rem; /* Larger font */
        }

        .payment-summary {
            background: rgba(26, 26, 26, 0.8); /* Lighter summary background */
            border: 1px solid rgba(138, 43, 226, 0.4);
            padding: 25px;
            border-radius: 15px;
        }

        .payment-summary .total {
            font-size: 1.8rem; /* Larger total font */
        }

        /* New Settings Page Styles */
        .settings-page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            gap: 30px;
        }

        .settings-sidebar {
            flex: 0 0 280px;
            padding-right: 20px;
            border-right: 1px solid rgba(138, 43, 226, 0.2);
        }

        .settings-main-content {
            flex: 1;
        }

        .settings-tab-button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            text-align: left;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .settings-tab-button:hover {
            background: rgba(138, 43, 226, 0.1);
            color: var(--text-primary);
        }

        .settings-tab-button.active {
            background: linear-gradient(45deg, var(--accent-color), var(--purple));
            color: white;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
        }

        .settings-tab-button i {
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .settings-section-card {
            background: rgba(26, 26, 26, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .settings-section-card h4 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--accent-color);
            font-family: 'Orbitron', monospace;
        }

        .settings-section-card .form-input,
        .settings-section-card select {
            background: rgba(10, 10, 10, 0.7);
            border: 1px solid rgba(138, 43, 226, 0.3);
            padding: 12px;
            border-radius: 8px;
            color: white;
        }

        .settings-section-card .btn-primary,
        .settings-section-card .btn-secondary,
        .settings-section-card .btn-danger {
            padding: 12px 25px;
            font-size: 1rem;
        }

        .settings-toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .settings-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .settings-toggle-slider {
            background-color: var(--accent-color);
        }

        input:focus + .settings-toggle-slider {
            box-shadow: 0 0 1px var(--accent-color);
        }

        input:checked + .settings-toggle-slider:before {
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .settings-toggle-slider.round {
            border-radius: 34px;
        }

        .settings-toggle-slider.round:before {
            border-radius: 50%;
        }

        /* Home Page Specific Enhancements */
        .why-choose-us-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px; /* Reduced gap */
            margin-top: 40px; /* Reduced margin */
        }

        .why-choose-us-item {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 25px; /* Reduced padding */
            text-align: center;
            transition: all 0.3s ease;
        }

        .why-choose-us-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(138, 43, 226, 0.3);
        }

        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .value-card {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .value-card:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: scale(1.02);
        }

        /* New Home Page Specific Styles for Professional Look */
        .hero-section-professional {
            position: relative;
            overflow: hidden;
            padding: 10rem 0;
            display: flex;
            flex-direction: column; /* Allow content to stack */
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Ensure it takes full viewport height */
        }

        .hero-video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0; /* Ensure video is behind content but above matrix/grid */
        }

        .hero-video-overlay-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%; /* Make it cover the whole section for a full gradient */
            background: linear-gradient(to top, var(--primary-color) 0%, rgba(0,0,0,0.8) 20%, rgba(0,0,0,0.5) 50%, transparent 100%); /* Stronger gradient */
            z-index: 1;
        }

        .hero-content-professional {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1.5rem;
            flex-grow: 1; /* Allow content to take available space */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hero-content-professional h1 {
            font-size: 4.5rem; /* Larger title */
            line-height: 1.1;
            margin-bottom: 1.5rem;
            font-weight: 900; /* Bolder */
        }

        .hero-content-professional p {
            font-size: 1.4rem; /* Larger paragraph */
            line-height: 1.6;
            margin-bottom: 2.5rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            color: var(--text-secondary);
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .hero-buttons .btn-primary,
        .hero-buttons .btn-secondary {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            border-radius: 0.75rem;
            min-width: 220px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header h2 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .section-header p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
        }

        .feature-grid-professional {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2.5rem;
            margin-top: 3rem;
        }

        .feature-item-professional {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            transition: all 0.4s ease-in-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .feature-item-professional:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 25px 60px rgba(138, 43, 226, 0.5);
            border-color: rgba(138, 43, 226, 0.8);
        }

        .feature-item-professional .icon-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2.5rem;
            color: white;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
        }

        .feature-item-professional h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .feature-item-professional p {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .stats-section {
            padding: 6rem 0;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.05), rgba(75, 0, 130, 0.05));
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2.5rem;
        }

        .stats-card-professional {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 2.5rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .stats-card-professional:hover {
            transform: translateY(-10px);
            border-color: rgba(138, 43, 226, 0.6);
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.4);
        }

        .stats-card-professional .value {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-family: 'Orbitron', monospace;
        }

        .stats-card-professional .label {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .stats-card-professional .trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .capabilities-section {
            padding: 6rem 0;
        }

        .capability-card-professional {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 15px;
            padding: 2rem;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .capability-card-professional:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .capability-card-professional .icon-wrapper {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            font-size: 2rem;
            color: white;
        }

        .capability-card-professional h4 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .capability-card-professional p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .values-section {
            padding: 6rem 0;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.05), rgba(75, 0, 130, 0.05));
        }

        .value-card-professional {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .value-card-professional:hover {
            border-color: rgba(138, 43, 226, 0.6);
            transform: scale(1.03);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .value-card-professional .icon-wrapper {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: white;
        }

        .value-card-professional h4 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .value-card-professional p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .testimonials-section {
            padding: 6rem 0;
        }

        .testimonial-card-professional {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 15px;
            padding: 2.5rem;
            text-align: center;
            transition: all 0.4s ease-in-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .testimonial-card-professional:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 50px rgba(138, 43, 226, 0.5);
            border-color: rgba(138, 43, 226, 0.8);
        }

        .testimonial-card-professional .quote-icon {
            color: var(--accent-color);
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .testimonial-card-professional .quote-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .testimonial-card-professional .author-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .testimonial-card-professional .author-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .partners-section {
            padding: 6rem 0;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.05), rgba(75, 0, 130, 0.05));
        }

        .partner-logo-professional {
            filter: grayscale(100%) brightness(180%);
            opacity: 0.7;
            transition: all 0.4s ease-in-out;
            height: 70px; /* Larger logos */
        }

        .partner-logo-professional:hover {
            filter: grayscale(0%) brightness(100%);
            opacity: 1;
            transform: scale(1.15);
        }

        .faq-section {
            padding: 6rem 0;
        }

        .faq-item-professional {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 15px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .faq-item-professional.active {
            border-color: rgba(138, 43, 226, 0.6);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .faq-question-professional {
            padding: 1.5rem 2rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
            transition: background-color 0.3s ease;
        }

        .faq-question-professional:hover {
            background-color: rgba(138, 43, 226, 0.15);
        }

        .faq-answer-professional {
            padding: 0 2rem 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s ease-out;
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .faq-item-professional.active .faq-answer-professional {
            max-height: 300px; /* Adjust as needed */
        }

        .faq-item-professional.active .faq-question-professional .fas {
            transform: rotate(180deg);
        }

        /* New Login Page Styles */
        .login-page-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            position: relative;
            overflow: hidden;
            padding-top: 4rem; /* Adjust for fixed navbar height */
        }

        .login-page-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(75, 0, 130, 0.1) 0%, transparent 50%);
            z-index: 0;
        }

        .login-card {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(138, 43, 226, 0.5);
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .login-card h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-color);
            font-family: 'Orbitron', monospace;
        }

        .login-card p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .login-input-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .login-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .login-input-group input {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 10px;
            padding: 1rem;
            color: white;
            width: 100%;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-input-group input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 0 4px rgba(138, 43, 226, 0.3);
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .login-options a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .login-options a:hover {
            color: var(--purple);
        }

        .login-btn {
            background: linear-gradient(45deg, var(--accent-color), var(--purple));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 1.2rem 2rem;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.5);
        }

        .login-social-login {
            margin-top: 2rem;
            border-top: 1px solid rgba(138, 43, 226, 0.2);
            padding-top: 1.5rem;
        }

        .login-social-login p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .login-social-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .login-social-button {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 0.8rem 1.5rem;
            color: white;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-social-button:hover {
            background: rgba(138, 43, 226, 0.2);
            border-color: var(--accent-color);
        }

        .login-register-link {
            margin-top: 2rem;
            color: var(--text-secondary);
        }

        .login-register-link button {
            color: var(--accent-color);
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .login-register-link button:hover {
            color: var(--purple);
        }

        .mascot-gif {
            position: absolute;
            z-index: 3; /* Above background, below content */
            opacity: 0.8;
            transition: transform 0.5s ease-in-out;
        }

        .mascot-gif:hover {
            transform: scale(1.1);
        }

        /* Dynamic positioning for home page mascots */
        .mascot-home-1 {
            top: 15%;
            left: 5%;
            width: 80px;
            animation: float 5s ease-in-out infinite;
        }

        .mascot-home-2 {
            bottom: 10%;
            right: 8%;
            width: 90px;
            animation: float 6s ease-in-out infinite reverse;
        }

        .mascot-home-3 {
            top: 50%;
            left: 2%;
            width: 70px;
            animation: float 7s ease-in-out infinite;
        }

        .mascot-home-4 {
            top: 20%;
            right: 2%;
            width: 100px;
            animation: float 8s ease-in-out infinite reverse;
        }

        .mascot-login-card {
            position: absolute;
            top: -40px; /* Adjust to position above the card */
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            animation: float 4s ease-in-out infinite;
        }

        .mascot-dashboard-header {
            height: 50px;
            margin-left: 15px;
            vertical-align: middle;
            position: relative; /* Allow positioning relative to text */
            top: -5px; /* Adjust vertical alignment */
        }

        /* New styles for the logo in the navbar */
        .navbar-logo {
            height: 30px; /* Adjust size as needed */
            margin-right: 10px;
        }

        /* Search bar on home page - IMPROVED VERSION */
        .home-search-container {
            position: relative;
            z-index: 2;
            margin-top: 3rem;
            max-width: 1400px; /* AUGMENTÉ: Plus large pour s'étendre */
            width: 95%; /* AUGMENTÉ: Prend plus de place sur les côtés */
            margin-left: auto;
            margin-right: auto;
            background: rgba(10, 8, 20, 0.95);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(138, 43, 226, 0.5);
            border-radius: 25px;
            padding: 25px 50px; /* MODIFIÉ: Moins de padding vertical, plus horizontal */
            box-shadow: 0 25px 80px rgba(138, 43, 226, 0.4);
        }

        .home-search-bar {
            background: rgba(8, 6, 18, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(138, 43, 226, 0.7);
            border-radius: 15px; /* RÉDUIT: Moins arrondi pour look plus long */
            padding: 0;
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.3);
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            align-items: stretch;
            gap: 3px; /* AJOUT: Espacement entre input et bouton */
            height: 60px; /* AJOUT: Hauteur fixe plus fine */
        }

        .home-search-bar:hover {
            border-color: rgba(138, 43, 226, 0.8);
            box-shadow: 0 25px 80px rgba(138, 43, 226, 0.4);
        }

        .home-search-bar:focus-within {
            border-color: rgba(138, 43, 226, 1);
            box-shadow: 0 0 0 4px rgba(138, 43, 226, 0.3), 0 25px 80px rgba(138, 43, 226, 0.5);
        }

        .search-input-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            padding: 0 30px; /* AUGMENTÉ: Plus de padding horizontal */
            border-radius: 12px 0 0 12px; /* RÉDUIT: Moins arrondi */
        }

        .search-input-icon {
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.2rem;
            margin-right: 15px;
        }

        .home-search-bar input {
            background: transparent;
            border: none;
            padding: 18px 0; /* RÉDUIT: Moins de padding vertical */
            color: white;
            width: 100%;
            font-size: 1.1rem;
            font-weight: 600;
            outline: none;
        }

        .home-search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .search-settings-icon {
            color: rgba(255, 255, 255, 0.4);
            font-size: 1.1rem;
            margin-left: 15px;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 5px; /* AJOUT: Zone cliquable plus grande */
            border-radius: 50%;
        }

        .search-settings-icon:hover {
            color: rgba(138, 43, 226, 0.8);
            background: rgba(138, 43, 226, 0.1);
        }

        .home-search-bar button {
            background: linear-gradient(135deg, #8a2be2, #6a1b9a);
            color: white;
            border: none;
            padding: 18px 35px; /* RÉDUIT: Moins de padding vertical */
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
            white-space: nowrap;
            border-radius: 0 12px 12px 0; /* RÉDUIT: Moins arrondi */
            margin-left: 3px; /* AJOUT: Séparation visuelle */
            position: relative;
        }

        .home-search-bar button::before {
            content: '';
            position: absolute;
            left: -3px;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 60%;
            background: rgba(255, 255, 255, 0.2);
        }

        .home-search-bar button:hover {
            background: linear-gradient(135deg, #9370db, #8a2be2);
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
        }

        .home-search-bar button i {
            font-size: 1.1rem;
        }

        /* Search options below the bar - IMPROVED */
        .search-options {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 25px; /* AUGMENTÉ: Plus d'espace */
            padding: 20px 15px; /* AJOUT: Padding interne */
            background: rgba(26, 26, 26, 0.3); /* AJOUT: Fond subtil */
            border-radius: 15px;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }

        .search-mode-buttons {
            display: flex;
            gap: 18px; /* AUGMENTÉ: Plus d'espace entre boutons */
            flex-wrap: wrap;
        }

        .search-mode-btn {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
            color: rgba(255, 255, 255, 0.7);
            padding: 12px 20px; /* AUGMENTÉ: Plus de padding */
            border-radius: 10px; /* AUGMENTÉ: Plus arrondi */
            font-size: 0.95rem; /* AUGMENTÉ: Texte plus lisible */
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px; /* AUGMENTÉ: Plus d'espace entre icône et texte */
            font-weight: 500; /* AJOUT: Texte plus gras */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* AJOUT: Ombre subtile */
        }

        .search-mode-btn:hover {
            border-color: rgba(138, 43, 226, 0.6);
            color: white;
            transform: translateY(-2px); /* AJOUT: Effet de survol */
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.3);
        }

        .search-mode-btn.active {
            background: linear-gradient(135deg, #8a2be2, #6a1b9a);
            border-color: rgba(138, 43, 226, 0.8);
            color: white;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4); /* AJOUT: Ombre plus prononcée */
        }

        .search-mode-btn i {
            font-size: 1.1rem; /* AJOUT: Icônes plus grandes */
        }

        .search-features {
            display: flex;
            gap: 25px; /* AUGMENTÉ: Plus d'espace */
            align-items: center;
            flex-wrap: wrap;
        }

        .search-feature {
            display: flex;
            align-items: center;
            gap: 10px; /* AUGMENTÉ: Plus d'espace entre icône et texte */
            font-size: 0.9rem; /* AUGMENTÉ: Texte plus lisible */
            color: rgba(255, 255, 255, 0.7); /* AMÉLIORÉ: Meilleur contraste */
            padding: 8px 12px; /* AJOUT: Padding pour meilleure lisibilité */
            background: rgba(138, 43, 226, 0.1); /* AJOUT: Fond subtil */
            border-radius: 8px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            transition: all 0.3s ease;
        }

        .search-feature:hover {
            background: rgba(138, 43, 226, 0.2);
            border-color: rgba(138, 43, 226, 0.4);
            color: white;
        }

        .search-feature i {
            color: rgba(138, 43, 226, 0.9); /* AMÉLIORÉ: Couleur plus vive */
            font-size: 1rem; /* AUGMENTÉ: Icônes plus grandes */
        }

        /* Responsive design for search bar */
        @media (max-width: 1200px) {
            .home-search-container {
                max-width: 900px;
            }
        }

        @media (max-width: 768px) {
            .home-search-bar {
                flex-direction: column;
            }
            
            .search-input-container {
                padding: 20px 25px;
            }
            
            .home-search-bar button {
                padding: 18px;
                justify-content: center;
                border-radius: 0 0 18px 18px;
            }

            .search-options {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .search-features {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* Custom button styles for register/login */
        .btn-auth-register {
            background: linear-gradient(45deg, var(--purple), var(--accent-color));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-auth-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(147, 112, 219, 0.4);
        }

        .btn-auth-login {
            background: linear-gradient(45deg, var(--accent-color), var(--cyan));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-auth-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(75, 0, 130, 0.4);
        }

        /* Gradient for sections */
        .section-gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, rgba(138, 43, 226, 0.05) 20%, rgba(75, 0, 130, 0.05) 80%, var(--secondary-color) 100%);
        }

        /* Payment method selection */
        .payment-method-option {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .payment-method-option:hover {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.3);
        }

        .payment-method-option.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
            background: rgba(138, 43, 226, 0.1);
        }

        .payment-method-option input[type="radio"] {
            transform: scale(1.5);
            accent-color: var(--accent-color);
        }

        .crypto-address-container {
            background: rgba(10, 10, 10, 0.7);
            border: 1px dashed rgba(138, 43, 226, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            word-break: break-all;
        }

        .crypto-address-container .copy-btn {
            background: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .crypto-address-container .copy-btn:hover {
            background: var(--purple);
        }

        /* Styles for Search Results Modal */
        .search-results-modal-content {
            max-height: 80vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .search-results-body {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 1rem; /* For scrollbar */
        }

        .search-results-item {
            position: relative; /* Needed for overlay */
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            line-height: 1.5;
            word-break: break-all;
        }

        .search-results-item strong {
            color: var(--accent-color);
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .pagination-controls button {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .pagination-controls button:disabled {
            background: var(--secondary-color);
            cursor: not-allowed;
        }

        .pagination-controls span {
            font-weight: 600;
        }

        /* Blurring for restricted content */
        .blurred-content {
            filter: blur(5px);
            pointer-events: none; /* Prevent text selection */
            user-select: none; /* Prevent text selection */
        }

        .blur-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 1rem;
            border-radius: 8px;
            z-index: 10; /* Ensure it's above blurred content */
            backdrop-filter: blur(2px); /* Add a slight blur to the overlay itself */
        }

    </style>
</head>
<body>
    <!-- Matrix Background Effect -->
    <div class="matrix-bg" id="matrixBg"></div>
    
    <!-- Cyber Grid Background -->
    <div class="cyber-grid" id="cyberGrid"></div>

    <!-- Cyber Decorations -->
    <div class="cyber-decoration cyber-decoration-1" id="cyberDeco1">
        <i class="fas fa-shield-alt"></i>
    </div>
    <div class="cyber-decoration cyber-decoration-2" id="cyberDeco2">
        <i class="fas fa-search"></i>
    </div>
    <div class="cyber-decoration cyber-decoration-3" id="cyberDeco3">
        <i class="fas fa-network-wired"></i>
    </div>
    <div class="cyber-decoration cyber-decoration-4" id="cyberDeco4" style="top: 70%; right: 20%; font-size: 90px; color: var(--cyan); animation: float 7s ease-in-out infinite;">
        <i class="fas fa-fingerprint"></i>
    </div>
    <div class="cyber-decoration cyber-decoration-5" id="cyberDeco5" style="bottom: 5%; left: 30%; font-size: 110px; color: var(--pink); animation: float 9s ease-in-out infinite reverse;">
        <i class="fas fa-database"></i>
    </div>

    <!-- Navigation Enhanced (New Navbar) -->
    <nav class="new-navbar fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center justify-between h-full w-full">
            <div class="flex items-center space-x-2">
                <img src="b.png" alt="BreachFR Logo" class="navbar-logo">
                <span class="text-sm text-gray-400 font-semibold hidden md:block" id="onlineUsersCount"></span>
            </div>
            
            <div class="flex items-center space-x-2">
                <a href="#" data-page="home" class="nav-link-enhanced text-white hover:text-blue-400 transition-colors active">Accueil</a>
                <a href="#" data-page="tools" class="nav-link-enhanced text-white hover:text-blue-400 transition-colors">Outils</a>
                <a href="#" data-page="premium" class="nav-link-enhanced text-white hover:text-blue-400 transition-colors">Premium</a>
                <a href="#" data-page="dashboard" class="nav-link-enhanced text-white hover:text-blue-400 transition-colors">Dashboard</a>
                <a href="#" data-page="settings-page" class="nav-link-enhanced text-white hover:text-blue-400 transition-colors">Paramètres</a>
            </div>
            
            <div class="flex items-center space-x-3">
                <button id="notificationsBtn" class="p-2 glass-effect rounded-lg hover:bg-blue-600 transition-colors relative">
                    <i class="fas fa-bell text-lg"></i>
                    <span class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center" id="notificationCount">0</span>
                </button>
                <button class="btn-auth-register font-semibold text-sm" data-page="register">
                    S'inscrire
                </button>
                <button class="btn-auth-login font-semibold text-sm" id="authButton">
                    Connexion
                </button>
                <!-- Quick logout button next to username (shows when connected) -->
                <button id="authLogoutBtn" class="p-2 ml-2 rounded-md text-red-300 hover:bg-red-600 hidden" title="Déconnexion">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
                <span id="authOnlineDot" class="auth-online-dot hidden" title="Connecté"></span>
                <!-- Navbar profile dropdown (appears when connected) -->
                <div class="nav-profile-container relative">
                    <div id="navProfileMenu" class="nav-profile-menu hidden absolute mt-2 w-48 bg-gray-900 border border-gray-700 rounded-md shadow-lg z-50">
                        <div class="px-3 py-2 border-b border-gray-800 text-xs text-gray-400" id="navProfileRole">Rôle: Utilisateur</div>
                        <div class="px-3 py-2 nav-profile-item" id="navProfileView">
                            <i class="fas fa-user mr-2"></i> Mon profil
                        </div>
                        <div class="px-3 py-2 nav-profile-item" id="navProfileTools">
                            <i class="fas fa-tools mr-2"></i> Outils / Dashboard
                        </div>
                        <div class="px-3 py-2 nav-profile-item" id="navProfileSettings">
                            <i class="fas fa-cog mr-2"></i> Paramètres
                        </div>
                        <div class="border-t border-gray-700"></div>
                        <div class="px-3 py-2 nav-profile-item text-red-400" id="navProfileLogout">
                            <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- HOME PAGE (Refonte Complète) -->
    <section id="home" class="page-section active">
        <!-- Hero Section - Professional Design -->
        <div class="hero-section-professional">
            <!-- Video Background -->
            <video autoplay muted loop class="hero-video-background">
                <source src="dark-sky-with-clouds.1920x1080.mp4" type="video/mp4">
                <!-- Add other video formats for broader browser support -->
                <!-- <source src="your-video.webm" type="video/webm"> -->
                Your browser does not support the video tag.
            </video>
            <!-- Overlay to darken video and make text readable -->
            <div class="hero-overlay"></div>
            <!-- Gradient overlay at the bottom of the video -->
            <div class="hero-video-overlay-gradient"></div>

            <!-- Mascotte for Home Page -->
            <img src="mascot.gif" alt="Mascotte BreachFR" class="mascot-gif" style="position: absolute; top: 15%; left: 5%; width: 80px; animation: float 5s ease-in-out infinite;">

            <div class="hero-content-professional">
                <h1 class="cyber-font text-white">
                    <span class="cyber-text typing">BREACHFR</span>
                </h1>
                
                <p>
                    Exploitez la puissance de l'Open Source Intelligence avec notre plateforme de nouvelle génération. 
                    Analysez, corrélez et agissez sur des données critiques avec une précision inégalée pour la cybersécurité et l'investigation.
                </p>
                
                <div class="hero-buttons">
                    <button id="startFreeBtn" class="btn-primary" data-page="register">
                            <i class="fas fa-rocket mr-2"></i>
                            Démarrer Gratuitement
                        </button>
                    <button class="btn-secondary" data-page="tools">
                        <i class="fas fa-tools mr-2"></i>
                        Explorer les Outils
                    </button>
                </div>

                <!-- Search Bar - Enhanced -->
                <div class="home-search-container">
                    <div class="home-search-bar">
                        <div class="search-input-container">
                            <i class="fas fa-expand-arrows-alt search-input-icon"></i>
                            <input type="text" placeholder="e.g. discord: 1234567890123456789" id="homeSearchBarInput">
                            <i class="fas fa-cog search-settings-icon"></i>
                        </div>
                        <button id="searchButton" class="search-btn">
                            <i class="fas fa-play"></i>
                            Initiate Scan
                        </button>
                    </div>
                    
                    <div class="search-options">
                        <div class="search-mode-buttons">
                            <button class="search-mode-btn" data-mode="bulk">
                                <i class="fas fa-th"></i>
                                Bulk Search
                            </button>
                            <button class="search-mode-btn active" onclick="toggleSearchMode('automated')">
                                <i class="fas fa-magic"></i>
                                Automated
                            </button>
                            <button class="search-mode-btn" onclick="toggleSearchMode('manual')">
                                <i class="fas fa-hand-paper"></i>
                                Manual
                            </button>
                        </div>
                        
                        <div class="search-features">
                            <div class="search-feature">
                                <i class="fas fa-database"></i>
                                <span>15+ Data Sources</span>
                            </div>
                            <div class="search-feature">
                                <i class="fas fa-shield-alt"></i>
                                <span>Secure & Private</span>
                            </div>
                            <div class="search-feature">
                                <i class="fas fa-clock"></i>
                                <span>Real-Time Results</span>
                            </div>
                            <div class="search-feature">
                                <i class="fas fa-user-check"></i>
                                <span>No Login Required</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Core Features Section - Professional Design -->
        <div class="py-20 section-gradient-bg">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Fonctionnalités Clés</h2>
                    <p>Des outils de pointe pour une intelligence inégalée.</p>
                </div>
                <div class="feature-grid-professional">
                    <div class="feature-item-professional">
                        <div class="icon-wrapper gradient-bg-1">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3 class="cyber-font">IA & Machine Learning</h3>
                        <p>Exploitez des algorithmes de pointe pour des analyses prédictives et la détection de patterns complexes.</p>
                    </div>
                    
                    <div class="feature-item-professional">
                        <div class="icon-wrapper gradient-bg-2">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h3 class="cyber-font">Sécurité Inviolable</h3>
                        <p>Vos données sont protégées par un chiffrement de niveau militaire et une architecture zero-trust.</p>
                    </div>
                    
                    <div class="feature-item-professional">
                        <div class="icon-wrapper gradient-bg-3">
                            <i class="fas fa-globe-americas"></i>
                        </div>
                        <h3 class="cyber-font">Couverture Mondiale</h3>
                        <p>Accédez à des sources de données diversifiées à travers le monde, y compris le Dark Web.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Why Choose Us Section (New Detail) -->
        <div class="py-20 bg-gradient-to-r from-purple-900/10 to-indigo-900/10">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Pourquoi Nous Choisir ?</h2>
                    <p>Notre engagement envers l'excellence et l'innovation nous distingue.</p>
                </div>
                <div class="why-choose-us-grid">
                    <div class="why-choose-us-item">
                        <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-chart-line text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Précision Inégalée</h3>
                        <p class="text-gray-400">Des algorithmes avancés garantissent des résultats fiables et pertinents.</p>
                    </div>
                    <div class="why-choose-us-item">
                        <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-user-shield text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Confidentialité Maximale</h3>
                        <p class="text-gray-400">Vos enquêtes restent privées grâce à nos protocoles de sécurité stricts.</p>
                    </div>
                    <div class="why-choose-us-item">
                        <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4 mx-auto">
                            <i class="fas fa-handshake text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Support Dédié</h3>
                        <p class="text-gray-400">Une équipe d'experts à votre écoute pour vous accompagner à chaque étape.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Section - Professional Design -->
        <div class="stats-section section-gradient-bg">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Performance en Chiffres</h2>
                    <p>La confiance de milliers de professionnels.</p>
                </div>
                <div class="stats-grid">
                    <div class="stats-card-professional">
                        <div class="value" id="totalUsersStat">0</div>
                        <div class="label">Utilisateurs Actifs</div>
                        <div class="trend text-green-400"><i class="fas fa-arrow-up"></i>+<span id="usersGrowth">0</span>% ce mois</div>
                    </div>
                    <div class="stats-card-professional">
                        <div class="value" id="totalRequestsStat">0</div>
                        <div class="label">Requêtes Traitées</div>
                        <div class="trend text-green-400"><i class="fas fa-arrow-up"></i>+<span id="requestsGrowth">0</span>% ce mois</div>
                    </div>
                    <div class="stats-card-professional">
                        <div class="value">99.99%</div>
                        <div class="label">Uptime Garanti</div>
                        <div class="trend text-blue-400"><i class="fas fa-check-circle"></i>SLA respecté</div>
                    </div>
                    <div class="stats-card-professional">
                        <div class="value">24/7</div>
                        <div class="label">Support Expert</div>
                        <div class="trend text-yellow-400"><i class="fas fa-clock"></i>Réponse < 1h</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Capabilities Section - Professional Design -->
        <div class="capabilities-section">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Capacités Techniques</h2>
                    <p>Une suite complète d'outils professionnels pour tous vos besoins en intelligence open source.</p>
                </div>

                <div class="capabilities-grid">
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-1">
                            <i class="fas fa-search-plus"></i>
                        </div>
                        <h4>Reconnaissance Passive</h4>
                        <p>Collecte d'informations sans interaction directe avec la cible.</p>
                    </div>
                    
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-2">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <h4>Analyse Réseau</h4>
                        <p>Cartographie complète des infrastructures et relations.</p>
                    </div>
                    
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-3">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4>Profiling Social</h4>
                        <p>Analyse comportementale et mapping des relations sociales.</p>
                    </div>
                    
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-4">
                            <i class="fas fa-fingerprint"></i>
                        </div>
                        <h4>Digital Forensics</h4>
                        <p>Investigation numérique et analyse de preuves.</p>
                    </div>
                    
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-1">
                            <i class="fas fa-shield-virus"></i>
                        </div>
                        <h4>Threat Hunting</h4>
                        <p>Chasse proactive aux menaces et IOC.</p>
                    </div>
                    
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-2">
                            <i class="fas fa-eye"></i>
                        </div>
                        <h4>Dark Web Monitoring</h4>
                        <p>Surveillance continue des marchés cachés.</p>
                    </div>
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-3">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h4>OSINT Automation</h4>
                        <p>Automatisation des tâches répétitives pour une efficacité maximale.</p>
                    </div>
                    <div class="capability-card-professional">
                        <div class="icon-wrapper gradient-bg-4">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <h4>Visualisation de Données</h4>
                        <p>Transformez des données brutes en graphiques interactifs et compréhensibles.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Our Values Section - Professional Design -->
        <div class="values-section section-gradient-bg">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Nos Valeurs Fondamentales</h2>
                    <p>L'éthique, l'innovation et la transparence au cœur de notre mission.</p>
                </div>
                <div class="values-grid">
                    <div class="value-card-professional">
                        <div class="icon-wrapper gradient-bg-1">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h4>Innovation</h4>
                        <p>Nous repoussons constamment les limites de l'OSINT.</p>
                    </div>
                    <div class="value-card-professional">
                        <div class="icon-wrapper gradient-bg-2">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h4>Éthique</h4>
                        <p>Une utilisation responsable et légale des données est notre priorité.</p>
                    </div>
                    <div class="value-card-professional">
                        <div class="icon-wrapper gradient-bg-3">
                            <i class="fas fa-eye"></i> <!-- Changed to eye for transparency -->
                        </div>
                        <h4>Transparence</h4>
                        <p>Clarté sur nos méthodes et nos sources pour une confiance mutuelle.</p>
                    </div>
                    <div class="value-card-professional">
                        <div class="icon-wrapper gradient-bg-4">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <h4>Collaboration</h4>
                        <p>Travailler ensemble pour un écosystème plus sûr.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testimonials Section - Professional Design -->
        <div class="testimonials-section">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Ce qu'ils disent de nous</h2>
                    <p>Des professionnels satisfaits partagent leur expérience.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="testimonial-card-professional">
                        <i class="fas fa-quote-left quote-icon"></i>
                        <p class="quote-text">"Cette plateforme a révolutionné nos enquêtes. La rapidité et la profondeur des analyses sont inégalées."</p>
                        <div class="author-name">- Sophie L.</div>
                        <div class="author-title">Enquêtrice Privée, Cyber Investigations Inc.</div>
                    </div>
                    <div class="testimonial-card-professional">
                        <i class="fas fa-quote-left quote-icon"></i>
                        <p class="quote-text">"L'intégration de l'IA est bluffante. Nous détectons des menaces que nous aurions manquées auparavant."</p>
                        <div class="author-name">- Marc D.</div>
                        <div class="author-title">Analyste Cybersécurité, GlobalSec Solutions</div>
                    </div>
                    <div class="testimonial-card-professional">
                        <i class="fas fa-quote-left quote-icon"></i>
                        <p class="quote-text">"Une interface intuitive et des résultats précis. Un outil indispensable pour tout professionnel de l'OSINT."</p>
                        <div class="author-name">- David R.</div>
                        <div class="author-title">Journaliste d'Investigation, Investigative Press</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Partners Section - Professional Design -->
        <div class="partners-section section-gradient-bg">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Nos Partenaires</h2>
                    <p>Collaborer pour un monde numérique plus sûr.</p>
                </div>
                <div class="flex flex-wrap justify-center items-center gap-16">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/partner1.png" alt="Partner Logo 1" class="partner-logo-professional">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/partner2.png" alt="Partner Logo 2" class="partner-logo-professional">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/partner3.png" alt="Partner Logo 3" class="partner-logo-professional">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/partner4.png" alt="Partner Logo 4" class="partner-logo-professional">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/partner5.png" alt="Partner Logo 5" class="partner-logo-professional">
                </div>
            </div>
        </div>

        <!-- FAQ Section - Professional Design -->
        <div class="faq-section">
            <div class="max-w-7xl mx-auto px-6">
                <div class="section-header">
                    <h2 class="cyber-text cyber-font">Questions Fréquentes</h2>
                    <p>Trouvez les réponses à vos interrogations.</p>
                </div>
                <div class="max-w-3xl mx-auto">
                    <div class="faq-item-professional">
                        <div class="faq-question-professional" onclick="toggleFAQ(this)">
                            Qu'est-ce que l'OSINT ?
                            <i class="fas fa-chevron-down transition-transform duration-500"></i>
                        </div>
                        <div class="faq-answer-professional">
                            L'OSINT (Open Source Intelligence) est la collecte et l'analyse d'informations provenant de sources publiques. Cela inclut les médias sociaux, les forums, les bases de données publiques, les sites web, etc. Notre plateforme vous aide à automatiser et à affiner ce processus.
                        </div>
                    </div>
                    <div class="faq-item-professional">
                        <div class="faq-question-professional" onclick="toggleFAQ(this)">
                            Notre plateforme est-elle légale ?
                            <i class="fas fa-chevron-down transition-transform duration-500"></i>
                        </div>
                        <div class="faq-answer-professional">
                            Oui, notre plateforme est conçue pour collecter et analyser des données accessibles publiquement. L'utilisation de la plateforme doit toujours respecter les lois locales et internationales en vigueur, notamment en matière de protection des données et de vie privée. Nous encourageons une utilisation éthique et responsable.
                        </div>
                    </div>
                    <div class="faq-item-professional">
                        <div class="faq-question-professional" onclick="toggleFAQ(this)">
                            Quels types de sources sont utilisées ?
                            <i class="fas fa-chevron-down transition-transform duration-500"></i>
                        </div>
                        <div class="faq-answer-professional">
                            Nous utilisons une vaste gamme de sources, y compris les réseaux sociaux (Twitter, Facebook, LinkedIn, etc.), les forums spécialisés, les blogs, les sites d'actualités, les bases de données WHOIS, les registres publics, les fuites de données connues, et des sources du Dark Web pour les plans Premium.
                        </div>
                    </div>
                    <div class="faq-item-professional">
                        <div class="faq-question-professional" onclick="toggleFAQ(this)">
                            Comment la sécurité de mes données est-elle assurée ?
                            <i class="fas fa-chevron-down transition-transform duration-500"></i>
                        </div>
                        <div class="faq-answer-professional">
                            Nous appliquons des mesures de sécurité de pointe, y compris le chiffrement AES-256, l'authentification multi-facteurs, des audits de sécurité réguliers et une architecture zero-trust. Vos investigations et vos données sont traitées avec la plus grande confidentialité et intégrité.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- LOGIN PAGE (Refonte Complète) -->
    <section id="login" class="page-section">
        <div class="login-page-container">
            <div class="login-card">
                <img src="mascot.gif" alt="Mascotte BreachFR" class="mascot-gif mascot-login-card">
                <h2 class="cyber-font">Connexion Sécurisée</h2>
                <p>Accédez à votre espace professionnel et reprenez le contrôle de votre intelligence.</p>
                
                <form id="loginForm">
                    <div class="login-input-group">
                        <label for="loginEmail">Email ou Nom d'utilisateur</label>
                        <input type="text" id="loginEmail" placeholder="votre@email.com ou nom_utilisateur" required>
                    </div>
                    
                    <div class="login-input-group">
                        <label for="loginPassword">Mot de passe</label>
                        <div class="relative">
                            <input type="password" id="loginPassword" placeholder="••••••••" required>
                            <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white" onclick="togglePasswordVisibility('loginPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="login-options">
                        <label class="flex items-center">
                            <input type="checkbox" id="loginRememberMe" class="mr-2">
                            <span class="text-sm">Se souvenir de moi</span>
                        </label>
                        <a href="#" class="text-sm">Mot de passe oublié?</a>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Se connecter
                    </button>
                </form>
                
                <div class="login-social-login">
                    <p>Ou connectez-vous avec</p>
                    <div class="login-social-buttons">
                        <button class="login-social-button">
                            <i class="fab fa-google text-red-500"></i> Google
                        </button>
                        <button class="login-social-button">
                            <i class="fab fa-github text-gray-400"></i> GitHub
                        </button>
                    </div>
                </div>
                
                <div class="login-register-link">
                    Pas encore de compte? <button onclick="showPage('register')">Créer un compte gratuitement</button>
                </div>
            </div>
        </div>
    </section>

    <!-- REGISTER PAGE -->
    <section id="register" class="page-section pt-20">
        <div class="min-h-screen flex items-center justify-center px-6 py-12">
            <div class="max-w-2xl w-full">
                <div class="glass-card p-8">
                    <div class="text-center mb-8">
                        <div class="cyber-text text-3xl font-bold mb-2 cyber-font">Rejoindre la Plateforme</div>
                        <p class="text-gray-400">Créez votre compte et accédez aux outils OSINT professionnels</p>
                    </div>
                    
                    <form id="registerForm">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Prénom</label>
                                <input type="text" class="form-input" placeholder="John" id="registerFirstName" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nom</label>
                                <input type="text" class="form-input" placeholder="Doe" id="registerLastName" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Nom d'utilisateur</label>
                            <input type="text" class="form-input" placeholder="johndoe" id="registerUsername" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Adresse email</label>
                            <input type="email" class="form-input" placeholder="john@exemple.com" id="registerEmail" required>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Mot de passe</label>
                                <div class="relative">
                                    <input type="password" class="form-input" placeholder="••••••••" id="registerPassword" required>
                                    <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white" onclick="togglePasswordVisibility('registerPassword', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <div class="text-xs text-gray-400 mb-1">Force du mot de passe:</div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Confirmer le mot de passe</label>
                                <div class="relative">
                                    <input type="password" class="form-input" placeholder="••••••••" id="registerConfirmPassword" required>
                                    <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white" onclick="togglePasswordVisibility('registerConfirmPassword', this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Secteur d'activité</label>
                            <select class="form-input" id="registerSector">
                                <option>Cybersécurité</option>
                                <option>Investigation privée</option>
                                <option>Forces de l'ordre</option>
                                <option>Journalisme</option>
                                <option>Recherche académique</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-start">
                                <input type="checkbox" class="mr-3 mt-1" id="registerTerms" required>
                                <span class="text-sm">J'accepte les <a href="#" class="text-blue-400 hover:text-blue-300">conditions d'utilisation</a> et la <a href="#" class="text-blue-400 hover:text-blue-300">politique de confidentialité</a></span>
                            </label>
                            <label class="flex items-start">
                                <input type="checkbox" class="mr-3 mt-1" id="registerNewsletter">
                                <span class="text-sm">Je souhaite recevoir les newsletters et mises à jour produit</span>
                            </label>
                        </div>
                        
                        <button type="submit" class="btn-primary w-full">
                            <i class="fas fa-user-plus mr-2"></i>
                            Créer mon compte
                        </button>
                    </form>
                    
                    <div class="mt-6 text-center">
                        <p class="text-gray-400">Vous avez déjà un compte?</p>
                        <button onclick="showPage('login')" class="text-blue-400 hover:text-blue-300 font-semibold">
                            Se connecter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD PAGE -->
    <section id="dashboard" class="page-section pt-20">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="flex items-center mb-8">
                <div class="cyber-text text-xl font-bold cyber-font flex items-center">
                    <!-- Removed Breach FR and logo -->
                </div>
            </div>
            
            <nav class="space-y-2">
                <a href="#" data-tab="overview" class="dashboard-nav-link flex items-center px-4 py-3 text-white bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    Vue d'ensemble
                </a>
                <a href="#" data-tab="tools" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-tools mr-3"></i>
                    Mes Outils
                </a>
                <a href="#" data-tab="investigations" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-search mr-3"></i>
                    Investigations
                </a>
                <a href="#" data-tab="reports" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-file-alt mr-3"></i>
                    Rapports
                </a>
                <a href="#" data-tab="team" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-users mr-3"></i>
                    Équipe
                </a>
                <a href="#" data-tab="alerts" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-bell mr-3"></i>
                    Alertes
                </a>
                <a href="#" data-tab="api-management" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-code mr-3"></i>
                    Gestion API
                </a>
                <a href="#" data-page="settings-page" class="dashboard-nav-link flex items-center px-4 py-3 text-gray-300 hover:bg-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-cog mr-3"></i>
                    Paramètres
                </a>
            </nav>
            
            <!-- User Profile -->
            <div class="absolute bottom-6 left-6 right-6">
                <div class="glass-card p-4 relative">
                    <div class="flex items-center space-x-3 cursor-pointer" onclick="toggleProfileMenu()">
                        <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/4511e575-fb1f-49f0-a812-39f77a0df2d2.png" alt="Professional cybersecurity expert avatar with modern tech aesthetic" class="w-10 h-10 rounded-full">
                        <div class="flex-1">
                            <div class="text-sm font-semibold" id="dashboardUserName">John Doe</div>
                            <div class="text-xs text-gray-400" id="dashboardUserPlan">Plan Premium</div>
                        </div>
                        <i class="fas fa-chevron-up text-gray-400"></i>
                    </div>
                    
                    <!-- Profile Menu -->
                    <div class="profile-menu" id="profileMenu">
                        <div class="profile-menu-item" onclick="showDashboardTab('profile')">
                            <i class="fas fa-user mr-3"></i>
                            Mon Profil
                        </div>
                        <div class="profile-menu-item" onclick="showDashboardTab('users')" id="userManagementOption" style="display: none;">
                            <i class="fas fa-users-cog mr-3"></i>
                            Gestion Utilisateurs
                        </div>
                        <div class="profile-menu-item" onclick="showDashboardTab('logs')">
                            <i class="fas fa-list-alt mr-3"></i>
                            Journaux d'activité
                        </div>
                        <div class="profile-menu-item" onclick="logout()">
                            <i class="fas fa-sign-out-alt mr-3"></i>
                            Déconnexion
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Header -->
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold cyber-font">Dashboard <img src="mascot.gif" alt="Mascotte" class="mascot-gif mascot-dashboard-header"></h1>
                    <p class="text-gray-400">Bienvenue dans votre espace de travail OSINT</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="btn-secondary" onclick="exportData()">
                        <i class="fas fa-download mr-2"></i>
                        Exporter
                    </button>
                    <button class="btn-primary" onclick="createInvestigation()">
                        <i class="fas fa-plus mr-2"></i>
                        Nouvelle investigation
                    </button>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="dashboard-overview" class="dashboard-tab active">
                <!-- Quick Stats -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardTotalInvestigations">0</div>
                                <div class="text-sm text-gray-400">Investigations totales</div>
                            </div>
                            <div class="gradient-bg-1 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-search text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-green-400 text-sm">+<span id="investigationsGrowth">0</span>% ce mois</span>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardApiRequests">0</div>
                                <div class="text-sm text-gray-400">Requêtes API</div>
                            </div>
                            <div class="gradient-bg-2 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-code text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-green-400 text-sm">+<span id="apiRequestsGrowth">0</span>% ce mois</span>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardSuccessRate">0%</div>
                                <div class="text-sm text-gray-400">Taux de succès</div>
                            </div>
                            <div class="gradient-bg-3 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-chart-line text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-green-400 text-sm">+<span id="successRateGrowth">0</span>% ce mois</span>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardDataCollected">0GB</div>
                                <div class="text-sm text-gray-400">Données collectées</div>
                            </div>
                            <div class="gradient-bg-4 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-database text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-yellow-400 text-sm">+<span id="dataCollectedToday">0</span>MB aujourd'hui</span>
                        </div>
                    </div>

                    <!-- New Stats Cards -->
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardActiveAlerts">0</div>
                                <div class="text-sm text-gray-400">Alertes Actives</div>
                            </div>
                            <div class="gradient-bg-4 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-red-400 text-sm">+<span id="newAlerts">0</span> nouvelles</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardRetentionRate">0%</div>
                                <div class="text-sm text-gray-400">Taux de Rétention</div>
                            </div>
                            <div class="gradient-bg-1 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-users-cog text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-green-400 text-sm">Stable</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardCostPerRequest">€0.00</div>
                                <div class="text-sm text-gray-400">Coût par Requête</div>
                            </div>
                            <div class="gradient-bg-2 w-12 h-12 rounded-full flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-blue-400 text-sm">Optimisé</span>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold cyber-font" id="dashboardTeamMembers">0</div>
                                <div class="text-sm text-gray-400">Membres d'Équipe</div>
                            </div>
                            <div class="gradient-bg-3 w-12 h-16 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-friends text-white"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-green-400 text-sm">Actifs</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity & Charts -->
                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-semibold mb-4 cyber-font">Activité Récente</h3>
                        <div class="space-y-4" id="recentActivityList">
                            <!-- Activity items will be dynamically loaded here -->
                        </div>
                    </div>
                    
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-semibold mb-4 cyber-font">Utilisation des Outils</h3>
                        <div class="chart-container">
                            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0be71dc8-8b1c-4117-9a56-d3238ce65e0e.png" alt="Interactive analytics chart showing OSINT tool usage statistics with colorful bars and data visualization elements in cyberpunk blue and purple theme" class="w-full h-full object-cover rounded">
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="glass-card p-6">
                    <h3 class="text-xl font-semibold mb-4 cyber-font">Actions Rapides</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <button class="btn-primary w-full" onclick="quickSearch()">
                            <i class="fas fa-search mr-2"></i>
                            Nouvelle recherche
                        </button>
                        <button class="btn-secondary w-full" onclick="domainScan()">
                            <i class="fas fa-globe mr-2"></i>
                            Scan de domaine
                        </button>
                        <button class="btn-secondary w-full" onclick="emailSearch()">
                            <i class="fas fa-envelope mr-2"></i>
                            Recherche email
                        </button>
                        <button class="btn-secondary w-full" onclick="showDashboardTab('alerts')">
                            <i class="fas fa-bell mr-2"></i>
                            Voir les alertes
                        </button>
                        <button class="btn-secondary w-full" onclick="showDashboardTab('api-management')">
                            <i class="fas fa-code mr-2"></i>
                            Gérer API
                        </button>
                        <button class="btn-secondary w-full" onclick="generateReport()">
                            <i class="fas fa-file-alt mr-2"></i>
                            Générer un rapport
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tools Tab -->
            <div id="dashboard-tools" class="dashboard-tab">
                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-search text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Recherche Domaine</h3>
                        <p class="text-gray-400 mb-4">Analysez les domaines, sous-domes et infrastructures web.</p>
                        <button class="btn-primary w-full" onclick="launchTool('domain')">Utiliser l'outil</button>
                    </div>
                    
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-envelope-open-text text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Email Intelligence</h3>
                        <p class="text-gray-400 mb-4">Recherchez des informations sur les adresses email.</p>
                        <button class="btn-primary w-full" onclick="launchTool('email')">Utiliser l'outil</button>
                    </div>
                    
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-3 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-network-wired text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Analyse IP</h3>
                        <p class="text-gray-400 mb-4">Géolocalisation, fournisseur et historique des adresses IP.</p>
                        <button class="btn-primary w-full" onclick="launchTool('ip')">Utiliser l'outil</button>
                    </div>
                    
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-users text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Social Media Intel</h3>
                        <p class="text-gray-400 mb-4">Collectez des données depuis les réseaux sociaux.</p>
                        <div class="scanner-animation h-2 mb-4">
                            <div class="scanner-line"></div>
                        </div>
                        <button class="btn-primary w-full" onclick="launchTool('social')">Utiliser l'outil</button>
                    </div>
                    
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-phone text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Phone Intelligence</h3>
                        <p class="text-gray-400 mb-4">Informations sur les numéros de téléphone.</p>
                        <button class="btn-primary w-full" onclick="launchTool('phone')">Utiliser l'outil</button>
                    </div>
                    
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-shield-virus text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Threat Intelligence</h3>
                        <p class="text-gray-400 mb-4">Analysez les menaces et indicateurs de compromission.</p>
                        <button class="btn-primary w-full" onclick="launchTool('threats')">Utiliser l'outil</button>
                    </div>
                    <!-- New Tools -->
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-3 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-eye text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Dark Web Monitoring</h3>
                        <p class="text-400 mb-4">Surveillez les fuites de données et les mentions sur le Dark Web.</p>
                        <button class="btn-primary w-full" onclick="launchTool('darkweb')">Utiliser l'outil</button>
                    </div>
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-bitcoin text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">Crypto Analysis</h3>
                        <p class="text-gray-400 mb-4">Tracez les transactions et identifiez les portefeuilles suspects.</p>
                        <button class="btn-primary w-full" onclick="launchTool('crypto')">Utiliser l'outil</button>
                    </div>
                    <div class="glass-card p-6 tool-card">
                        <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-robot text-2xl text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-3 cyber-font">OSINT Automation</h3>
                        <p class="text-gray-400 mb-4">Créez des workflows automatisés pour vos recherches OSINT.</p>
                        <button class="btn-primary w-full" onclick="launchTool('automation')">Utiliser l'outil</button>
                    </div>
                </div>
            </div>

            <!-- Investigations Tab -->
            <div id="dashboard-investigations" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Mes Investigations</h3>
                    <button class="btn-primary" onclick="createInvestigation()">
                        <i class="fas fa-plus mr-2"></i>
                        Nouvelle Investigation
                    </button>
                </div>
                
                <div class="grid gap-6" id="investigationsList">
                    <!-- Investigations will be dynamically loaded here -->
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="dashboard-reports" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Rapports d'Investigation</h3>
                    <button class="btn-primary" onclick="generateReport()">
                        <i class="fas fa-file-plus mr-2"></i>
                        Générer Rapport
                    </button>
                </div>
                
                <div class="grid gap-4" id="reportsList">
                    <!-- Reports will be dynamically loaded here -->
                </div>
            </div>

            <!-- Team Tab -->
            <div id="dashboard-team" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Gestion d'Équipe</h3>
                    <button class="btn-primary" onclick="inviteTeamMember()">
                        <i class="fas fa-user-plus mr-2"></i>
                        Inviter Membre
                    </button>
                </div>
                
                <div class="grid gap-4" id="teamMembersList">
                    <!-- Team members will be dynamically loaded here -->
                </div>
            </div>

            <!-- Alerts Tab (New) -->
            <div id="dashboard-alerts" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Mes Alertes</h3>
                    <button class="btn-primary" onclick="createAlert()">
                        <i class="fas fa-plus mr-2"></i>
                        Nouvelle Alerte
                    </button>
                </div>
                <div class="grid gap-4" id="alertsList">
                    <!-- Alerts will be dynamically loaded here -->
                </div>
            </div>

            <!-- API Management Tab (New) -->
            <div id="dashboard-api-management" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Gestion des API</h3>
                    <button class="btn-primary" onclick="generateNewApiKey()">
                        <i class="fas fa-key mr-2"></i>
                        Générer Nouvelle Clé
                    </button>
                </div>
                <div class="glass-card p-6">
                    <h4 class="text-xl font-semibold mb-4">Votre Clé API Actuelle</h4>
                    <div class="flex items-center mb-4">
                        <input type="text" class="form-input flex-1" value="BFR-API-KEY-XXXXXXXXXXXXXX" readonly id="currentApiKey">
                        <button class="btn-secondary ml-2" onclick="copyApiKey()">
                            <i class="fas fa-copy mr-2"></i>
                            Copier
                        </button>
                    </div>
                    <p class="text-gray-400 text-sm mb-6">Utilisez cette clé pour intégrer la plateforme à vos applications et scripts.</p>

                    <h4 class="text-xl font-semibold mb-4">Utilisation de l'API</h4>
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <div class="text-lg font-semibold cyber-font">Requêtes Aujourd'hui: <span id="apiRequestsToday">0</span> / <span id="apiRequestsLimit">0</span></div>
                            <div class="progress-bar mt-2">
                                <div class="progress-fill" id="apiRequestsProgress" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Votre limite quotidienne de requêtes API.</p>
                        </div>
                        <div>
                            <div class="text-lg font-semibold cyber-font">Erreurs API: <span id="apiErrors">0</span></div>
                            <p class="text-xs text-gray-500 mt-1">Nombre d'erreurs rencontrées lors des appels API.</p>
                            <button class="btn-secondary mt-2" onclick="viewApiLogs()">
                                <i class="fas fa-list-alt mr-2"></i>
                                Voir les logs API
                            </button>
                        </div>
                    </div>

                    <h4 class="text-xl font-semibold mb-4">Documentation API</h4>
                    <p class="text-gray-400 mb-4">Consultez notre documentation complète pour des exemples d'intégration et des détails sur les endpoints disponibles.</p>
                    <a href="#" class="btn-primary inline-block" target="_blank">
                        <i class="fas fa-book mr-2"></i>
                        Accéder à la Documentation
                    </a>
                </div>
            </div>

            <!-- User Management Tab (Founder only) -->
            <div id="dashboard-users" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Gestion des Utilisateurs</h3>
                    <div class="flex space-x-2">
                        <button class="btn-secondary" onclick="refreshUserList()">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Actualiser
                        </button>
                        <button class="btn-primary" onclick="createUser()">
                            <i class="fas fa-user-plus mr-2"></i>
                            Créer Utilisateur
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4" id="usersList">
                    <!-- Users will be populated here -->
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="dashboard-profile" class="dashboard-tab">
                <div class="max-w-4xl">
                    <h3 class="text-2xl font-bold cyber-font mb-6">Mon Profil</h3>
                    
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="glass-card p-6">
                            <h4 class="text-xl font-semibold mb-4">Informations Personnelles</h4>
                            <form class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Nom complet</label>
                                    <input type="text" class="form-input" id="profileFullName">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" class="form-input" id="profileEmail">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Organisation</label>
                                    <input type="text" class="form-input" id="profileOrganization">
                                </div>
                                <button type="button" class="btn-primary" onclick="saveProfile()">
                                    <i class="fas fa-save mr-2"></i>
                                    Sauvegarder
                                </button>
                            </form>
                        </div>
                        
                        <div class="glass-card p-6">
                            <h4 class="text-xl font-semibold mb-4">Sécurité du Compte</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold">Authentification 2FA</div>
                                        <div class="text-sm text-gray-400">Sécurisez votre compte</div>
                                    </div>
                                    <button class="btn-primary">Configurer</button>
                                </div>
                                
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold">Changer mot de passe</div>
                                        <div class="text-sm text-gray-400">Dernière modification: jamais</div>
                                    </div>
                                    <button class="btn-secondary">Modifier</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="dashboard-logs" class="dashboard-tab">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold cyber-font">Journaux d'Activité</h3>
                    <button class="btn-secondary" onclick="clearLogs()">
                        <i class="fas fa-trash mr-2"></i>
                        Vider les logs
                    </button>
                </div>
                
                <div class="glass-card p-6">
                    <div class="space-y-3" id="activityLogs">
                        <!-- Logs will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- TOOLS PAGE -->
    <section id="tools" class="page-section pt-20">
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold cyber-text mb-4 cyber-font">Arsenal OSINT</h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    Découvrez notre collection complète d'outils d'intelligence open source, 
                    conçus pour les professionnels de la cybersécurité et les enquêteurs.
                </p>
            </div>
            
            <!-- Tools Categories -->
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <button onclick="filterTools('all')" class="tool-filter active px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors">
                    Tous les outils
                </button>
                <button onclick="filterTools('reconnaissance')" class="tool-filter px-6 py-2 glass-effect text-white rounded-full hover:bg-blue-600 transition-colors">
                    Reconnaissance
                </button>
                <button onclick="filterTools('social')" class="tool-filter px-6 py-2 glass-effect text-white rounded-full hover:bg-blue-600 transition-colors">
                    Social Media
                </button>
                <button onclick="filterTools('network')" class="tool-filter px-6 py-2 glass-effect text-white rounded-full hover:bg-blue-600 transition-colors">
                    Réseau
                </button>
                <button onclick="filterTools('forensics')" class="tool-filter px-6 py-2 glass-effect text-white rounded-full hover:bg-blue-600 transition-colors">
                    Forensics
                </button>
                <button onclick="filterTools('automation')" class="tool-filter px-6 py-2 glass-effect text-white rounded-full hover:bg-blue-600 transition-colors">
                    Automation
                </button>
            </div>
            
            <!-- Tools Grid -->
            <div class="dashboard-grid">
                <!-- Domain Intelligence -->
                <div class="glass-card p-6 tool-card" data-category="reconnaissance">
                    <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-globe text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Domain Intelligence</h3>
                    <p class="text-gray-400 mb-4">Analyse complète des domaines incluant WHOIS, DNS, certificats SSL et historique.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('domain')">
                        <i class="fas fa-rocket mr-2"></i>
                        Lancer l'outil
                    </button>
                </div>
                
                <!-- Email Investigation -->
                <div class="glass-card p-6 tool-card" data-category="reconnaissance">
                    <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-envelope-open-text text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Email Investigation</h3>
                    <p class="text-gray-400 mb-4">Recherche approfondie sur les adresses email, fuites de données et profils associés.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-blue-400">Gratuit</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('email')">
                        <i class="fas fa-search mr-2"></i>
                        Analyser email
                    </button>
                </div>
                
                <!-- IP Geolocation -->
                <div class="glass-card p-6 tool-card" data-category="network">
                    <div class="gradient-bg-3 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-map-marker-alt text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">IP Geolocation</h3>
                    <p class="text-gray-400 mb-4">Localisation géographique, FAI, organisation et informations techniques des adresses IP.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-blue-400">Gratuit</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('ip')">
                        <i class="fas fa-crosshairs mr-2"></i>
                        Localiser IP
                    </button>
                </div>
                
                <!-- Social Media Scanner -->
                <div class="glass-card p-6 tool-card" data-category="social">
                    <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-hashtag text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Social Media Scanner</h3>
                    <p class="text-gray-400 mb-4">Collecte d'informations depuis les principales plateformes sociales et forums.</p>
                    <div class="scanner-animation h-2 mb-4">
                        <div class="scanner-line"></div>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('social')">
                        <i class="fas fa-users mr-2"></i>
                        Scanner réseaux
                    </button>
                </div>
                
                <!-- Phone Number Intelligence -->
                <div class="glass-card p-6 tool-card" data-category="reconnaissance">
                    <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-phone text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Phone Intelligence</h3>
                    <p class="text-gray-400 mb-4">Analyse des numéros de téléphone : opérateur, géolocalisation et validité.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-blue-400">Gratuit</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('phone')">
                        <i class="fas fa-mobile-alt mr-2"></i>
                        Analyser numéro
                    </button>
                </div>
                
                <!-- Threat Intelligence -->
                <div class="glass-card p-6 tool-card" data-category="forensics">
                    <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-shield-virus text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Threat Intelligence</h3>
                    <p class="text-gray-400 mb-4">Base de données de menaces, IOCs et indicateurs de compromission.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('threats')">
                        <i class="fas fa-bug mr-2"></i>
                        Analyser menaces
                    </button>
                </div>

                <!-- New Tools for Tools Page -->
                <div class="glass-card p-6 tool-card" data-category="forensics">
                    <div class="gradient-bg-3 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-eye text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Dark Web Monitoring</h3>
                    <p class="text-400 mb-4">Surveillez les fuites de données, les identifiants compromis et les mentions sur les marchés noirs.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('darkweb')">
                        <i class="fas fa-mask mr-2"></i>
                        Surveiller Dark Web
                    </button>
                </div>

                <div class="glass-card p-6 tool-card" data-category="network">
                    <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-bitcoin text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Crypto Analysis</h3>
                    <p class="text-gray-400 mb-4">Analysez les transactions de cryptomonnaies, identifiez les portefeuilles suspects et les flux financiers.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('crypto')">
                        <i class="fas fa-chart-area mr-2"></i>
                        Analyser Crypto
                    </button>
                </div>

                <div class="glass-card p-6 tool-card" data-category="automation">
                    <div class="gradient-bg-1 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-robot text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">OSINT Automation</h3>
                    <p class="text-gray-400 mb-4">Créez et gérez des workflows automatisés pour la collecte et l'analyse de données OSINT.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('automation')">
                        <i class="fas fa-cogs mr-2"></i>
                        Gérer Automation
                    </button>
                </div>

                <div class="glass-card p-6 tool-card" data-category="reconnaissance">
                    <div class="gradient-bg-2 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-camera text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Image Forensics</h3>
                    <p class="text-gray-400 mb-4">Extrayez les métadonnées EXIF, détectez les manipulations et identifiez les sources d'images.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-blue-400">Gratuit</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('image')">
                        <i class="fas fa-image mr-2"></i>
                        Analyser Image
                    </button>
                </div>

                <div class="glass-card p-6 tool-card" data-category="network">
                    <div class="gradient-bg-3 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-wifi text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Wi-Fi Analysis</h3>
                    <p class="text-gray-400 mb-4">Identifiez les réseaux Wi-Fi ouverts, les points d'accès vulnérables et les appareils connectés.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-yellow-400">Premium requis</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('wifi')">
                        <i class="fas fa-signal mr-2"></i>
                        Analyser Wi-Fi
                    </button>
                </div>

                <div class="glass-card p-6 tool-card" data-category="social">
                    <div class="gradient-bg-4 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-comments text-2xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 cyber-font">Forum & Blog Scraper</h3>
                    <p class="text-gray-400 mb-4">Collectez des informations pertinentes sur des forums, blogs et communautés en ligne.</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm text-green-400">Service disponible</span>
                        <span class="text-sm text-blue-400">Gratuit</span>
                    </div>
                    <button class="btn-primary w-full" onclick="launchTool('forum')">
                        <i class="fas fa-comment-dots mr-2"></i>
                        Scraper Contenu
                    </button>
                </div>
            </div>
            
            <!-- Tool Launcher Modal -->
            <div id="toolModal" class="modal hidden">
                <div class="glass-card p-8 max-w-2xl w-full mx-4">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold cyber-font" id="toolTitle">Outil OSINT</h3>
                        <button onclick="closeTool()" class="text-gray-400 hover:text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div id="toolContent" class="space-y-6">
                        <!-- Tool interface will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PREMIUM PAGE -->
    <section id="premium" class="page-section pt-20">
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold cyber-text mb-4 cyber-font">Plans Premium</h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    Débloquez tout le potentiel de la plateforme avec nos plans d'abonnement professionnels. 
                    Accédez aux outils avancés, API illimitées et support prioritaire.
                </p>
            </div>
            
            <!-- Pricing Cards -->
            <div class="grid lg:grid-cols-3 gap-8 mb-16">
                <!-- Starter Plan -->
                <div class="glass-card p-8 relative">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold mb-2 cyber-font">Starter</h3>
                        <div class="text-4xl font-bold cyber-text mb-2 cyber-font">
                            €19.99<span class="text-lg text-gray-400">/mois</span>
                        </div>
                        <p class="text-gray-400">Parfait pour débuter</p>
                    </div>
                    
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            1,000 requêtes API/jour
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Outils de base OSINT
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Support par email
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Rapports PDF
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-times text-gray-500 mr-3"></i>
                            <span class="text-gray-500">API avancées</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-times text-gray-500 mr-3"></i>
                            <span class="text-gray-500">Dark Web Monitoring</span>
                        </li>
                    </ul>
                    
                    <button class="btn-secondary w-full" onclick="selectPlan('Starter', 29)">
                        Choisir Starter
                    </button>
                </div>
                
                <!-- Professional Plan -->
                <div class="glass-card p-8 relative neon-border">
                    <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
                        <span class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-semibold">
                            Plus populaire
                        </span>
                    </div>
                    
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold mb-2 cyber-font">Professional</h3>
                        <div class="text-4xl font-bold cyber-text mb-2 cyber-font">
                            €49.99<span class="text-lg text-gray-400">/mois</span>
                        </div>
                        <p class="text-gray-400">Pour les professionnels</p>
                    </div>
                    
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            10,000 requêtes API/jour
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Tous les outils OSINT
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Support prioritaire 24/7
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Rapports avancés
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            API complètes
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Équipe de 5 utilisateurs
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Dark Web Monitoring
                        </li>
                    </ul>
                    
                    <button class="btn-primary w-full" onclick="selectPlan('Professional', 79)">
                        Choisir Professional
                    </button>
                </div>
                
                <!-- Enterprise Plan -->
                <div class="glass-card p-8 relative">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold mb-2 cyber-font">Enterprise</h3>
                        <div class="text-4xl font-bold cyber-text mb-2 cyber-font">
                            €199<span class="text-lg text-gray-400">/mois</span>
                        </div>
                        <p class="text-gray-400">Solution d'entreprise</p>
                    </div>
                    
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Requêtes illimitées
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Outils exclusifs
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Support dédié
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            On-premise disponible
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Intégrations personnalisées
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Utilisateurs illimités
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            Crypto Analysis
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check text-green-400 mr-3"></i>
                            OSINT Automation
                        </li>
                    </ul>
                    
                    <button class="btn-primary w-full" onclick="selectPlan('Enterprise', 199)">
                        Contacter l'équipe
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- PREMIUM CHECKOUT PAGE (New Design - PayPal & Crypto) -->
    <section id="premium-checkout" class="page-section pt-20">
        <div class="min-h-screen flex items-center justify-center px-6 py-12">
            <div class="payment-form-container">
                <div class="text-center mb-10">
                    <h2 class="text-4xl font-bold cyber-font mb-3">Finaliser votre Abonnement</h2>
                    <p class="text-gray-400 text-lg">Sélectionnez votre mode de paiement pour le plan <span id="checkoutPlanName" class="text-blue-400 font-semibold"></span></p>
                </div>

                <form id="paymentForm">
                    <div class="payment-input-group">
                        <label class="text-lg mb-4 block">Choisissez votre méthode de paiement :</label>
                        <div class="space-y-4">
                            <label class="payment-method-option selected" id="paypal-option">
                                <input type="radio" name="paymentMethod" value="paypal" checked onchange="togglePaymentMethod('paypal')">
                                <i class="fab fa-paypal text-blue-500 text-3xl"></i>
                                <span class="text-xl font-semibold">PayPal</span>
                            </label>
                            <label class="payment-method-option" id="crypto-option">
                                <input type="radio" name="paymentMethod" value="crypto" onchange="togglePaymentMethod('crypto')">
                                <i class="fas fa-bitcoin text-yellow-500 text-3xl"></i>
                                <span class="text-xl font-semibold">Crypto-monnaies</span>
                            </label>
                        </div>
                    </div>

                    <div id="paypal-details" class="payment-details-section space-y-6">
                        <p class="text-gray-400">Cliquez sur "Payer maintenant" pour être redirigé vers PayPal et finaliser votre paiement sécurisé.</p>
                        <div class="payment-input-group">
                            <label for="paypalEmail" class="text-lg">Votre adresse email PayPal</label>
                            <input type="email" id="paypalEmail" placeholder="votre.email@example.com" class="form-input">
                            <p class="text-sm text-gray-500 mt-2">Cette information est facultative mais peut aider à accélérer la vérification de votre paiement.</p>
                        </div>
                        <p class="text-sm text-gray-400">
                            Veuillez envoyer le montant exact de <span id="paypalAmount" class="font-bold text-white"></span> à l'adresse PayPal suivante :
                            <span class="font-bold text-blue-400" id="paypalAddress">breachfr@proton.me</span>
                            <button type="button" class="ml-2 px-2 py-1 text-sm bg-gray-800 rounded" onclick="copyPayPalAddress()">Copier</button>
                            <br>
                            Après le paiement, envoyez la preuve (capture d'écran ou reçu) sur notre Discord :
                            <a href="https://discord.gg/breachfr" target="_blank" rel="noopener" class="text-blue-400 font-semibold">discord.gg/breachfr</a>
                            — une fois vérifié nous activerons votre compte.
                        </p>
                    </div>

                    <div id="crypto-details" class="payment-details-section hidden space-y-6">
                        <p class="text-gray-400">Veuillez transférer le montant exact de votre abonnement à l'une des adresses ci-dessous. Assurez-vous d'envoyer la bonne crypto-monnaie à l'adresse correspondante.</p>
                        
                        <div class="payment-input-group">
                            <label for="cryptoCurrency" class="text-lg">Choisissez votre crypto-monnaie</label>
                            <select id="cryptoCurrency" class="form-input" onchange="updateCryptoAddress()">
                                <option value="btc">Bitcoin (BTC)</option>
                                <option value="ltc">Litecoin (LTC)</option>
                            </select>
                        </div>

                        <div class="crypto-address-container">
                            <p class="text-gray-300 text-sm mb-2">Adresse de dépôt <span id="selectedCryptoName" class="font-bold">Bitcoin (BTC)</span> :</p>
                            <div class="flex items-center">
                                <span id="cryptoAddress" class="text-blue-400 font-mono text-sm flex-grow">bc1q3vq4sc453cm0tulj99xlkq3vv98eqk02rp2na9</span>
                                <button type="button" class="copy-btn" onclick="copyCryptoAddress()">Copier</button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">
                                <i class="fas fa-exclamation-triangle text-yellow-400 mr-1"></i>
                                Envoyez le montant exact de <span id="cryptoAmount" class="font-bold text-white"></span>. Tout montant incorrect pourrait entraîner des retards ou la perte de votre paiement.
                            </p>
                            <p class="text-sm text-gray-500 mt-1">
                                <i class="fas fa-info-circle text-blue-400 mr-1"></i>
                                Les paiements en crypto-monnaies nécessitent une vérification manuelle. Votre accès sera activé après confirmation de la transaction (généralement 1 à 6 heures, selon la congestion du réseau).
                            </p>
                        </div>
                    </div>

                    <div class="payment-summary">
                        <h3 class="text-2xl font-bold cyber-font mb-4">Récapitulatif de la commande</h3>
                        <div>
                            <span class="text-lg">Plan sélectionné:</span>
                            <span id="summaryPlanName" class="font-semibold text-lg"></span>
                        </div>
                        <div class="total">
                            <span>Total à payer:</span>
                            <span id="summaryTotal" class="font-semibold"></span>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary w-full py-4 text-xl">
                        <i class="fas fa-check-circle mr-3"></i>
                        Payer maintenant
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- SETTINGS PAGE (Re-implemented) -->
    <section id="settings-page" class="page-section pt-20">
        <div class="min-h-screen flex items-center justify-center px-6 py-12">
            <div class="settings-page-container">
                <div class="settings-sidebar">
                    <h3 class="text-2xl font-bold cyber-font mb-6">Paramètres</h3>
                    <nav class="space-y-2">
                        <button class="settings-tab-button active" onclick="showSettingsPageTab('general-settings')">
                            <i class="fas fa-cogs"></i>
                            Général
                        </button>
                        <button class="settings-tab-button" onclick="showSettingsPageTab('profile-settings')">
                            <i class="fas fa-user-circle"></i>
                            Profil
                        </button>
                        <button class="settings-tab-button" onclick="showSettingsPageTab('security-settings')">
                            <i class="fas fa-shield-alt"></i>
                            Sécurité
                        </button>
                        <button class="settings-tab-button" onclick="showSettingsPageTab('api-settings')">
                            <i class="fas fa-code"></i>
                            API
                        </button>
                        <button class="settings-tab-button" onclick="showSettingsPageTab('billing-settings')">
                            <i class="fas fa-credit-card"></i>
                            Facturation
                        </button>
                        <button class="settings-tab-button" onclick="showSettingsPageTab('notifications-settings')">
                            <i class="fas fa-bell"></i>
                            Notifications
                        </button>
                    </nav>
                </div>

                <div class="settings-main-content">
                    <!-- General Settings -->
                    <div id="general-settings" class="settings-content active">
                        <div class="settings-section-card">
                            <h4>Paramètres Généraux</h4>
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Effet Matrix en arrière-plan</label>
                                        <p class="text-sm text-gray-400">Active ou désactive l'animation de fond style Matrix.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" id="settingsPageMatrixBg">
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Grille Cyber en arrière-plan</label>
                                        <p class="text-sm text-gray-400">Active ou désactive l'animation de grille futuriste.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" id="settingsPageCyberGrid">
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Décorations Cyber</label>
                                        <p class="text-sm text-gray-400">Active ou désactive les icônes flottantes décoratives.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" id="settingsPageCyberDecorations">
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <button class="btn-primary" onclick="saveGeneralSettings()">
                                    <i class="fas fa-save mr-2"></i>
                                    Sauvegarder les paramètres
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Settings -->
                    <div id="profile-settings" class="settings-content">
                        <div class="settings-section-card">
                            <h4>Informations du Profil</h4>
                            <form class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Nom Complet</label>
                                    <input type="text" class="form-input" id="settingsPageFullName" placeholder="Votre nom complet">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Adresse Email</label>
                                    <input type="email" class="form-input" id="settingsPageEmail" placeholder="votre.email@example.com" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Organisation</label>
                                    <input type="text" class="form-input" id="settingsPageOrganization" placeholder="Votre organisation (optionnel)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Rôle</label>
                                    <input type="text" class="form-input" id="settingsPageRole" readonly>
                                </div>
                                <button type="button" class="btn-primary" onclick="saveProfileSettings()">
                                    <i class="fas fa-save mr-2"></i>
                                    Mettre à jour le profil
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div id="security-settings" class="settings-content">
                        <div class="settings-section-card">
                            <h4>Sécurité du Compte</h4>
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Authentification à deux facteurs (2FA)</label>
                                        <p class="text-sm text-gray-400">Ajoutez une couche de sécurité supplémentaire à votre compte.</p>
                                    </div>
                                    <button class="btn-primary" onclick="enable2FA()">Activer 2FA</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Changer le mot de passe</label>
                                        <p class="text-sm text-gray-400">Mettez à jour votre mot de passe régulièrement pour une meilleure sécurité.</p>
                                    </div>
                                    <button class="btn-secondary" onclick="changePassword()">Changer le mot de passe</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Historique des connexions</label>
                                        <p class="text-sm text-gray-400">Consultez les dernières activités de connexion à votre compte.</p>
                                    </div>
                                    <button class="btn-secondary" onclick="viewLoginHistory()">Voir l'historique</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium text-red-400">Supprimer le compte</label>
                                        <p class="text-sm text-gray-400">Cette action est irréversible et supprimera toutes vos données.</p>
                                    </div>
                                    <button class="btn-danger" onclick="deleteAccount()">Supprimer le compte</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- API Settings -->
                    <div id="api-settings" class="settings-content">
                        <div class="settings-section-card">
                            <h4>Gestion des Clés API</h4>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Votre Clé API</label>
                                    <div class="flex items-center">
                                        <input type="text" class="form-input flex-1" id="settingsPageApiKey" readonly>
                                        <button class="btn-secondary ml-2" onclick="copyApiKey()">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-400 mt-2">Utilisez cette clé pour intégrer nos services à vos applications.</p>
                                </div>
                                <button class="btn-primary" onclick="generateNewApiKey()">
                                    <i class="fas fa-key mr-2"></i>
                                    Générer une nouvelle clé
                                </button>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Requêtes API Aujourd'hui</label>
                                        <div class="text-xl font-bold cyber-font"><span id="settingsApiRequestsToday">0</span> / <span id="settingsApiRequestsLimit">0</span></div>
                                        <div class="progress-bar mt-2">
                                            <div class="progress-fill" id="settingsApiRequestsProgress" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Documentation API</label>
                                        <p class="text-gray-400 text-sm">Accédez à la documentation complète de notre API.</p>
                                        <a href="#" class="btn-secondary mt-2 inline-block" target="_blank">
                                            <i class="fas fa-book mr-2"></i>
                                            Voir la documentation
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Billing Settings -->
                    <div id="billing-settings" class="settings-content">
                        <div class="settings-section-card">
                            <h4>Facturation et Abonnement</h4>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-lg font-medium">Votre Plan Actuel</label>
                                    <p class="text-xl font-bold cyber-font text-accent-color" id="billingCurrentPlan">Free</p>
                                    <p class="text-sm text-gray-400 mt-2">Prochaine date de facturation: N/A</p>
                                </div>
                                <button class="btn-primary" onclick="showPage('premium')">
                                    <i class="fas fa-arrow-up mr-2"></i>
                                    Mettre à niveau le plan
                                </button>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Historique des factures</label>
                                        <p class="text-sm text-gray-400">Consultez et téléchargez vos anciennes factures.</p>
                                    </div>
                                    <button class="btn-secondary" onclick="viewInvoices()">Voir les factures</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Méthodes de paiement</label>
                                        <p class="text-sm text-gray-400">Gérez vos informations de paiement.</p>
                                    </div>
                                    <button class="btn-secondary" onclick="managePaymentMethods()">Gérer les méthodes</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Settings -->
                    <div id="notifications-settings" class="settings-content">
                        <div class="settings-section-card">
                            <h4>Préférences de Notifications</h4>
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Notifications par Email</label>
                                        <p class="text-sm text-gray-400">Recevez des alertes importantes par email.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Notifications In-App</label>
                                        <p class="text-sm text-gray-400">Recevez des notifications directement dans l'application.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-lg font-medium">Alertes de Sécurité</label>
                                        <p class="text-sm text-gray-400">Soyez informé des activités suspectes sur votre compte.</p>
                                    </div>
                                    <label class="settings-toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="settings-toggle-slider round"></span>
                                    </label>
                                </div>
                                <button class="btn-primary">
                                    <i class="fas fa-save mr-2"></i>
                                    Sauvegarder les préférences
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="fixed top-20 right-4 w-80 glass-card p-4 hidden z-50">
        <div class="flex items-center justify-between mb-4">
            <h4 class="font-semibold cyber-font">Notifications</h4>
            <button onclick="toggleNotifications()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="space-y-3" id="notificationsList">
            <!-- Notifications will be dynamically loaded here -->
        </div>
    </div>

    <!-- Search Results Modal -->
    <div id="searchResultsModal" class="modal hidden">
        <div class="glass-card p-8 max-w-4xl w-full mx-4 search-results-modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold cyber-font" id="searchResultsTitle">Résultats de Recherche</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-white text-2xl p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="search-results-body" id="searchResultsBody">
                <!-- Results will be dynamically loaded here -->
            </div>

            <div class="pagination-controls" id="searchResultsPagination">
                <button id="prevPageBtn" onclick="changePage(-1)" disabled><i class="fas fa-chevron-left mr-2"></i>Précédent</button>
                <span id="currentPageInfo">Page 1 / 1</span>
                <button id="nextPageBtn" onclick="changePage(1)" disabled>Suivant<i class="fas fa-chevron-right ml-2"></i></button>
            </div>

            <div class="mt-6 text-center">
                <button class="btn-secondary" onclick="exportSearchResults()">
                    <i class="fas fa-download mr-2"></i>
                    Exporter en TXT
                </button>
            </div>
        </div>
    </div>

    <!-- Manage User Modal -->
    <div id="manageUserModal" class="modal hidden">
        <div class="glass-card p-6 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold" id="manageUserTitle">Gérer l'utilisateur</h3>
                <button id="closeManageUserBtn" class="text-gray-400 hover:text-white text-2xl p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium">Rôle</label>
                    <select id="manageUserRole" class="form-input w-full">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="founder">Founder</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium">Plan</label>
                    <select id="manageUserPlan" class="form-input w-full">
                        <option value="Free">Free</option>
                        <option value="Starter">Starter</option>
                        <option value="Professional">Professional</option>
                        <option value="Enterprise">Enterprise</option>
                    </select>
                </div>

                <div class="flex space-x-3 justify-end">
                    <button class="btn-secondary" id="manageCancelBtn">Annuler</button>
                    <button class="btn-primary" id="manageSaveBtn">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Founder account details
        const FOUNDER_EMAIL = 'thankoyes@gmail.com';
        const FOUNDER_PASSWORD = 'Vbnx1224';
        const FOUNDER_USERNAME = 'founder_admin';

        // User storage with some sample users
        let users = [
            { 
                email: FOUNDER_EMAIL, 
                password: FOUNDER_PASSWORD, 
                username: FOUNDER_USERNAME, 
                role: 'founder', 
                firstName: 'Founder', 
                lastName: 'Admin', 
                plan: 'Enterprise', // Founder has Enterprise plan
                createdAt: new Date('2024-01-01'),
                investigations: 500,
                apiRequests: 100000,
                dataCollected: 21 * 1024 * 1024, // 21 TB in MB
                activeAlerts: 5,
                retentionRate: 95,
                costPerRequest: 0.01,
                teamMembers: 4, // Real number of team members
                organization: 'BreachFR HQ'
            },
            {
                email: 'admin@breach.fr',
                password: 'admin123',
                username: 'admin_user',
                role: 'admin',
                firstName: 'Sarah',
                lastName: 'Martin',
                plan: 'Professional', // Admin has Professional plan
                createdAt: new Date('2024-01-15'),
                investigations: 120,
                apiRequests: 50000,
                dataCollected: 1200,
                activeAlerts: 3,
                retentionRate: 88,
                costPerRequest: 0.02,
                teamMembers: 3,
                organization: 'GlobalSec Solutions'
            },
            {
                email: 'user@example.com',
                password: 'user123',
                username: 'regular_user',
                role: 'user',
                firstName: 'Marc',
                lastName: 'Dubois',
                plan: 'Free', // Regular user has Free plan
                createdAt: new Date('2024-01-20'),
                investigations: 30,
                apiRequests: 5000,
                dataCollected: 200,
                activeAlerts: 1,
                retentionRate: 75,
                costPerRequest: 0.03,
                teamMembers: 1,
                organization: 'Independent Investigator'
            }
        ];

        let currentUser = null;
        let authToken = null; // Variable to store the authentication token
        let activityLogs = [];
        let notifications = [];
        let selectedPlan = { name: '', price: 0 };

        // Simulate real-time data
        let onlineUsers = 0;
        let totalInvestigations = 0;
        let totalApiRequests = 0;
        let totalDataCollected = 0;
        let totalActiveAlerts = 0;

        // Search Results Global Variables
        let currentSearchResults = [];
        let resultsPerPage = 5; // Number of results per page
        let currentPage = 1;

        function updateGlobalStats() {
            onlineUsers = currentUser ? 1 : 0; // Only 1 if logged in, 0 otherwise
            totalInvestigations = users.reduce((sum, user) => sum + user.investigations, 0);
            totalApiRequests = users.reduce((sum, user) => sum + user.apiRequests, 0);
            totalDataCollected = users.reduce((sum, user) => sum + user.dataCollected, 0);
            totalActiveAlerts = users.reduce((sum, user) => sum + user.activeAlerts, 0);

            document.getElementById('onlineUsersCount').textContent = `${onlineUsers} utilisateur(s) en ligne`;
            
            if (document.getElementById('totalUsersStat')) {
                document.getElementById('totalUsersStat').textContent = users.length + ''; // Display total registered users
                document.getElementById('usersGrowth').textContent = (Math.random() * 5 + 1).toFixed(0); // 1-5% growth
            }
            if (document.getElementById('totalRequestsStat')) {
                document.getElementById('totalRequestsStat').textContent = (totalApiRequests / 1000000).toFixed(1) + 'M+'; // Display in millions
                document.getElementById('requestsGrowth').textContent = (Math.random() * 10 + 5).toFixed(0); // 5-15% growth
            }
            
            // Update dashboard stats if visible
            if (document.getElementById('dashboard-overview') && document.getElementById('dashboard-overview').classList.contains('active')) {
                updateDashboardStats();
            }
        }

        // Fonction pour gérer les modes de recherche
        function toggleSearchMode(mode) {
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.search-mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ajouter la classe active au bouton cliqué
            event.target.closest('.search-mode-btn').classList.add('active');
            
            // Log de l'action
            logAction('Search Mode Changed', { mode: mode, user: currentUser ? currentUser.email : 'Anonymous' }, 'info');
            
            // Notification pour l'utilisateur
            showNotification(`Mode de recherche changé: ${mode}`, 'info');
        }

        function updateDashboardStats() {
            if (!currentUser) return;

            document.getElementById('dashboardTotalInvestigations').textContent = currentUser.investigations;
            document.getElementById('investigationsGrowth').textContent = (Math.random() * 5 + 1).toFixed(0);

            document.getElementById('dashboardApiRequests').textContent = currentUser.apiRequests.toLocaleString();
            document.getElementById('apiRequestsGrowth').textContent = (Math.random() * 10 + 5).toFixed(0);

            const successRate = (Math.random() * 2 + 97).toFixed(2); // 97-99%
            document.getElementById('dashboardSuccessRate').textContent = successRate + '%';
            document.getElementById('successRateGrowth').textContent = (Math.random() * 0.5 + 0.1).toFixed(1);

            const dataCollectedGB = (currentUser.dataCollected / (1024 * 1024)).toFixed(1); // Convert MB to GB
            document.getElementById('dashboardDataCollected').textContent = dataCollectedGB + 'TB'; // Display in TB
            document.getElementById('dataCollectedToday').textContent = (Math.random() * 100 + 50).toFixed(0); // 50-150MB today

            document.getElementById('dashboardActiveAlerts').textContent = currentUser.activeAlerts;
            document.getElementById('newAlerts').textContent = (Math.random() * 3).toFixed(0);

            document.getElementById('dashboardRetentionRate').textContent = currentUser.retentionRate + '%';
            document.getElementById('dashboardCostPerRequest').textContent = `€${currentUser.costPerRequest.toFixed(2)}`;
            document.getElementById('dashboardTeamMembers').textContent = currentUser.teamMembers;

            updateRecentActivity();
            updateApiManagementStats();
            updateAlertsList();
            updateInvestigationsList();
            updateReportsList();
            updateTeamMembersList();
        }

        function updateRecentActivity() {
            const recentActivityList = document.getElementById('recentActivityList');
            if (!recentActivityList) return;
            recentActivityList.innerHTML = '';

            const userActivity = activityLogs.filter(log => log.user === (currentUser ? currentUser.email : 'Anonymous')).slice(-4).reverse();
            if (userActivity.length === 0) {
                recentActivityList.innerHTML = '<div class="text-gray-400">Aucune activité récente.</div>';
                return;
            }

            userActivity.forEach(log => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                let status = 'Info';
                let statusColor = 'text-blue-400';
                if (log.action.includes('Success') || log.action.includes('Created') || log.action.includes('Updated')) {
                    status = 'Terminé';
                    statusColor = 'text-green-400';
                } else if (log.action.includes('Failed') || log.action.includes('Alert')) {
                    status = 'Urgent';
                    statusColor = 'text-red-400';
                } else if (log.action.includes('Progress') || log.action.includes('Scan')) {
                    status = 'En cours';
                    statusColor = 'text-yellow-400';
                }

                item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-semibold">${log.action}</div>
                            <div class="text-sm text-gray-400">${log.details.target || log.details.message || log.details.email || 'Détails non spécifiés'}</div>
                        </div>
                        <div class="text-sm ${statusColor}">${status}</div>
                    </div>
                `;
                recentActivityList.appendChild(item);
            });
        }

        function updateNotificationsDisplay() {
            const notificationsList = document.getElementById('notificationsList');
            const notificationCount = document.getElementById('notificationCount');
            if (!notificationsList || !notificationCount) return;

            notificationsList.innerHTML = '';
            notifications.forEach(notif => {
                const item = document.createElement('div');
                item.className = `p-3 rounded-lg ${notif.type === 'success' ? 'bg-green-900/50' : notif.type === 'error' ? 'bg-red-900/50' : notif.type === 'warning' ? 'bg-orange-900/50' : 'bg-blue-900/50'}`;
                item.innerHTML = `
                    <div class="font-semibold text-sm">${notif.title}</div>
                    <div class="text-xs text-gray-400">${notif.message}</div>
                    <div class="text-xs text-gray-400 mt-1">${new Date(notif.timestamp).toLocaleString()}</div>
                `;
                notificationsList.appendChild(item);
            });
            notificationCount.textContent = notifications.length;
        }

        // Gestionnaire global des boutons
        class ButtonManager {
            constructor() {
                this.init();
                this.addRippleEffect();
            }

            init() {
                // Initialisation des boutons au chargement de la page
                document.addEventListener('DOMContentLoaded', () => {
                    // Navigation principale
                    document.querySelectorAll('.nav-link-enhanced').forEach(link => {
                        const page = link.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                        if (page) {
                            link.removeAttribute('onclick');
                            link.setAttribute('data-page', page);
                            link.addEventListener('click', (e) => {
                                e.preventDefault();
                                this.handleNavigation(page);
                            });
                        }
                    });

                    // Bouton de recherche
                    const searchButton = document.getElementById('searchButton');
                    if (searchButton) {
                        searchButton.onclick = (e) => {
                            e.preventDefault();
                            this.handleSearch();
                        };
                    }

                    // Champ de recherche (Enter)
                    const searchInput = document.getElementById('homeSearchBarInput');
                    if (searchInput) {
                        searchInput.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                this.handleSearch();
                            }
                        });
                    }

                    // Boutons de mode de recherche
                    document.querySelectorAll('.search-mode-btn').forEach(btn => {
                        const mode = btn.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                        if (mode) {
                            btn.removeAttribute('onclick');
                            btn.setAttribute('data-mode', mode);
                            btn.onclick = () => this.toggleSearchMode(mode);
                        }
                    });

                    // Boutons d'authentification
                    const registerBtn = document.querySelector('.btn-auth-register');
                    if (registerBtn) {
                        registerBtn.onclick = () => this.showPage('register');
                    }

                    const authBtn = document.getElementById('authButton');
                    if (authBtn) {
                        authBtn.onclick = () => this.handleAuth();
                    }
                });
            }

            addRippleEffect() {
                // Effet de vague sur les boutons
                document.addEventListener('click', (e) => {
                    if (e.target.matches('button, .btn-primary, .btn-secondary, .nav-link-enhanced')) {
                        const ripple = document.createElement('span');
                        ripple.className = 'ripple';
                        
                        const rect = e.target.getBoundingClientRect();
                        const size = Math.max(rect.width, rect.height);
                        
                        ripple.style.width = ripple.style.height = size + 'px';
                        ripple.style.left = e.clientX - rect.left - size/2 + 'px';
                        ripple.style.top = e.clientY - rect.top - size/2 + 'px';
                        
                        e.target.appendChild(ripple);
                        
                        setTimeout(() => ripple.remove(), 600);
                    }
                });
            }

            async handleSearch() {
                try {
                    const searchInput = document.getElementById('homeSearchBarInput');
                    if (!searchInput) throw new Error('Champ de recherche non trouvé');

                    const query = searchInput.value.trim();
                    if (!query) {
                        showNotification('⚠️ Veuillez entrer un terme de recherche', 'warning');
                        return;
                    }

                    const searchButton = document.getElementById('searchButton');
                    if (searchButton) {
                        searchButton.disabled = true;
                        searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    }

                    await quickSearchHome();

                } catch (error) {
                    console.error('Erreur de recherche:', error);
                    showNotification('❌ Erreur: ' + error.message, 'error');
                } finally {
                    const searchButton = document.getElementById('searchButton');
                    if (searchButton) {
                        searchButton.disabled = false;
                        searchButton.innerHTML = '<i class="fas fa-search"></i>';
                    }
                }
            }

            toggleSearchMode(mode) {
                try {
                    const buttons = document.querySelectorAll('.search-mode-btn');
                    buttons.forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.getAttribute('data-mode') === mode) {
                            btn.classList.add('active');
                        }
                    });

                    const bulkSearch = document.getElementById('bulkSearch');
                    const automatedSearch = document.getElementById('automatedSearch');
                    
                    if (bulkSearch && automatedSearch) {
                        if (mode === 'bulk') {
                            bulkSearch.classList.remove('hidden');
                            automatedSearch.classList.add('hidden');
                        } else {
                            bulkSearch.classList.add('hidden');
                            automatedSearch.classList.remove('hidden');
                        }
                    }

                    showNotification(`Mode de recherche ${mode} activé`, 'info');
                } catch (error) {
                    console.error('Erreur de changement de mode:', error);
                    showNotification('❌ Erreur lors du changement de mode', 'error');
                }
            }

            handleAuth() {
                if (currentUser) {
                    // If logged in, open profile menu instead of logging out directly
                    toggleProfileMenu();
                } else {
                    // Redirection vers login
                    this.showPage('login');
                }
            }
        }

        // Instance du gestionnaire de boutons
        const buttonManager = new ButtonManager();

        // Logging function
        function logAction(action, details, type = 'info') {
            const logEntry = {
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                user: currentUser ? currentUser.email : 'Anonymous'
            };
            activityLogs.push(logEntry);
            console.log(`[LOG]`, logEntry);
            
            // Add to notifications if it's a significant event
            if (type !== 'info' || action.includes('Alert') || action.includes('Success') || action.includes('Created') || action.includes('Updated')) {
                notifications.push({
                    title: action,
                    message: details.message || details.target || details.email || 'Nouvelle activité',
                    type: type,
                    timestamp: new Date().toISOString()
                });
                updateNotificationsDisplay();
            }

            // Update logs display if currently visible
            if (document.getElementById('dashboard-logs') && document.getElementById('dashboard-logs').classList.contains('active')) {
                updateLogsDisplay();
            }
        }

        // Matrix background effect
        function createMatrixEffect() {
            const matrixBg = document.getElementById('matrixBg');
            if (!matrixBg) return; // Ensure element exists
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            
            // Clear existing chars to prevent duplicates on re-call
            matrixBg.innerHTML = ''; 

            for (let i = 0; i < 50; i++) {
                const char = document.createElement('div');
                char.className = 'matrix-char';
                char.textContent = chars[Math.floor(Math.random() * chars.length)];
                char.style.left = Math.random() * 100 + '%';
                char.style.animationDuration = (Math.random() * 3 + 2) + 's';
                char.style.animationDelay = Math.random() * 2 + 's';
                matrixBg.appendChild(char);
            }
        }

        // Page navigation with enhanced security
        function showPage(pageName) {
            console.log('Navigation vers:', pageName);

            // Sécurité : Vérifications d'accès
            if (pageName === 'dashboard' || pageName === 'settings-page') {
                if (!currentUser) {
                    showNotification('🔒 Veuillez vous connecter pour accéder à cette page.', 'warning');
                    logAction('Access Denied - Not Logged In', { page: pageName }, 'warning');
                    pageName = 'login';
                } else {
                    // Allow all authenticated users to view the dashboard; restrict actions inside the dashboard based on role
                    logAction('Access Granted', { user: currentUser.email, page: pageName }, 'info');
                }
            }

            try {
                // Cache toutes les pages
                document.querySelectorAll('.page, .page-section').forEach(page => {
                    page.classList.remove('active');
                    page.style.display = 'none';
                });

                // Affiche la page sélectionnée
                const selectedPage = document.getElementById(pageName);
                if (!selectedPage) {
                    throw new Error(`Page "${pageName}" non trouvée`);
                }

                selectedPage.classList.add('active');
                selectedPage.style.display = 'block';

                // Réinitialise le scroll
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // Met à jour la navigation en se basant sur data-page
                document.querySelectorAll('.nav-link-enhanced').forEach(link => {
                    const linkPage = link.getAttribute('data-page');
                    const isActive = linkPage === pageName;
                    link.classList.toggle('active', isActive);
                    if (isActive) link.setAttribute('aria-current', 'page');
                    else link.removeAttribute('aria-current');
                });

                // Gestion spécifique par page
                switch (pageName) {
                    case 'dashboard':
                        if (currentUser) {
                            updateDashboardUser();
                            showDashboardTab('overview');
                            updateDashboardStats();
                        }
                        break;
                        
                    case 'settings-page':
                        showSettingsPageTab('general-settings');
                        loadGeneralSettings();
                        break;
                        
                    case 'home':
                        const searchInput = document.getElementById('homeSearchBarInput');
                        if (searchInput) searchInput.focus();
                        break;
                }

                // Met à jour l'URL sans rechargement
                const url = new URL(window.location);
                url.hash = pageName;
                history.pushState({ page: pageName }, '', url);

                // Log de navigation
                logAction('Page Navigation', { from: currentPage, to: pageName }, 'info');
                currentPage = pageName;

            } catch (error) {
                console.error('Erreur de navigation:', error);
                showNotification('❌ Erreur lors de la navigation: ' + error.message, 'error');
                logAction('Navigation Error', { page: pageName, error: error.message }, 'error');
                
                // Fallback vers la page d'accueil en cas d'erreur
                if (pageName !== 'home') showPage('home');
            }
        }

        // Gestion de l'historique du navigateur
        window.addEventListener('popstate', function(event) {
            const targetPage = (event.state && event.state.page) || window.location.hash.slice(1) || 'home';
            showPage(targetPage);
        });

        // Dashboard navigation
        function showDashboardTab(tabName) {
            // Hide all dashboard tabs
            document.querySelectorAll('.dashboard-tab').forEach(tab => tab.classList.remove('active'));

            const targetTab = document.getElementById('dashboard-' + tabName);
            if (targetTab) targetTab.classList.add('active');

            // Update nav link active state using data-tab
            document.querySelectorAll('.dashboard-nav-link').forEach(link => {
                const linkTab = link.getAttribute('data-tab') || link.getAttribute('data-page');
                link.classList.remove('text-white', 'bg-blue-600');
                link.classList.add('text-gray-300');
                if (linkTab === tabName) {
                    link.classList.add('text-white', 'bg-blue-600');
                    link.classList.remove('text-gray-300');
                }
            });

            // Special handling for certain tabs
            if (tabName === 'users') {
                updateUsersList();
            } else if (tabName === 'logs') {
                updateLogsDisplay();
            } else if (tabName === 'profile') {
                updateProfileForm();
            } else if (tabName === 'api-management') {
                updateApiManagementStats();
            } else if (tabName === 'alerts') {
                updateAlertsList();
            } else if (tabName === 'investigations') {
                updateInvestigationsList();
            } else if (tabName === 'reports') {
                updateReportsList();
            } else if (tabName === 'team') {
                updateTeamMembersList();
            }
        }

        // Update dashboard user info
        function updateDashboardUser() {
            if (currentUser) {
                document.getElementById('dashboardUserName').textContent = currentUser.firstName + ' ' + currentUser.lastName;
                document.getElementById('dashboardUserPlan').textContent = currentUser.plan;
                
                // Show user management option for founder
                const userMgmtOption = document.getElementById('userManagementOption');
                if (currentUser.role === 'founder') {
                    userMgmtOption.style.display = 'block';
                } else {
                    userMgmtOption.style.display = 'none';
                }
            }
        }

        // Profile menu toggle (dashboard and navbar)
        function toggleProfileMenu(anchorEl) {
            // Dashboard profile menu (if present)
            const dashMenu = document.getElementById('profileMenu');
            if (dashMenu) dashMenu.classList.toggle('show');

            // Navbar dropdown menu
            const navMenu = document.getElementById('navProfileMenu');
            if (!navMenu) return;

            const isHidden = navMenu.classList.contains('hidden');
            if (isHidden) {
                // Position the menu under the provided anchor element if available
                if (anchorEl && anchorEl.getBoundingClientRect) {
                    const rect = anchorEl.getBoundingClientRect();
                    // If menu hidden, temporarily make it measurable
                    const wasHidden = navMenu.classList.contains('hidden');
                    if (wasHidden) {
                        navMenu.style.visibility = 'hidden';
                        navMenu.classList.remove('hidden');
                        navMenu.style.display = 'block';
                    }
                    const menuWidth = navMenu.offsetWidth || 200;
                    // compute left so menu is centered under the anchor if possible
                    const left = Math.max(8, rect.left + (rect.width / 2) - (menuWidth / 2));
                    navMenu.style.left = `${left}px`;
                    // place slightly below the anchor
                    const top = rect.bottom + 8 + window.scrollY;
                    navMenu.style.top = `${top}px`;
                    // make it absolute positioned relative to page
                    navMenu.style.position = 'absolute';
                    if (wasHidden) {
                        // restore hidden state until we toggle visibly
                        navMenu.classList.add('hidden');
                        navMenu.style.display = '';
                        navMenu.style.visibility = '';
                    }
                } else {
                    navMenu.style.position = '';
                    navMenu.style.left = '';
                    navMenu.style.top = '';
                }
                navMenu.classList.remove('hidden');
                // small open animation
                navMenu.classList.add('animate-open');
                setTimeout(() => navMenu.classList.remove('animate-open'), 220);

                // Add click outside listener to close
                setTimeout(() => {
                    document.addEventListener('click', _closeNavProfileOnOutside);
                }, 0);
            } else {
                navMenu.classList.add('hidden');
                document.removeEventListener('click', _closeNavProfileOnOutside);
            }

            function _closeNavProfileOnOutside(e) {
                if (!navMenu) return;
                if (navMenu.contains(e.target)) return;
                if (anchorEl && anchorEl.contains(e.target)) return;
                navMenu.classList.add('hidden');
                document.removeEventListener('click', _closeNavProfileOnOutside);
            }
        }

        // Authentication handling (fixed: open profile menu instead of immediate logout)
        function handleAuthButton() {
            const authButton = document.getElementById('authButton');
            if (currentUser) {
                // Open profile menu under the auth button instead of logging out
                try { toggleProfileMenu(authButton); } catch (e) { console.error(e); }
            } else {
                showPage('login');
            }
        }

        function updateAuthButton() {
            const authButton = document.getElementById('authButton');
            const registerBtn = document.querySelector('.btn-auth-register');
            const startBtn = document.getElementById('startFreeBtn');
            const navProfileMenu = document.getElementById('navProfileMenu');
            if (currentUser) {
                authButton.innerHTML = `<i class="fas fa-user mr-2"></i>${currentUser.firstName}`;
                // Show dropdown instead of immediate redirect
                authButton.onclick = (e) => {
                    e.stopPropagation();
                    toggleProfileMenu(authButton);
                };
                // Masquer le bouton d'inscription si l'utilisateur est connecté
                if (registerBtn) registerBtn.style.display = 'none';
                // Ajuster le bouton "Démarrer" : si pas de plan -> renvoyer vers premium, sinon vers outils
                if (startBtn) {
                    if (currentUser.plan && currentUser.plan.toLowerCase() !== 'free') {
                        startBtn.onclick = () => showPage('tools');
                        startBtn.setAttribute('data-page', 'tools');
                    } else {
                        // connecté mais sans plan
                        startBtn.onclick = () => showPage('premium');
                        startBtn.setAttribute('data-page', 'premium');
                    }
                }
                // Show nav profile menu and wire actions
                if (navProfileMenu) navProfileMenu.classList.add('hidden');
                const onlineDot = document.getElementById('authOnlineDot');
                if (onlineDot) onlineDot.classList.remove('hidden');
                const navView = document.getElementById('navProfileView');
                const navTools = document.getElementById('navProfileTools');
                const navSettings = document.getElementById('navProfileSettings');
                const navLogout = document.getElementById('navProfileLogout');
                if (navView) navView.onclick = () => { showPage('dashboard'); toggleProfileMenu(); showDashboardTab('profile'); };
                if (navTools) navTools.onclick = () => { showPage('tools'); toggleProfileMenu(); };
                if (navSettings) navSettings.onclick = () => { showPage('settings-page'); toggleProfileMenu(); };
                if (navLogout) navLogout.onclick = () => { confirmAndLogout(); toggleProfileMenu(); };
                // Quick logout button (next to username)
                const authLogoutBtn = document.getElementById('authLogoutBtn');
                if (authLogoutBtn) {
                    authLogoutBtn.classList.remove('hidden');
                    authLogoutBtn.onclick = () => { confirmAndLogout(); };
                }
                // Set role badge
                const navRole = document.getElementById('navProfileRole');
                if (navRole) {
                    const roleText = (currentUser.role || 'user').toString();
                    navRole.textContent = `Rôle: ${roleText.charAt(0).toUpperCase() + roleText.slice(1)}`;
                    if (currentUser.role === 'founder' || currentUser.role === 'admin') {
                        navRole.style.color = '#fbbf24'; // amber for admins
                    } else {
                        navRole.style.color = 'var(--text-secondary)';
                    }
                }
            } else {
                authButton.innerHTML = 'Connexion';
                authButton.onclick = () => showPage('login');
                if (registerBtn) registerBtn.style.display = 'inline-block';
                if (startBtn) startBtn.onclick = () => showPage('register');
                if (navProfileMenu) navProfileMenu.classList.add('hidden');
                const onlineDot = document.getElementById('authOnlineDot');
                if (onlineDot) onlineDot.classList.add('hidden');
                const authLogoutBtn = document.getElementById('authLogoutBtn');
                if (authLogoutBtn) authLogoutBtn.classList.add('hidden');
            }

            // --- Role-based visibility for API management ---
            try {
                const apiTabLink = document.querySelector('.dashboard-nav-link[data-tab="api-management"]');
                const genBtn = document.querySelector('#dashboard-api-management .btn-primary');
                const copyBtn = document.querySelector('#currentApiKey')?.nextElementSibling; // copy button next to input
                const logsBtn = document.querySelector('#dashboard-api-management .btn-secondary');
                const allowed = currentUser && (['owner'].includes((currentUser.role||'').toLowerCase()));
                if (apiTabLink) apiTabLink.style.display = allowed ? 'flex' : 'none';
                if (genBtn) genBtn.disabled = !allowed;
                if (copyBtn) copyBtn.disabled = !allowed;
                if (logsBtn) logsBtn.disabled = !allowed;
                if (!allowed) {
                    if (genBtn) genBtn.title = 'Réservé au propriétaire du compte';
                    if (copyBtn) copyBtn.title = 'Réservé au propriétaire du compte';
                    if (logsBtn) logsBtn.title = 'Réservé au propriétaire du compte';
                } else {
                    if (genBtn) genBtn.title = '';
                    if (copyBtn) copyBtn.title = '';
                    if (logsBtn) logsBtn.title = '';
                }
            } catch (e) {
                console.error('API controls role patch failed', e);
            }

            // SÉCURITÉ: Masquer/Afficher les liens de navigation selon le rôle
            updateNavigationVisibility();
        }

        // NOUVELLE FONCTION: Gestion de la visibilité de la navigation
        function updateNavigationVisibility() {
            // Use data-page attributes instead of inline onclick selectors
            const dashboardLink = document.querySelector('.nav-link-enhanced[data-page="dashboard"]');
            const settingsLink = document.querySelector('.nav-link-enhanced[data-page="settings-page"]');

            // Dashboard is admin/founder only
            if (currentUser && (currentUser.role === 'founder' || currentUser.role === 'admin')) {
                if (dashboardLink) dashboardLink.style.display = 'inline-block';
            } else {
                if (dashboardLink) dashboardLink.style.display = 'none';
            }

            // Settings should be available to any logged-in user
            if (currentUser) {
                if (settingsLink) settingsLink.style.display = 'inline-block';
            } else {
                if (settingsLink) settingsLink.style.display = 'none';
            }

            // Ensure other core links stay visible
            const homeLink = document.querySelector('.nav-link-enhanced[data-page="home"]');
            const toolsLink = document.querySelector('.nav-link-enhanced[data-page="tools"]');
            const premiumLink = document.querySelector('.nav-link-enhanced[data-page="premium"]');

            if (homeLink) homeLink.style.display = 'inline-block';
            if (toolsLink) toolsLink.style.display = 'inline-block';
            if (premiumLink) premiumLink.style.display = 'inline-block';
        }

        // Logout function améliorée
        function logout() {
            if (currentUser) {
                logAction('User Logout', { 
                    email: currentUser.email, 
                    role: currentUser.role,
                    sessionDuration: authToken ? 'Active session' : 'No active session',
                    logoutTime: new Date().toISOString()
                }, 'info');
                
                showNotification(`👋 Au revoir ${currentUser.firstName}! À bientôt.`, 'info');
            }
            
            // Utiliser la fonction centralisée de nettoyage
            clearUserSession();
            // Extra safety: clear all storage to avoid any leftover session data
            try {
                localStorage.clear();
            } catch (e) { console.error('localStorage.clear failed', e); }
            try {
                sessionStorage.clear();
            } catch (e) { console.error('sessionStorage.clear failed', e); }

            showPage('home'); // Redirect to home after logout
            // Force a full reload to ensure no residual session state remains
            try {
                setTimeout(() => { if (typeof window !== 'undefined' && window.location) window.location.reload(); }, 250);
            } catch (e) { /* ignore reload errors */ }
        }

        // Confirmation wrapper for logout
        function confirmAndLogout() {
            try {
                const ok = confirm('Voulez-vous vraiment vous déconnecter ?');
                if (ok) {
                    logout();
                }
            } catch (e) {
                // In environments without confirm (rare), fallback to logout
                logout();
            }
        }

        // New Settings Page functions
        function showSettingsPageTab(tabName) {
            document.querySelectorAll('.settings-main-content .settings-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            document.querySelectorAll('.settings-tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.settings-tab-button[onclick="showSettingsPageTab('${tabName}')"]`).classList.add('active');

            // Load specific settings data when tab is shown
            if (tabName === 'profile-settings') {
                loadProfileSettings();
            } else if (tabName === 'api-settings') {
                loadApiSettings();
            } else if (tabName === 'billing-settings') {
                loadBillingSettings();
            }
        }

        function loadGeneralSettings() {
            const matrixBgToggle = document.getElementById('settingsPageMatrixBg');
            const cyberGridToggle = document.getElementById('settingsPageCyberGrid');
            const cyberDecorationsToggle = document.getElementById('settingsPageCyberDecorations');

            // Retrieve saved preferences or use defaults
            const matrixEnabled = localStorage.getItem('matrixBgEnabled') !== 'false';
            const gridEnabled = localStorage.getItem('cyberGridEnabled') !== 'false';
            const decoEnabled = localStorage.getItem('cyberDecorationsEnabled') !== 'false';

            matrixBgToggle.checked = matrixEnabled;
            cyberGridToggle.checked = gridEnabled;
            cyberDecorationsToggle.checked = decoEnabled;

            // Apply settings immediately
            document.getElementById('matrixBg').style.display = matrixEnabled ? 'block' : 'none';
            document.getElementById('cyberGrid').style.display = gridEnabled ? 'block' : 'none';
            
            const cyberDecos = document.querySelectorAll('[id^="cyberDeco"]');
            cyberDecos.forEach(deco => {
                deco.style.display = decoEnabled ? 'block' : 'none';
            });
        }

        function saveGeneralSettings() {
            const matrixBgToggle = document.getElementById('settingsPageMatrixBg');
            const cyberGridToggle = document.getElementById('settingsPageCyberGrid');
            const cyberDecorationsToggle = document.getElementById('settingsPageCyberDecorations');

            const matrixEnabled = matrixBgToggle.checked;
            const gridEnabled = cyberGridToggle.checked;
            const decoEnabled = cyberDecorationsToggle.checked;

            localStorage.setItem('matrixBgEnabled', matrixEnabled);
            localStorage.setItem('cyberGridEnabled', gridEnabled);
            localStorage.setItem('cyberDecorationsEnabled', decoEnabled);

            // Apply settings
            document.getElementById('matrixBg').style.display = matrixEnabled ? 'block' : 'none';
            document.getElementById('cyberGrid').style.display = gridEnabled ? 'block' : 'none';
            
            const cyberDecos = document.querySelectorAll('[id^="cyberDeco"]');
            cyberDecos.forEach(deco => {
                deco.style.display = decoEnabled ? 'block' : 'none';
            });

            showNotification('Paramètres généraux sauvegardés!', 'success');
            logAction('Settings Saved', { user: currentUser ? currentUser.email : 'Anonymous', settings: { matrixEnabled, gridEnabled, decoEnabled } }, 'success');
        }

        function loadProfileSettings() {
            if (currentUser) {
                document.getElementById('settingsPageFullName').value = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('settingsPageEmail').value = currentUser.email;
                document.getElementById('settingsPageOrganization').value = currentUser.organization || '';
                document.getElementById('settingsPageRole').value = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            }
        }

        function saveProfileSettings() {
            const fullName = document.getElementById('settingsPageFullName').value;
            const organization = document.getElementById('settingsPageOrganization').value;
            
            if (currentUser && fullName) {
                const [firstName, ...lastNameParts] = fullName.split(' ');
                currentUser.firstName = firstName;
                currentUser.lastName = lastNameParts.join(' ');
                currentUser.organization = organization;
                
                updateDashboardUser();
                logAction('Profile Settings Updated', { email: currentUser.email }, 'success');
                showNotification('Paramètres de profil mis à jour', 'success');
            }
        }

        function loadApiSettings() {
            if (currentUser) {
                const apiKey = localStorage.getItem(`apiKey_${currentUser.email}`) || 'BFR-API-KEY-XXXXXXXXXXXXXX';
                document.getElementById('settingsPageApiKey').value = apiKey;

                const apiRequestsToday = currentUser.apiRequestsToday || 0;
                const apiRequestsLimit = getApiLimitForPlan(currentUser.plan);
                document.getElementById('settingsApiRequestsToday').textContent = apiRequestsToday.toLocaleString();
                document.getElementById('settingsApiRequestsLimit').textContent = apiRequestsLimit.toLocaleString();
                const progress = (apiRequestsToday / apiRequestsLimit) * 100;
                document.getElementById('settingsApiRequestsProgress').style.width = `${progress}%`;
            }
        }

        function loadBillingSettings() {
            if (currentUser) {
                document.getElementById('billingCurrentPlan').textContent = currentUser.plan;
                // Simulate next billing date
                const nextBillingDate = new Date();
                nextBillingDate.setMonth(nextBillingDate.getMonth() + 1);
                document.querySelector('#billing-settings p.text-gray-400').textContent = `Prochaine date de facturation: ${nextBillingDate.toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' })}`;
            }
        }

        function getApiLimitForPlan(plan) {
            switch (plan) {
                case 'Starter': return 1000;
                case 'Professional': return 10000;
                case 'Enterprise': return 9999999; // Effectively unlimited
                default: return 100; // Free plan limit
            }
        }

        // Notifications panel
        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('hidden');
        }

        // Users management functions
        function updateUsersList() {
            const usersList = document.getElementById('usersList');
            if (!usersList) return;
            usersList.innerHTML = '';

            users.forEach((user, index) => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                userCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/b7cf5149-dd7b-4690-bc53-850445ca61a4.png" alt="Avatar of ${user.firstName} ${user.lastName}, ${user.role} user" class="w-10 h-10 rounded-full">
                            <div>
                                <h4 class="font-semibold">${user.firstName} ${user.lastName}</h4>
                                <p class="text-sm text-gray-400">${user.email}</p>
                                <p class="text-xs text-gray-500">Créé le: ${user.createdAt.toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="role-badge role-${user.role}">${user.role}</span>
                            <span class="text-sm text-gray-400">${user.plan}</span>
                            <div class="flex space-x-2">
                                <button class="btn-secondary" onclick="editUser(${index})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" onclick="deleteUser(${index})" ${user.role === 'founder' ? 'disabled' : ''}>
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="btn-secondary manage-user-btn" data-user-index="${index}">
                                    <i class="fas fa-cog mr-1"></i> Gérer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                usersList.appendChild(userCard);
            });
        }

        function refreshUserList() {
            updateUsersList();
            showNotification('Liste des utilisateurs actualisée', 'info');
        }

        function createUser() {
            // SÉCURITÉ: Seuls les founders peuvent créer des utilisateurs
            if (!currentUser || currentUser.role !== 'founder') {
                showNotification('🚫 Seuls les fondateurs peuvent créer des utilisateurs.', 'error');
                logAction('Unauthorized User Creation Attempt', { user: currentUser ? currentUser.email : 'Anonymous', role: currentUser ? currentUser.role : 'None' }, 'warning');
                return;
            }

            // Simple user creation dialog
            const email = prompt('Email du nouvel utilisateur:');
            const password = prompt('Mot de passe:');
            const firstName = prompt('Prénom:');
            const lastName = prompt('Nom:');
            
            if (email && password && firstName && lastName) {
                const newUser = {
                    email: email,
                    password: password,
                    username: email.split('@')[0],
                    role: 'user',
                    firstName: firstName,
                    lastName: lastName,
                    plan: 'Free',
                    createdAt: new Date(),
                    investigations: 0,
                    apiRequests: 0,
                    dataCollected: 0,
                    activeAlerts: 0,
                    retentionRate: 0,
                    costPerRequest: 0,
                    teamMembers: 1,
                    organization: ''
                };
                
                users.push(newUser);
                logAction('User Created', { email: email, createdBy: currentUser.email, createdByRole: currentUser.role }, 'success');
                updateUsersList();
                showNotification('✅ Utilisateur créé avec succès', 'success');
            }
        }

        function editUser(index) {
            // SÉCURITÉ: Seuls les founders peuvent modifier des utilisateurs
            if (!currentUser || currentUser.role !== 'founder') {
                showNotification('🚫 Seuls les fondateurs peuvent modifier des utilisateurs.', 'error');
                logAction('Unauthorized User Edit Attempt', { user: currentUser ? currentUser.email : 'Anonymous', role: currentUser ? currentUser.role : 'None' }, 'warning');
                return;
            }

            const user = users[index];
            const newEmail = prompt('Email:', user.email);
            const newFirstName = prompt('Prénom:', user.firstName);
            const newLastName = prompt('Nom:', user.lastName);
            
            if (newEmail && newFirstName && newLastName) {
                user.email = newEmail;
                user.firstName = newFirstName;
                user.lastName = newLastName;
                
                logAction('User Updated', { email: user.email, updatedBy: currentUser.email, updatedByRole: currentUser.role }, 'success');
                updateUsersList();
                showNotification('✅ Utilisateur mis à jour', 'success');
            }
        }

        function deleteUser(index) {
            // SÉCURITÉ: Seuls les founders peuvent supprimer des utilisateurs
            if (!currentUser || currentUser.role !== 'founder') {
                showNotification('🚫 Seuls les fondateurs peuvent supprimer des utilisateurs.', 'error');
                logAction('Unauthorized User Deletion Attempt', { user: currentUser ? currentUser.email : 'Anonymous', role: currentUser ? currentUser.role : 'None' }, 'warning');
                return;
            }

            const user = users[index];
            if (user.role === 'founder') {
                showNotification('🚫 Impossible de supprimer le compte fondateur', 'error');
                return;
            }
            
            if (confirm(`⚠️ Êtes-vous sûr de vouloir supprimer ${user.firstName} ${user.lastName}?\n\nCette action est irréversible.`)) {
                logAction('User Deleted', { email: user.email, deletedBy: currentUser.email, deletedByRole: currentUser.role }, 'warning');
                users.splice(index, 1);
                updateUsersList();
                showNotification('⚠️ Utilisateur supprimé', 'warning');
            }
        }

        // Update logs display
        function updateLogsDisplay() {
            const logsContainer = document.getElementById('activityLogs');
            if (!logsContainer) return;
            logsContainer.innerHTML = '';

            const recentLogs = activityLogs.slice(-20).reverse(); // Show last 20 logs
            
            recentLogs.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.className = 'activity-item';
                logEntry.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-semibold">${log.action}</div>
                            <div class="text-sm text-gray-400">${JSON.stringify(log.details)}</div>
                            <div class="text-xs text-gray-500">Par: ${log.user}</div>
                        </div>
                        <div class="text-xs text-gray-400">${new Date(log.timestamp).toLocaleString()}</div>
                    </div>
                `;
                logsContainer.appendChild(logEntry);
            });
        }

        function clearLogs() {
            if (confirm('Êtes-vous sûr de vouloir vider tous les logs?')) {
                activityLogs = [];
                updateLogsDisplay();
                logAction('Logs Cleared', { clearedBy: currentUser ? currentUser.email : 'Unknown' }, 'info');
                showNotification('Logs vidés', 'info');
            }
        }

        // Profile form update
        function updateProfileForm() {
            if (currentUser) {
                document.getElementById('profileFullName').value = currentUser.firstName + ' ' + currentUser.lastName;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileOrganization').value = currentUser.organization || '';
            }
        }

        function saveProfile() {
            const fullName = document.getElementById('profileFullName').value;
            const email = document.getElementById('profileEmail').value;
            const organization = document.getElementById('profileOrganization').value;
            
            if (currentUser && fullName && email) {
                const [firstName, ...lastNameParts] = fullName.split(' ');
                currentUser.firstName = firstName;
                currentUser.lastName = lastNameParts.join(' ');
                currentUser.email = email;
                currentUser.organization = organization;
                
                updateDashboardUser();
                logAction('Profile Updated', { email: email }, 'success');
                showNotification('Profil mis à jour', 'success');
            }
        }

        // Dashboard action buttons
        function exportData() {
            logAction('Data Export', { user: currentUser ? currentUser.email : null }, 'info');
            showNotification('Export des données en cours...', 'info');
            // Simulate export process
            setTimeout(() => {
                showNotification('Données exportées avec succès', 'success');
            }, 2000);
        }

        function createInvestigation() {
            const target = prompt('Cible de l\'investigation:');
            if (target) {
                if (currentUser) {
                    currentUser.investigations = (currentUser.investigations || 0) + 1;
                    updateDashboardStats();
                }
                logAction('Investigation Created', { target: target, user: currentUser ? currentUser.email : null }, 'success');
                showNotification(`Investigation créée pour: ${target}`, 'success');
                updateInvestigationsList();
            }
        }

        function generateReport() {
            logAction('Report Generated', { user: currentUser ? currentUser.email : null }, 'info');
            showNotification('Génération du rapport en cours...', 'info');
            setTimeout(() => {
                showNotification('Rapport généré avec succès', 'success');
                updateReportsList();
            }, 3000);
        }

        async function inviteTeamMember() {
            const email = prompt('Email du membre à inviter:');
            if (!email) return;

            // Validation de l'email
            const emailValidation = validateEmail(email);
            if (!emailValidation.valid) {
                showNotification(`❌ ${emailValidation.message}`, 'error');
                return;
            }

            if (!currentUser) {
                showNotification('❌ Vous devez être connecté pour inviter des membres', 'error');
                return;
            }

            const message = prompt('Message personnalisé (optionnel):') || '';
            
            try {
                showNotification('📧 Envoi de l\'invitation par email...', 'info');
                
                const response = await fetch('/api/team/invite', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ 
                        email: email,
                        inviterName: `${currentUser.firstName} ${currentUser.lastName}`,
                        companyName: currentUser.organization || 'BREACHFR',
                        message: message
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`✅ Invitation envoyée avec succès à ${email}!`, 'success');
                    logAction('Team Member Invited (Real Email)', { 
                        email: email, 
                        invitedBy: currentUser.email,
                        messageId: data.messageId,
                        invitationToken: data.invitationToken
                    }, 'success');
                    
                    // Mettre à jour la liste des membres si visible
                    if (document.getElementById('dashboard-team').classList.contains('active')) {
                        updateTeamMembersList();
                    }
                } else {
                    showNotification(`❌ Erreur lors de l'envoi: ${data.message}`, 'error');
                    logAction('Team Member Invitation Failed', { 
                        email: email, 
                        invitedBy: currentUser.email,
                        error: data.message
                    }, 'error');
                }
            } catch (error) {
                console.error('Error sending team invitation:', error);
                showNotification('❌ Erreur de connexion lors de l\'envoi de l\'invitation', 'error');
                logAction('Team Member Invitation Network Error', { 
                    email: email, 
                    invitedBy: currentUser.email,
                    error: error.message
                }, 'error');
            }
        }

        function createAlert() {
            const alertMessage = prompt('Message de la nouvelle alerte:');
            if (alertMessage) {
                if (currentUser) {
                    currentUser.activeAlerts = (currentUser.activeAlerts || 0) + 1;
                    updateDashboardStats();
                }
                logAction('New Alert', { message: alertMessage, createdBy: currentUser ? currentUser.email : null }, 'warning');
                showNotification(`Alerte créée: "${alertMessage}"`, 'warning');
                updateAlertsList();
            }
        }

        function generateNewApiKey() {
            // SÉCURITÉ: Vérifier les permissions
            if (!currentUser) {
                showNotification('🔒 Vous devez être connecté pour générer une clé API.', 'error');
                return;
            }
            
            if (!currentUser || (currentUser.role || '').toLowerCase() !== 'owner') {
                showNotification('🚫 Seul le propriétaire du compte peut générer une clé API.', 'error');
                logAction('Unauthorized API Key Generation Attempt', { user: currentUser ? currentUser.email : null, role: currentUser ? currentUser.role : null }, 'warning');
                return;
            }

            const newKey = 'BFR-API-KEY-' + Math.random().toString(36).substring(2, 15).toUpperCase();
            document.getElementById('currentApiKey').value = newKey;
            if (document.getElementById('settingsPageApiKey')) {
                document.getElementById('settingsPageApiKey').value = newKey;
            }
            if (currentUser) {
                localStorage.setItem(`apiKey_${currentUser.email}`, newKey);
            }
            logAction('API Key Generated', { newKey: newKey, user: currentUser.email, role: currentUser.role }, 'success');
            showNotification('✅ Nouvelle clé API générée avec succès!', 'success');
            updateApiManagementStats();
        }

        function copyApiKey() {
            if (!currentUser || (currentUser.role || '').toLowerCase() !== 'owner') {
                showNotification('🚫 Accès refusé : uniquement le propriétaire du compte peut copier la clé API.', 'error');
                return;
            }
            const apiKeyInput = document.getElementById('currentApiKey') || document.getElementById('settingsPageApiKey');
            if (!apiKeyInput) return;
            apiKeyInput.select();
            apiKeyInput.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            showNotification('Clé API copiée dans le presse-papiers!', 'info');
        }

        function viewApiLogs() {
            if (!currentUser || (currentUser.role || '').toLowerCase() !== 'owner') {
                showNotification('🚫 Accès refusé : seuls les propriétaires peuvent consulter les logs API.', 'error');
                return;
            }
            showNotification('Affichage des logs API (fonctionnalité à implémenter)', 'info');
            // In a real app, this would open a modal or navigate to a detailed log view
        }

        function updateApiManagementStats() {
            if (!currentUser) return;
            const apiRequestsToday = currentUser.apiRequestsToday || 0;
            const apiRequestsLimit = getApiLimitForPlan(currentUser.plan);

            document.getElementById('apiRequestsToday').textContent = apiRequestsToday.toLocaleString();
            document.getElementById('apiRequestsLimit').textContent = apiRequestsLimit.toLocaleString();
            const progress = (apiRequestsToday / apiRequestsLimit) * 100;
            document.getElementById('apiRequestsProgress').style.width = `${progress}%`;

            if (document.getElementById('settingsApiRequestsToday')) {
                document.getElementById('settingsApiRequestsToday').textContent = apiRequestsToday.toLocaleString();
                document.getElementById('settingsApiRequestsLimit').textContent = apiRequestsLimit.toLocaleString();
                document.getElementById('settingsApiRequestsProgress').style.width = `${progress}%`;
            }
            // Simulate API errors
            document.getElementById('apiErrors').textContent = Math.floor(Math.random() * 5);
        }

        function updateAlertsList() {
            const alertsList = document.getElementById('alertsList');
            if (!alertsList) return;
            alertsList.innerHTML = '';

            const userAlerts = activityLogs.filter(log => log.user === (currentUser ? currentUser.email : 'Anonymous') && log.action.includes('Alert')).reverse();
            if (userAlerts.length === 0) {
                alertsList.innerHTML = '<div class="text-gray-400">Aucune alerte active.</div>';
                return;
            }

            userAlerts.forEach(alert => {
                const item = document.createElement('div');
                item.className = 'glass-card p-4';
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold text-lg text-red-400">Alerte: ${alert.action.replace('New Alert: ', '')}</h4>
                            <p class="text-gray-400 text-sm">${alert.details.message}</p>
                            <p class="text-xs text-gray-500 mt-1">Détectée le: ${new Date(alert.timestamp).toLocaleDateString()}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="btn-danger">
                                <i class="fas fa-exclamation-circle mr-2"></i>
                                Agir
                            </button>
                            <button class="btn-secondary">
                                <i class="fas fa-times mr-2"></i>
                                Ignorer
                            </button>
                        </div>
                    </div>
                `;
                alertsList.appendChild(item);
            });
        }

        function updateInvestigationsList() {
            const investigationsList = document.getElementById('investigationsList');
            if (!investigationsList) return;
            investigationsList.innerHTML = '';

            const userInvestigations = activityLogs.filter(log => log.user === (currentUser ? currentUser.email : 'Anonymous') && log.action.includes('Investigation Created')).reverse();
            if (userInvestigations.length === 0) {
                investigationsList.innerHTML = '<div class="text-gray-400">Aucune investigation en cours.</div>';
                return;
            }

            userInvestigations.forEach((investigation, index) => {
                const item = document.createElement('div');
                item.className = 'glass-card p-6';
                const status = index % 2 === 0 ? 'Terminé' : 'En cours';
                const statusColor = index % 2 === 0 ? 'bg-green-600' : 'bg-yellow-600';
                const progress = index % 2 === 0 ? 100 : Math.floor(Math.random() * 50) + 30; // 30-80%

                item.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold">#IN-${new Date(investigation.timestamp).getFullYear()}-${String(index + 1).padStart(3, '0')}</h4>
                            <p class="text-gray-400 text-sm">Investigation de ${investigation.details.target}</p>
                        </div>
                        <span class="px-3 py-1 ${statusColor} text-white text-xs rounded-full">${status}</span>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-gray-400">Cible:</span>
                            <span class="text-white ml-2">${investigation.details.target}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Créée le:</span>
                            <span class="text-white ml-2">${new Date(investigation.timestamp).toLocaleDateString()}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">Résultats:</span>
                            <span class="text-white ml-2">${Math.floor(Math.random() * 100) + 20} éléments trouvés</span>
                        </div>
                    </div>
                    ${status === 'En cours' ? `
                    <div class="mt-4">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>` : ''}
                    <div class="flex space-x-2 mt-4">
                        <button class="btn-primary">Voir rapport</button>
                        <button class="btn-secondary">Télécharger</button>
                    </div>
                `;
                investigationsList.appendChild(item);
            });
        }

        function updateReportsList() {
            const reportsList = document.getElementById('reportsList');
            if (!reportsList) return;
            reportsList.innerHTML = '';

            const userReports = activityLogs.filter(log => log.user === (currentUser ? currentUser.email : 'Anonymous') && log.action.includes('Report Generated')).reverse();
            if (userReports.length === 0) {
                reportsList.innerHTML = '<div class="text-gray-400">Aucun rapport généré.</div>';
                return;
            }

            userReports.forEach((report, index) => {
                const item = document.createElement('div');
                item.className = 'glass-card p-4';
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold">Rapport #${new Date(report.timestamp).getFullYear()}-${String(index + 1).padStart(3, '0')} - ${new Date(report.timestamp).toLocaleDateString()}</h4>
                            <p class="text-gray-400 text-sm">Synthèse de l'activité</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="btn-secondary">
                                <i class="fas fa-eye mr-2"></i>
                                Voir
                            </button>
                            <button class="btn-secondary">
                                <i class="fas fa-download mr-2"></i>
                                PDF
                            </button>
                        </div>
                    </div>
                `;
                reportsList.appendChild(item);
            });
        }

        function updateTeamMembersList() {
            const teamMembersList = document.getElementById('teamMembersList');
            if (!teamMembersList) return;
            teamMembersList.innerHTML = '';

            // For simplicity, show all users in the "team" tab for now
            users.forEach(member => {
                const item = document.createElement('div');
                item.className = 'glass-card p-4';
                item.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/deeee5c5-da3a-4e77-a41e-30a8be3e65b6.png" alt="Team member avatar" class="w-10 h-10 rounded-full">
                            <div>
                                <h4 class="font-semibold">${member.firstName} ${member.lastName}</h4>
                                <p class="text-gray-400 text-sm">${member.role.charAt(0).toUpperCase() + member.role.slice(1)}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="role-badge role-${member.role}">${member.role}</span>
                            <div class="status-indicator online"></div>
                            <button class="btn-secondary manage-user-btn" data-user-index="${users.indexOf(member)}">Gérer</button>
                        </div>
                    </div>
                `;
                teamMembersList.appendChild(item);
            });
        }

        // Quick action functions
        function quickSearch() {
            const query = prompt('Entrez votre recherche:');
            if (query) {
                if (currentUser) {
                    currentUser.apiRequests = (currentUser.apiRequests || 0) + 1;
                    currentUser.apiRequestsToday = (currentUser.apiRequestsToday || 0) + 1;
                    updateDashboardStats();
                }
                logAction('Quick Search', { query: query, user: currentUser ? currentUser.email : null }, 'info');
                showNotification(`Recherche lancée: ${query}`, 'info');
            }
        }

        // --- NOUVELLE FONCTION quickSearchHome() POUR L'API OATHNET ---
        async function quickSearchHome() {
            const queryEl = document.getElementById('homeSearchBarInput');
            const query = queryEl ? queryEl.value.trim() : '';
            if (!query) {
                showNotification('Veuillez entrer une cible à rechercher.', 'warning');
                return;
            }
            // Require login
            const user = (typeof currentUser !== 'undefined' && currentUser) ? currentUser : (window.currentUser || null);
            if (!user) {
                showNotification('🔒 Vous devez vous connecter pour effectuer une recherche.', 'error');
                showPage('login');
                return;
            }

            // If logged in but no active plan (or plan is "free"), redirect to premium/payments
            const planName = (user.plan || 'free').toLowerCase();
            if (!user.plan || planName === 'free') {
                showNotification("🚫 Votre compte n'a pas de plan actif. Pour effectuer des recherches, veuillez souscrire à un abonnement.", 'error');
                showPage('premium');
                return;
            }

            // Search limits per plan (keys are lowercase)
            const searchLimits = { free: 5, starter: 50, professional: 500, enterprise: 9999999 };
            const userPlan = planName;
            const limit = searchLimits[userPlan] ?? searchLimits['free'];
            if ((user.dailySearches || 0) >= limit) {
                showNotification(`🚫 Limite de recherches atteinte (${limit}/jour). Passez à un plan supérieur !`, 'error');
                showPage('premium');
                return;
            }

            // increment on the real currentUser object
            currentUser.dailySearches = (currentUser.dailySearches || 0) + 1;
            showNotification(`Lancement de la recherche pour: ${query}... (${currentUser.dailySearches}/${searchLimits[userPlan]} aujourd'hui)`, 'info');
            logAction('Home Page Quick Search Initiated', { query, user: currentUser.email, plan: userPlan }, 'info');

            // Determine type
            let searchType = 'breach';
            if (query.includes('@') && query.includes('.')) searchType = 'email';
            else if (/^\d{1,3}(?:\.\d{1,3}){3}$/.test(query)) searchType = 'ip';
            else if (query.includes('.')) searchType = 'domain';

            try {
                const resp = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: searchType, query })
                });

                // Read body as text first so we can handle HTML error pages (404 HTML etc.)
                const rawText = await resp.text();
                let apiData = null;
                if (!resp.ok) {
                    // Server returned an error page (likely HTML) — don't attempt to parse as JSON
                    console.error('Search API returned error:', resp.status, rawText);
                    showNotification(`Erreur réseau: ${resp.status}. Voir console pour détails.`, 'error');
                    logAction('Home Page Quick Search Network Error', { query, status: resp.status, bodyPreview: rawText.slice(0,300) }, 'error');
                    return;
                }
                try {
                    apiData = JSON.parse(rawText === '' ? '{}' : rawText);
                } catch (err) {
                    console.error('Invalid JSON from search API:', rawText);
                    showNotification('Réponse invalide du serveur de recherche. Voir console pour détails.', 'error');
                    logAction('Home Page Quick Search Parse Error', { query, error: err.message, bodyPreview: rawText.slice(0,300) }, 'error');
                    return;
                }

                const formattedResults = [];
                let title = `Résultats pour "${query}"`;

                if (apiData && apiData.success) {
                    // Simplified formatting: prefer apiData.data.results, fallback to apiData.data
                    if (apiData.data && Array.isArray(apiData.data.results) && apiData.data.results.length > 0) {
                        title = `🔍 ${apiData.data.results.length} résultat(s) trouvé(s) pour "${query}"`;
                        apiData.data.results.forEach(r => formattedResults.push(JSON.stringify(r, null, 2)));
                    } else if (apiData.data && typeof apiData.data === 'object') {
                        formattedResults.push(JSON.stringify(apiData.data, null, 2));
                    } else if (Array.isArray(apiData.results)) {
                        apiData.results.forEach(r => formattedResults.push(JSON.stringify(r, null, 2)));
                    } else if (typeof apiData === 'string') {
                        formattedResults.push(apiData);
                    }
                } else {
                    showNotification(`Erreur: ${apiData?.message || 'Une erreur est survenue'}`, 'error');
                    logAction('Home Page Quick Search Failed', { query, error: apiData?.message || 'Unknown' }, 'error');
                }

                currentSearchResults = formattedResults;
                currentPage = 1;

                if (formattedResults.length) {
                    displaySearchResults(title);
                    showNotification('Recherche terminée avec succès !', 'success');
                    logAction('Home Page Quick Search Success', { query, resultsCount: formattedResults.length }, 'success');
                } else {
                    showNotification('Aucun résultat trouvé pour cette recherche.', 'info');
                    logAction('Home Page Quick Search Success', { query, resultsCount: 0 }, 'info');
                }
            } catch (error) {
                console.error('Error during quickSearchHome:', error);
                showNotification('Impossible de contacter le service de recherche. Veuillez réessayer plus tard.', 'error');
                logAction('Home Page Quick Search Network Error', { query, error: error.message }, 'error');
            }
        }

        // --- Gestion des modales et des résultats de recherche ---
        function displaySearchResults(title) {
            // Consolidated implementation: builds modal content, pagination and opens modal
            if (window.isInitializing) return;
            if (!Array.isArray(currentSearchResults) || currentSearchResults.length === 0) {
                showNotification('ℹ️ Aucun résultat à afficher', 'info');
                return;
            }

            try {
                const modal = document.getElementById('searchResultsModal');
                const modalTitle = document.getElementById('searchResultsTitle');
                const resultsBody = document.getElementById('searchResultsBody');
                const currentPageInfo = document.getElementById('currentPageInfo');
                const prevPageBtn = document.getElementById('prevPageBtn');
                const nextPageBtn = document.getElementById('nextPageBtn');

                if (!modal || !modalTitle || !resultsBody) {
                    throw new Error('Éléments de modal manquants');
                }

                modalTitle.textContent = title || 'Résultats de Recherche';
                resultsBody.innerHTML = '';

                const start = (currentPage - 1) * resultsPerPage;
                const end = Math.min(start + resultsPerPage, currentSearchResults.length);
                const pageResults = currentSearchResults.slice(start, end);
                const totalPages = Math.max(1, Math.ceil(currentSearchResults.length / resultsPerPage));

                // Helper: try to normalize incoming item into an array of result objects
                function normalizeResult(raw) {
                    // If it's already an object
                    if (typeof raw === 'object' && raw !== null) {
                        if (Array.isArray(raw)) return raw;
                        // If container wrapping
                        if (raw.data && Array.isArray(raw.data.results)) return raw.data.results;
                        if (Array.isArray(raw.results)) return raw.results;
                        return [raw];
                    }

                    // If it's a string, try to parse JSON, with fallbacks
                    if (typeof raw === 'string') {
                        let s = raw.trim();
                        // Try direct parse
                        try { const p = JSON.parse(s); return normalizeResult(p); } catch (e) {}

                        // Unescape common HTML entities
                        s = s.replace(/&quot;/g, '"').replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                        try { const p = JSON.parse(s); return normalizeResult(p); } catch (e) {}

                        // Try to extract JSON substring
                        const m = s.match(/(\{[\s\S]*\})/);
                        if (m) {
                            try { const p = JSON.parse(m[1]); return normalizeResult(p); } catch (e) {}
                        }

                        // If it looks like an array
                        const ma = s.match(/(\[[\s\S]*\])/);
                        if (ma) {
                            try { const p = JSON.parse(ma[1]); return normalizeResult(p); } catch (e) {}
                        }

                        // Fallback: return as raw text object
                        return [{ raw: s }];
                    }

                    return [{ raw: String(raw) }];
                }

                // Render results as detailed emoji-rich profile cards (handle nested/multi results)
                let renderedCount = 0;
                pageResults.forEach((r, idx) => {
                    const list = normalizeResult(r);
                    list.forEach((obj, subIdx) => {
                        const profileIndex = start + renderedCount + 1;
                        renderedCount += 1;

                        // Determine plan and masking rules
                        const userPlanRaw = (currentUser && currentUser.plan) ? currentUser.plan : 'Free';
                        const planLower = String(userPlanRaw).toLowerCase();
                        const isPro = planLower.includes('pro') || planLower.includes('professional') || planLower.includes('enterprise');
                        const isStarter = planLower.includes('starter');
                        const isFree = !isPro && !isStarter;

                        // Masked copy for display and restricted users
                        function maskEmail(email) {
                            if (!email || !email.includes('@')) return email || '';
                            const [local, domain] = email.split('@');
                            if (local.length <= 2) return '*@' + domain;
                            return local[0] + '*'.repeat(Math.max(1, local.length - 2)) + local.slice(-1) + '@' + domain;
                        }

                        function maskPhone(num) {
                            if (!num) return '';
                            const s = String(num).replace(/[^0-9]/g, '');
                            if (s.length <= 4) return '*'.repeat(s.length);
                            return '*'.repeat(Math.max(0, s.length - 4)) + s.slice(-4);
                        }

                        function maskIBAN(iban) {
                            if (!iban) return '';
                            return '[MASQUÉ] ' + (iban.slice(-4) ? '••••' + iban.slice(-4) : '');
                        }

                        function maskForPlan(obj) {
                            const copy = JSON.parse(JSON.stringify(obj));
                            // Free: hide IBAN/BIC, mask phones and email
                            if (isFree) {
                                if (copy.iban) copy.iban = '[MASQUÉ - FREE]';
                                if (copy.bic) copy.bic = '[MASQUÉ - FREE]';
                                if (copy.number) copy.number = maskPhone(copy.number);
                                if (copy.phone_number) copy.phone_number = maskPhone(copy.phone_number);
                                if (copy.phone2) copy.phone2 = maskPhone(copy.phone2);
                                if (copy.telVoip) copy.telVoip = maskPhone(copy.telVoip);
                                if (copy.email) copy.email = maskEmail(copy.email);
                            }
                            // Starter: mask IBAN/BIC only
                            else if (isStarter) {
                                if (copy.iban) copy.iban = '[MASQUÉ - STARTER]';
                                if (copy.bic) copy.bic = '[MASQUÉ - STARTER]';
                            }
                            // Pro/Enterprise: full access (no masking)
                            return copy;
                        }

                        const item = document.createElement('div');
                        item.className = 'mb-4 p-4 rounded-lg glass-effect';

                        // Fields with fallbacks
                        const firstName = (obj.first_name && obj.first_name[0]) || obj.firstName || obj.firstname || '';
                        const lastName = (obj.last_name && obj.last_name[0]) || obj.lastName || obj.lastname || '';
                        const fullName = `${firstName} ${lastName}`.trim() || '(Nom non renseigné)';

                        const birthRaw = obj.user_birth_date || obj.birth_date || obj.birthDate || '';
                        const birthDate = birthRaw ? formatDate(birthRaw) : '(Non renseignée)';

                        const addressLines = [];
                        if (Array.isArray(obj.address_street) && obj.address_street.length) addressLines.push(...obj.address_street);
                        if (obj.streetNumber) addressLines.unshift(obj.streetNumber);
                        const addressStr = addressLines.join('\n') || '(Non renseignée)';

                        const zip = obj.zip_code || obj.zip || '';
                        const city = (Array.isArray(obj.city) && obj.city[0]) || obj.city || '';
                        const complement = obj.supplement || obj.complement || '';

                        const email = obj.email || '(Non renseigné)';
                        const phoneMobile = obj.number || obj.phone_number || obj.phone || '';
                        const phoneVoip = obj.telVoip || obj.tel_voip || '';
                        const phone2 = obj.phone2 || obj.second_phone || '';

                        const iban = obj.iban || '';
                        const bic = obj.bic || '';

                        const activation = obj.activation_date || obj.activation || '';
                        const activationDate = activation ? formatDate(activation) : '(Non renseignée)';

                        const society = obj.society || obj.company || '(Non renseignée)';
                        const civility = obj.civility || obj.gender || ''; 
                        const id = obj.id || obj._id || '(Non renseigné)';

                        // Build HTML conditionally (only render sections that exist)
                        const civEmoji = civility && civility.toLowerCase().startsWith('f') ? '♀️' : (civility && civility.toLowerCase().startsWith('m') ? '♂️' : '🧑');
                        const parts = [];
                        parts.push(`<div class="font-semibold text-lg">📁 Profil #${profileIndex}</div>`);
                        parts.push(`<div class="mt-2">`);
                        parts.push(`<div class="font-semibold">👤 Nom : ${escapeHtml(fullName)}</div>`);
                        if (birthRaw) parts.push(`<div class="text-sm text-gray-300 mt-1">🎂 Date de naissance : ${escapeHtml(birthDate)}</div>`);
                        if (addressStr && addressStr !== '(Non renseignée)') parts.push(`<div class="mt-2">🏠 Adresse :<div class="ml-4 whitespace-pre-wrap text-sm text-gray-300">${escapeHtml(addressStr)}</div></div>`);
                        if (zip || city) parts.push(`<div class="text-sm text-gray-300 mt-1">📍 ${escapeHtml((zip ? zip + ' ' : '') + (city || ''))}</div>`);
                        if (complement) parts.push(`<div class="text-sm text-gray-300 mt-1">🔢 Complément : ${escapeHtml(complement)}</div>`);
                        if (email && email !== '(Non renseigné)') parts.push(`<div class="mt-2 text-sm">📧 Email : ${escapeHtml(email)}</div>`);

                        // Phones
                        const phoneLines = [];
                        if (phoneMobile) phoneLines.push(`📞 Mobile : ${escapeHtml(phoneMobile)}`);
                        if (phoneVoip) phoneLines.push(`📞 VoIP : ${escapeHtml(phoneVoip)}`);
                        if (phone2) phoneLines.push(`📞 Secondaire : ${escapeHtml(phone2)}`);
                        if (phoneLines.length) {
                            parts.push(`<div class="mt-2 text-sm">📱 Téléphones :</div><div class="ml-4 text-sm text-gray-300">${phoneLines.join('<br/>')}</div>`);
                        }

                        // Banking
                        if (iban || bic) {
                            parts.push(`<div class="mt-2 text-sm">🏦 Informations bancaires :</div><div class="ml-4 text-sm text-gray-300">${iban ? `💳 IBAN : ${escapeHtml(iban)}<br/>` : ''}${bic ? `🏦 BIC : ${escapeHtml(bic)}<br/>` : ''}</div>`);
                        }

                        if (activation) parts.push(`<div class="mt-2 text-sm">📅 Date d’activation : ${escapeHtml(activationDate)}</div>`);
                        if (society && society !== '(Non renseignée)') parts.push(`<div class="mt-1 text-sm">🏢 Société : ${escapeHtml(society)}</div>`);
                        if (civility) parts.push(`<div class="mt-1 text-sm">🧍 Civilité : ${escapeHtml(civility)} ${civEmoji}</div>`);
                        parts.push(`<div class="mt-1 text-sm">🆔 ID : ${escapeHtml(String(id))}</div>`);
                        parts.push(`</div>`);

                        parts.push(`<div class="mt-3 flex space-x-2"><button class="btn-secondary btn-view-json">Voir JSON complet</button><button class="btn-secondary btn-copy-json">Copier</button></div>`);
                        parts.push(`<pre class="hidden mt-3 p-3 bg-black bg-opacity-20 text-sm overflow-auto" style="max-height:300px">${escapeHtml(JSON.stringify(obj, null, 2))}</pre>`);

                        item.innerHTML = parts.join('');

                        // Attach handlers for view/copy buttons
                        const viewBtn = item.querySelector('.btn-view-json');
                        const copyBtn = item.querySelector('.btn-copy-json');
                        const pre = item.querySelector('pre');
                        if (viewBtn && pre) {
                            viewBtn.addEventListener('click', function() {
                                if (pre.classList.contains('hidden')) {
                                    pre.classList.remove('hidden');
                                    viewBtn.textContent = 'Masquer JSON';
                                } else {
                                    pre.classList.add('hidden');
                                    viewBtn.textContent = 'Voir JSON complet';
                                }
                            });
                        }
                        if (copyBtn) {
                            copyBtn.addEventListener('click', function() {
                                const text = JSON.stringify(obj, null, 2);
                                if (navigator.clipboard && navigator.clipboard.writeText) {
                                    navigator.clipboard.writeText(text).then(() => showNotification('✅ JSON copié dans le presse-papiers', 'success'))
                                        .catch(() => showNotification('❌ Échec de la copie', 'error'));
                                } else {
                                    // fallback
                                    const ta = document.createElement('textarea');
                                    ta.value = text;
                                    document.body.appendChild(ta);
                                    ta.select();
                                    try { document.execCommand('copy'); showNotification('✅ JSON copié dans le presse-papiers', 'success'); } catch (e) { showNotification('❌ Échec de la copie', 'error'); }
                                    document.body.removeChild(ta);
                                }
                            });
                        }

                        resultsBody.appendChild(item);

                        // Log full pretty JSON to console for each result
                        console.groupCollapsed(`🔎 Profil #${profileIndex}: ${fullName}`);
                        console.log(JSON.stringify(obj, null, 2));
                        console.groupEnd();
                    });
                });

                // Update pagination controls
                if (currentPageInfo) currentPageInfo.textContent = `Page ${currentPage} / ${totalPages}`;
                if (prevPageBtn) prevPageBtn.disabled = currentPage <= 1;
                if (nextPageBtn) nextPageBtn.disabled = currentPage >= totalPages;

                // Open modal
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.opacity = '1';

                // Attach close handlers
                const closeBtn = document.getElementById('closeModalBtn');
                const close = () => {
                    modal.style.opacity = '0';
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        resultsBody.innerHTML = '';
                        currentSearchResults = [];
                        currentPage = 1;
                    }, 300);
                };

                if (closeBtn) closeBtn.onclick = close;
                modal.onclick = (e) => { if (e.target === modal) close(); };

                // Optional: focus first result for keyboard users
                setTimeout(() => resultsBody.scrollTop = 0, 0);

            } catch (err) {
                console.error('Erreur displaySearchResults:', err);
                showNotification('❌ Erreur lors de l\'affichage des résultats: ' + err.message, 'error');
            }
        }

        function changePage(direction) {
            try {
                if (!currentSearchResults?.length) {
                    throw new Error('Aucun résultat à paginer');
                }

                const totalPages = Math.ceil(currentSearchResults.length / resultsPerPage);
                const newPage = currentPage + direction;

                if (newPage < 1 || newPage > totalPages) {
                    throw new Error('Page hors limites');
                }

                currentPage = newPage;
                
                // Animation de transition
                const resultsBody = document.getElementById('searchResultsBody');
                if (resultsBody) {
                    resultsBody.style.opacity = '0';
                    setTimeout(() => {
                        const title = document.getElementById('searchResultsTitle')?.textContent || 'Résultats de Recherche';
                        displaySearchResults(title);
                        resultsBody.style.opacity = '1';
                    }, 150);
                }

                // Mise à jour des boutons de pagination
                const prevBtn = document.getElementById('prevPageBtn');
                const nextBtn = document.getElementById('nextPageBtn');
                if (prevBtn) prevBtn.disabled = currentPage <= 1;
                if (nextBtn) nextBtn.disabled = currentPage >= totalPages;

                logAction('Page Changed', { from: currentPage - direction, to: currentPage, totalPages }, 'info');

            } catch (error) {
                console.error('Erreur de pagination:', error);
                showNotification('❌ ' + error.message, 'error');
            }
        }

        // Utility helpers
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function truncate(str, n) {
            return (str.length > n) ? str.slice(0, n) + '...': str;
        }

        function formatDate(iso) {
            try {
                const d = new Date(iso);
                return d.toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' });
            } catch (e) {
                return iso;
            }
        }

        // Manage User modal logic
        let manageUserIndex = null;
        function openManageUserModal(index) {
            if (!currentUser || (currentUser.role !== 'founder' && currentUser.role !== 'admin')) {
                showNotification('🚫 Accès refusé: seuls les fondateurs et admins peuvent gérer les utilisateurs.', 'error');
                return;
            }
            manageUserIndex = index;
            const user = users[index];
            if (!user) return;
            document.getElementById('manageUserTitle').textContent = `Gérer: ${user.firstName} ${user.lastName}`;
            document.getElementById('manageUserRole').value = user.role || 'user';
            document.getElementById('manageUserPlan').value = user.plan || 'Free';
            const modal = document.getElementById('manageUserModal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.style.opacity = '1';
        }

        function closeManageUserModal() {
            const modal = document.getElementById('manageUserModal');
            if (!modal) return;
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }, 200);
            manageUserIndex = null;
        }

        function applyUserUpdates() {
            if (manageUserIndex === null) return;
            const role = document.getElementById('manageUserRole').value;
            const plan = document.getElementById('manageUserPlan').value;
            const user = users[manageUserIndex];
            if (!user) return;
            // Prevent demoting/removing founder by mistake
            if (user.role === 'founder' && role !== 'founder') {
                showNotification('🚫 Impossible de modifier le fondateur principal.', 'error');
                return;
            }
            user.role = role;
            user.plan = plan;
            logAction('User Managed', { managedUser: user.email, by: currentUser ? currentUser.email : 'Unknown', newRole: role, newPlan: plan }, 'info');
            updateUsersList();
            updateTeamMembersList();
            showNotification('✅ Modifications enregistrées.', 'success');
            closeManageUserModal();
        }

        function closeSearchResultsModal() {
            const elements = {
                modal: document.getElementById('searchResultsModal'),
                body: document.getElementById('searchResultsBody'),
                closeBtn: document.getElementById('closeModalBtn')
            };

            if (elements.modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.style.opacity = '1';
                    currentSearchResults = []; // Clear results when closing
                    currentPage = 1;
                }, 300);
            }
        }

        // Initialisation des gestionnaires d'événements
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Navigation et boutons de page
            document.querySelectorAll('[data-page]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) showPage(page);
                });
            });

            // 2. Bouton de recherche
            const searchButton = document.getElementById('searchButton');
            if (searchButton) {
                searchButton.addEventListener('click', async function() {
                    this.disabled = true;
                    const originalContent = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    try {
                        await quickSearchHome();
                    } finally {
                        this.disabled = false;
                        this.innerHTML = originalContent;
                    }
                });
            }

            // 3. Champ de recherche (touche Entrée)
            const searchInput = document.getElementById('homeSearchBarInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('searchButton')?.click();
                    }
                });
            }

            // 4. Dashboard tab buttons (data-tab)
            document.querySelectorAll('[data-tab]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tab = this.getAttribute('data-tab');
                    if (tab) {
                        // Remove active classes from dashboard links
                        document.querySelectorAll('.dashboard-nav-link').forEach(link => link.classList.remove('text-white', 'bg-blue-600'));
                        this.classList.add('text-white', 'bg-blue-600');
                        showDashboardTab(tab);
                    }
                });
            });

            // 4. Boutons de mode de recherche
            document.querySelectorAll('[data-mode]').forEach(button => {
                button.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    if (mode) {
                        // Mise à jour des boutons
                        document.querySelectorAll('[data-mode]').forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');

                        // Mise à jour de l'affichage
                        const bulkSearch = document.getElementById('bulkSearch');
                        const automatedSearch = document.getElementById('automatedSearch');
                        if (bulkSearch && automatedSearch) {
                            bulkSearch.classList.toggle('hidden', mode !== 'bulk');
                            automatedSearch.classList.toggle('hidden', mode === 'bulk');
                        }

                        showNotification(`Mode ${mode} activé`, 'info');
                    }
                });
            });

            // 5. Bouton de notifications
            const notificationsBtn = document.getElementById('notificationsBtn');
            if (notificationsBtn) {
                notificationsBtn.addEventListener('click', function() {
                    const notifPanel = document.getElementById('notificationsPanel');
                    if (notifPanel) {
                        const isHidden = notifPanel.classList.contains('hidden');
                        if (isHidden) {
                            // Populate notifications before showing
                            try { updateNotificationsDisplay(); } catch (e) { console.error(e); }
                            notifPanel.classList.remove('hidden');
                            setTimeout(() => notifPanel.style.opacity = '1', 0);
                        } else {
                            notifPanel.style.opacity = '0';
                            setTimeout(() => notifPanel.classList.add('hidden'), 300);
                        }
                    }
                });
            }

            // 6. Bouton d'authentification — replace node to remove stray listeners, then updateAuthButton will wire it
                const authButton = document.getElementById('authButton');
                if (authButton) {
                    try {
                        const clean = authButton.cloneNode(true);
                        authButton.parentNode.replaceChild(clean, authButton);
                    } catch (e) { /* fallback: ignore */ }
                }

            // 7. Gestion des modales
            const closeBtn = document.getElementById('closeModalBtn');
            const modal = document.getElementById('searchResultsModal');
            
            if (closeBtn && modal) {
                // Fermeture sur clic du bouton
                closeBtn.addEventListener('click', closeSearchResultsModal);
                
                // Fermeture sur clic en dehors
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeSearchResultsModal();
                    }
                });
                
                // Close on Escape key press
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                        closeSearchResultsModal();
                    }
                });
            }

            // 8. Backwards compatibility: attach handlers to elements still using inline onclick attributes
            document.querySelectorAll('[onclick]').forEach(el => {
                const handler = el.getAttribute('onclick');
                try {
                    if (/showPage\(['\"]([^'\"]+)['\"]\)/.test(handler)) {
                        const page = handler.match(/showPage\(['\"]([^'\"]+)['\"]\)/)[1];
                        el.addEventListener('click', (e) => { e.preventDefault(); showPage(page); });
                    }
                    if (/showDashboardTab\(['\"]([^'\"]+)['\"]\)/.test(handler)) {
                        const tab = handler.match(/showDashboardTab\(['\"]([^'\"]+)['\"]\)/)[1];
                        el.addEventListener('click', (e) => { e.preventDefault(); showDashboardTab(tab); });
                    }
                    if (/toggleNotifications\(\)/.test(handler)) {
                        el.addEventListener('click', (e) => { e.preventDefault(); toggleNotifications(); });
                    }
                    if (/toggleProfileMenu\(\)/.test(handler)) {
                        el.addEventListener('click', (e) => { e.preventDefault(); toggleProfileMenu(); });
                    }
                } catch (err) {
                    // Defensive: ignore parsing errors for complex inline handlers
                }
            });

            // Attach handlers for manage-user buttons (dynamically added buttons)
            function wireManageButtons() {
                document.querySelectorAll('.manage-user-btn').forEach(btn => {
                    if (btn._managed) return; // already wired
                    btn._managed = true;
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const idx = parseInt(this.getAttribute('data-user-index'), 10);
                        if (!isNaN(idx)) openManageUserModal(idx);
                    });
                });
            }

            // initial wire and observe for dynamic changes
            wireManageButtons();
            const observer = new MutationObserver(wireManageButtons);
            observer.observe(document.body, { childList: true, subtree: true });

            // Robust fallback: delegated listener for quick logout button
            document.addEventListener('click', function(e) {
                const lnk = e.target.closest && e.target.closest('#authLogoutBtn');
                if (lnk) {
                    e.preventDefault();
                    try { confirmAndLogout(); } catch (err) { console.error('Logout confirm failed', err); }
                }
            });

            // Manage modal controls
            const manageSaveBtn = document.getElementById('manageSaveBtn');
            const manageCancelBtn = document.getElementById('manageCancelBtn');
            const closeManageUserBtn = document.getElementById('closeManageUserBtn');
            const manageModal = document.getElementById('manageUserModal');
            if (manageSaveBtn) manageSaveBtn.addEventListener('click', applyUserUpdates);
            if (manageCancelBtn) manageCancelBtn.addEventListener('click', closeManageUserModal);
            if (closeManageUserBtn) closeManageUserBtn.addEventListener('click', closeManageUserModal);
            if (manageModal) {
                manageModal.addEventListener('click', function(e) { if (e.target === manageModal) closeManageUserModal(); });
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !manageModal.classList.contains('hidden')) closeManageUserModal();
                });
            }
        });

        function exportSearchResults() {
            if (currentSearchResults.length === 0) {
                showNotification('Aucun résultat à exporter.', 'warning');
                return;
            }

            const userPlan = currentUser ? currentUser.plan : 'Free';
            const canSeeFullResults = userPlan === 'Professional' || userPlan === 'Enterprise';
            
            let content;
            const filename = `breachfr_osint_results_${new Date().toISOString().slice(0, 10)}.txt`;

            if (canSeeFullResults) {
                // Plan Premium : export complet
                content = currentSearchResults.join('\n\n--------------------\n\n');
                showNotification('Résultats exportés en TXT (version complète)!', 'success');
            } else {
                // Plan gratuit/Starter : export flouté
                const blurredResults = currentSearchResults.map(result => {
                    if (userPlan === 'Free') {
                        return `🔒 RÉSULTAT MASQUÉ - PLAN GRATUIT
                        
Aperçu limité : ${result.substring(0, 100)}...

[DONNÉES COMPLÈTES MASQUÉES]
Passez au plan Professional ou Enterprise pour accéder aux données complètes.
Visitez : https://breachfr.com/premium

--------------------`;
                    } else if (userPlan === 'Starter') {
                        // Plan Starter : montre plus mais masque les données sensibles
                        const maskedResult = result
                            .replace(/IBAN: [A-Z0-9]+/g, 'IBAN: [MASQUÉ - PLAN STARTER]')
                            .replace(/BIC: [A-Z0-9]+/g, 'BIC: [MASQUÉ - PLAN STARTER]')
                            .replace(/Mot de passe: .+/g, 'Mot de passe: [MASQUÉ - PLAN STARTER]')
                            .replace(/Carte de crédit: .+/g, 'Carte de crédit: [MASQUÉ - PLAN STARTER]')
                            .replace(/Passeport: .+/g, 'Passeport: [MASQUÉ - PLAN STARTER]')
                            .replace(/SSN: .+/g, 'SSN: [MASQUÉ - PLAN STARTER]');
                        
                        return maskedResult + '\n\n[DONNÉES SENSIBLES MASQUÉES - PLAN STARTER]\nPassez au plan Professional pour tout débloquer.';
                    }
                });
                
                content = blurredResults.join('\n\n--------------------\n\n');
                showNotification(`Résultats exportés (version ${userPlan.toLowerCase()})!`, 'warning');
            }

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            logAction('Search Results Exported', { 
                filename: filename, 
                resultsCount: currentSearchResults.length, 
                plan: userPlan,
                fullAccess: canSeeFullResults 
            }, 'info');
        }
        // --- FIN des fonctions pour la modal des résultats de recherche ---


        function domainScan() {
            const domain = prompt('Domaine à scanner:');
            if (domain) {
                if (currentUser) {
                    currentUser.apiRequests = (currentUser.apiRequests || 0) + 5; // More requests for scan
                    currentUser.apiRequestsToday = (currentUser.apiRequestsToday || 0) + 5;
                    updateDashboardStats();
                }
                logAction('Domain Scan', { domain: domain, user: currentUser ? currentUser.email : null }, 'info');
                showNotification(`Scan lancé pour: ${domain}`, 'info');
            }
        }

        function emailSearch() {
            const email = prompt('Email à rechercher:');
            if (email) {
                if (currentUser) {
                    currentUser.apiRequests = (currentUser.apiRequests || 0) + 2;
                    currentUser.apiRequestsToday = (currentUser.apiRequestsToday || 0) + 2;
                    updateDashboardStats();
                }
                logAction('Email Search', { email: email, user: currentUser ? currentUser.email : null }, 'info');
                showNotification(`Recherche lancée pour: ${email}`, 'info');
            }
        }

        // Tool launcher (existing function with logging)
        function launchTool(toolType) {
            const modal = document.getElementById('toolModal');
            const title = document.getElementById('toolTitle');
            const content = document.getElementById('toolContent');
            
            const toolTitles = {
                'domain': 'Domain Intelligence',
                'email': 'Email Investigation',
                'ip': 'IP Geolocation',
                'social': 'Social Media Scanner',
                'phone': 'Phone Intelligence',
                'threats': 'Threat Intelligence',
                'darkweb': 'Dark Web Monitoring',
                'crypto': 'Crypto Analysis',
                'automation': 'OSINT Automation',
                'image': 'Image Forensics',
                'wifi': 'Wi-Fi Analysis',
                'forum': 'Forum & Blog Scraper'
            };
            
            title.textContent = toolTitles[toolType] || 'Outil OSINT';
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Cible à analyser</label>
                        <input type="text" class="form-input" placeholder="Entrez votre cible (domaine, email, IP...)" id="toolTarget">
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Options avancées</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">Analyse approfondie</span>
                                                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Inclure historique</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Export automatique</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Format de sortie</label>
                            <select class="form-input">
                                <option>JSON</option>
                                <option>CSV</option>
                                <option>PDF</option>
                                <option>XML</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button class="btn-primary flex-1" onclick="runTool('${toolType}')">
                            <i class="fas fa-play mr-2"></i>
                            Lancer l'analyse
                        </button>
                        <button class="btn-secondary" onclick="closeTool()">
                            Annuler
                        </button>
                    </div>
                    
                    <div id="toolResults" class="hidden">
                        <div class="glass-card p-4">
                            <div class="flex items-center mb-4">
                                <div class="loading-spinner mr-4"></div>
                                <span>Analyse en cours...</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="toolProgress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            logAction('Tool Launched', { tool: toolType, user: currentUser ? currentUser.email : null }, 'info');
        }

        function closeTool() {
            document.getElementById('toolModal').classList.add('hidden');
        }

        // Filter tools (existing function)
        function filterTools(category) {
            const tools = document.querySelectorAll('.tool-card');
            const filters = document.querySelectorAll('.tool-filter');
            
            filters.forEach(filter => filter.classList.remove('active', 'bg-blue-600'));
            event.target.classList.add('active', 'bg-blue-600');
            
            tools.forEach(tool => {
                if (category === 'all' || tool.dataset.category === category) {
                    tool.style.display = 'block';
                } else {
                    tool.style.display = 'none';
                }
            });
        }

        // Notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // FAQ Toggle
        function toggleFAQ(element) {
            const parent = element.closest('.faq-item-professional'); // Changed class name
            parent.classList.toggle('active');
        }

        // Premium Checkout Functions
        function selectPlan(planName, planPrice) {
            selectedPlan.name = planName;
            selectedPlan.price = planPrice;
            showPage('premium-checkout');
            updateCheckoutSummary();
            togglePaymentMethod('paypal'); // Default to PayPal
        }

        function updateCheckoutSummary() {
            const planNameElem = document.getElementById('checkoutPlanName');
            const summaryPlanNameElem = document.getElementById('summaryPlanName');
            const summaryPlanPriceElem = document.getElementById('summaryPlanPrice');
            const summaryTaxElem = document.getElementById('summaryTax');
            const summaryTotalElem = document.getElementById('summaryTotal');
            const paypalAmountElem = document.getElementById('paypalAmount');
            const cryptoAmountElem = document.getElementById('cryptoAmount');

            if (selectedPlan.name && selectedPlan.price) {
                planNameElem.textContent = selectedPlan.name;
                summaryPlanNameElem.textContent = selectedPlan.name;
                summaryPlanPriceElem.textContent = `€${selectedPlan.price.toFixed(2)}`;
                
                const tax = selectedPlan.price * 0.20; // 20% TVA
                const total = selectedPlan.price + tax;

                summaryTaxElem.textContent = `€${tax.toFixed(2)}`;
                summaryTotalElem.textContent = `€${total.toFixed(2)}`;
                
                paypalAmountElem.textContent = `€${total.toFixed(2)}`;
                cryptoAmountElem.textContent = `€${total.toFixed(2)}`;
            }
        }

        function togglePaymentMethod(method) {
            document.querySelectorAll('.payment-details-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.payment-method-option').forEach(option => {
                option.classList.remove('selected');
            });

            document.getElementById(`${method}-details`).classList.remove('hidden');
            document.getElementById(`${method}-option`).classList.add('selected');

            if (method === 'crypto') {
                updateCryptoAddress();
            }
        }

        const cryptoAddresses = {
            btc: 'bc1q3vq4sc453cm0tulj99xlkq3vv98eqk02rp2na9',
            ltc: 'LU31nqyfCUMxCJjGZavqKDZpdsTLf3LZHk'
        };

        function updateCryptoAddress() {
            const selectedCrypto = document.getElementById('cryptoCurrency').value;
            document.getElementById('cryptoAddress').textContent = cryptoAddresses[selectedCrypto];
            document.getElementById('selectedCryptoName').textContent = selectedCrypto === 'btc' ? 'Bitcoin (BTC)' : 'Litecoin (LTC)';
        }

        function copyCryptoAddress() {
            const address = document.getElementById('cryptoAddress').textContent;
            navigator.clipboard.writeText(address).then(() => {
                showNotification('Adresse copiée dans le presse-papiers!', 'info');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                showNotification('Erreur lors de la copie de l\'adresse.', 'error');
            });
        }

        function togglePasswordVisibility(id, button) {
            const input = document.getElementById(id);
            const icon = button.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {

        function copyPayPalAddress() {
            const addrElem = document.getElementById('paypalAddress');
            if (!addrElem) return;
            const addr = addrElem.textContent.trim();
            if (!navigator.clipboard) {
                // fallback
                const ta = document.createElement('textarea');
                ta.value = addr; document.body.appendChild(ta); ta.select();
                try { document.execCommand('copy'); } catch(e) {}
                ta.remove();
            } else {
                navigator.clipboard.writeText(addr).catch(()=>{});
            }

            const t = document.createElement('div');
            t.textContent = 'Adresse PayPal copiée dans le presse-papiers';
            t.style.position = 'fixed'; t.style.bottom = '20px'; t.style.right = '20px';
            t.style.background = 'rgba(0,0,0,0.85)'; t.style.color = 'white';
            t.style.padding = '8px 12px'; t.style.borderRadius = '6px';
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2200);
        }
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Form handlers
        document.getElementById('loginForm')?.addEventListener('submit', handleLogin);
        document.getElementById('registerForm')?.addEventListener('submit', handleRegister);
        document.getElementById('paymentForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            const totalAmount = document.getElementById('summaryTotal').textContent;

            if (paymentMethod === 'paypal') {
                const paypalEmail = document.getElementById('paypalEmail').value;
                showNotification('Redirection vers PayPal...', 'info');
                logAction('PayPal Payment Initiated', { plan: selectedPlan.name, amount: totalAmount, user: currentUser ? currentUser.email : 'Anonymous', paypalEmail: paypalEmail }, 'info');
                
                // Simulate PayPal redirection
                setTimeout(() => {
                    // In a real application, you would redirect to PayPal's payment gateway here
                    // window.location.href = `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=breachfr@proton.me&amount=${selectedPlan.price.toFixed(2)}&currency_code=EUR&item_name=${selectedPlan.name}`;
                    showNotification('Paiement PayPal simulé. Veuillez compléter la transaction sur PayPal.', 'success');
                    // For simulation, assume success after a short delay
                    setTimeout(() => {
                        if (currentUser) {
                            currentUser.plan = selectedPlan.name;
                            updateDashboardUser();
                            logAction('Subscription Activated (PayPal Simulated)', { plan: selectedPlan.name, user: currentUser.email }, 'success');
                        }
                        showPage('dashboard');
                    }, 3000);
                }, 1500);

            } else if (paymentMethod === 'crypto') {
                const selectedCrypto = document.getElementById('cryptoCurrency').value;
                const cryptoAddress = cryptoAddresses[selectedCrypto];
                showNotification('Veuillez effectuer le transfert de crypto-monnaie.', 'warning');
                logAction('Crypto Payment Initiated', { plan: selectedPlan.name, amount: totalAmount, crypto: selectedCrypto, address: cryptoAddress, user: currentUser ? currentUser.email : 'Anonymous' }, 'info');
                
                // In a real application, you would monitor the blockchain for this transaction
                // For simulation, assume success after a longer delay
                setTimeout(() => {
                    if (Math.random() > 0.2) { // Simulate 80% success rate for crypto
                        showNotification('Paiement crypto-monnaie reçu et vérifié! Votre abonnement est activé.', 'success');
                        if (currentUser) {
                            currentUser.plan = selectedPlan.name;
                            updateDashboardUser();
                            logAction('Subscription Activated (Crypto Verified)', { plan: selectedPlan.name, user: currentUser.email }, 'success');
                        }
                        showPage('dashboard');
                    } else {
                        showNotification('Échec de la vérification du paiement crypto. Veuillez contacter le support.', 'error');
                        logAction('Crypto Payment Failed', { plan: selectedPlan.name, user: currentUser ? currentUser.email : 'Anonymous', reason: 'Simulated verification failure' }, 'error');
                    }
                }, 8000); // Longer delay for crypto verification
            }
        });

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;

            // Validation côté client
            if (!email || !password) {
                showNotification('❌ Veuillez remplir tous les champs', 'error');
                return;
            }

            // SIMULATION RÉALISTE: Recherche dans la base locale
            const user = users.find(u => u.email.toLowerCase() === email && u.password === password);
            
            if (user) {
                // Connexion réussie
                currentUser = { ...user }; // Clone pour éviter les références
                authToken = 'BFR-TOKEN-' + Math.random().toString(36).substring(2, 15).toUpperCase();
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUserEmail', user.email);
                // Remember me flag
                const rememberMe = document.getElementById('loginRememberMe')?.checked;
                localStorage.setItem('rememberMe', rememberMe ? 'true' : 'false');
                
                // Mise à jour de la dernière connexion
                user.lastLogin = new Date().toISOString();
                
                updateAuthButton();
                logAction('User Login Success', { 
                    email: user.email, 
                    role: user.role, 
                    loginTime: new Date().toISOString(),
                    userAgent: navigator.userAgent 
                }, 'success');
                
                showNotification(`✅ Bienvenue ${user.firstName} ${user.lastName}!`, 'success');
                // Add a notification to the notifications panel
                notifications.unshift({ title: 'Connexion', message: `Bienvenue ${user.firstName}!`, timestamp: Date.now(), type: 'success' });
                
                // Redirection selon le rôle
                setTimeout(() => {
                    if (user.role === 'founder' || user.role === 'admin') {
                        showPage('dashboard');
                    } else {
                        showPage('tools');
                    }
                }, 1500);
            } else {
                // Connexion échouée
                logAction('User Login Failed', { 
                    email: email, 
                    reason: 'Invalid credentials',
                    attemptTime: new Date().toISOString(),
                    userAgent: navigator.userAgent 
                }, 'warning');
                
                showNotification('❌ Email ou mot de passe incorrect', 'error');
                
                // Sécurité: Effacer les champs après échec
                document.getElementById('loginPassword').value = '';
            }
        }

        // Fonction de validation d'email avancée
        function validateEmail(email) {
            // Regex plus stricte pour les emails
            const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
            
            if (!emailRegex.test(email)) {
                return { valid: false, message: 'Format d\'email invalide' };
            }

            // Liste des domaines jetables/temporaires à bloquer
            const disposableEmailDomains = [
                '10minutemail.com', 'tempmail.org', 'guerrillamail.com', 'mailinator.com',
                'yopmail.com', 'temp-mail.org', 'throwaway.email', 'getnada.com',
                'maildrop.cc', 'sharklasers.com', 'guerrillamailblock.com', 'pokemail.net',
                'spam4.me', 'bccto.me', 'chacuo.net', 'dispostable.com', 'fake-mail.ml',
                'fakeinbox.com', 'harakirimail.com', 'incognitomail.org', 'jetable.org',
                'koszmail.pl', 'kurzepost.de', 'lroid.com', 'mytrashmail.com', 'no-spam.ws',
                'noclickemail.com', 'nogmailspam.info', 'nomail.xl.cx', 'notmailinator.com',
                'nowmymail.com', 'objectmail.com', 'proxymail.eu', 'rcpt.at', 'safe-mail.net',
                'selfdestructingmail.com', 'sendspamhere.com', 'tempemail.com', 'tempmailaddress.com',
                'tempymail.com', 'thankyou2010.com', 'trash2009.com', 'trashmail.at',
                'trashmail.com', 'trashmail.ws', 'wegwerfmail.de', 'wegwerfmail.net',
                'wegwerfmail.org', 'wh4f.org', 'yuurok.com', 'zehnminutenmail.de'
            ];

            const domain = email.split('@')[1]?.toLowerCase();
            if (disposableEmailDomains.includes(domain)) {
                return { valid: false, message: 'Les adresses email temporaires ne sont pas autorisées' };
            }

            // Vérification des domaines suspects
            const suspiciousDomains = ['test.com', 'example.com', 'fake.com', 'invalid.com'];
            if (suspiciousDomains.includes(domain)) {
                return { valid: false, message: 'Veuillez utiliser une adresse email valide' };
            }

            return { valid: true, message: 'Email valide' };
        }

        async function handleRegister(event) {
            event.preventDefault();
            const firstName = document.getElementById('registerFirstName').value.trim();
            const lastName = document.getElementById('registerLastName').value.trim();
            const username = document.getElementById('registerUsername').value.trim().toLowerCase();
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const sector = document.getElementById('registerSector').value;
            const termsAccepted = document.getElementById('registerTerms').checked;

            // Validations côté client renforcées
            if (!firstName || !lastName || !username || !email || !password || !confirmPassword) {
                showNotification('❌ Tous les champs obligatoires doivent être remplis', 'error');
                return;
            }

            if (!termsAccepted) {
                showNotification('❌ Vous devez accepter les conditions d\'utilisation', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('❌ Les mots de passe ne correspondent pas', 'error');
                return;
            }

            // Validation robuste du mot de passe
            if (password.length < 8) {
                showNotification('❌ Le mot de passe doit contenir au moins 8 caractères', 'error');
                return;
            }

            const passwordStrength = checkPasswordStrength(password);
            if (passwordStrength.score < 2) {
                showNotification(`❌ Mot de passe trop faible: ${passwordStrength.feedback}`, 'error');
                return;
            }

            // Validation avancée de l'email
            const emailValidation = validateEmail(email);
            if (!emailValidation.valid) {
                showNotification(`❌ ${emailValidation.message}`, 'error');
                return;
            }

            // Vérification des noms (pas de chiffres, caractères spéciaux)
            const nameRegex = /^[a-zA-ZÀ-ÿ\s'-]+$/;
            if (!nameRegex.test(firstName) || !nameRegex.test(lastName)) {
                showNotification('❌ Les noms ne peuvent contenir que des lettres, espaces, apostrophes et tirets', 'error');
                return;
            }

            // Validation du nom d'utilisateur
            const usernameRegex = /^[a-zA-Z0-9_-]+$/;
            if (!usernameRegex.test(username) || username.length < 3) {
                showNotification('❌ Le nom d\'utilisateur doit contenir au moins 3 caractères (lettres, chiffres, _ ou -)', 'error');
                return;
            }

            // SIMULATION RÉALISTE: Vérifier si l'utilisateur existe déjà
            const existingUser = users.find(u => u.email.toLowerCase() === email || u.username.toLowerCase() === username);
            if (existingUser) {
                if (existingUser.email.toLowerCase() === email) {
                    showNotification('❌ Cette adresse email est déjà utilisée', 'error');
                } else {
                    showNotification('❌ Ce nom d\'utilisateur est déjà pris', 'error');
                }
                logAction('User Registration Failed', { email: email, username: username, reason: 'Already exists' }, 'warning');
                return;
            }

            // Créer le nouvel utilisateur
            const newUser = {
                email: email,
                password: password, // En production, il faudrait hasher le mot de passe
                username: username,
                role: 'user', // Par défaut
                firstName: firstName,
                lastName: lastName,
                plan: 'Free',
                sector: sector,
                createdAt: new Date(),
                lastLogin: null,
                investigations: 0,
                apiRequests: 0,
                apiRequestsToday: 0,
                dailySearches: 0,
                dataCollected: 0,
                activeAlerts: 0,
                retentionRate: 0,
                costPerRequest: 0.03,
                teamMembers: 1,
                organization: '',
                isActive: true,
                emailVerified: false // En production, il faudrait vérifier l'email
            };

            // Ajouter à la base de données locale
            users.push(newUser);
            
            logAction('User Registration Success', { 
                email: email, 
                username: username,
                firstName: firstName, 
                lastName: lastName,
                sector: sector,
                registrationTime: new Date().toISOString()
            }, 'success');

            showNotification('✅ Inscription réussie ! Vous pouvez maintenant vous connecter.', 'success');
            
            // Pré-remplir le formulaire de connexion
            setTimeout(() => {
                showPage('login');
                document.getElementById('loginEmail').value = email;
                document.getElementById('loginPassword').focus();
            }, 1500);
        }

        // NOUVELLE FONCTION: Vérification de la force du mot de passe
        function checkPasswordStrength(password) {
            let score = 0;
            let feedback = [];

            // Longueur
            if (password.length >= 8) score++;
            else feedback.push('au moins 8 caractères');

            // Majuscules
            if (/[A-Z]/.test(password)) score++;
            else feedback.push('une majuscule');

            // Minuscules
            if (/[a-z]/.test(password)) score++;
            else feedback.push('une minuscule');

            // Chiffres
            if (/\d/.test(password)) score++;
            else feedback.push('un chiffre');

            // Caractères spéciaux
            if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) score++;
            else feedback.push('un caractère spécial');

            return {
                score: score,
                feedback: feedback.length > 0 ? 'Manque: ' + feedback.join(', ') : 'Fort'
            };
        }

        function updateDashboardData() {
            if (currentUser ) {
                document.getElementById('dashboardUserName').textContent = `${currentUser .firstName} ${currentUser .lastName}`;
                // Mettez à jour d'autres éléments du tableau de bord ici
            }
        }

        async function handleProfileUpdate(event) {
            event.preventDefault();
            const fullName = document.getElementById('settingsPageFullName').value;
            const email = document.getElementById('settingsPageEmail').value;

            try {
                const response = await fetch('/api/user/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
                    body: JSON.stringify({ fullName, email })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser.firstName = fullName.split(' ')[0];
                    currentUser.lastName = fullName.split(' ').slice(1).join(' ');
                    currentUser.email = email;
                    showNotification('Profil mis à jour avec succès !', 'success');
                    updateDashboardUser(); // Update dashboard display
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Erreur de mise à jour du profil', 'error');
            }
        }

        async function updateSubscription(plan) {
            try {
                const response = await fetch('/api/subscription/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
                    body: JSON.stringify({ plan })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser.plan = plan; // Mettez à jour le plan de l'utilisateur
                    showNotification('Abonnement mis à jour avec succès !', 'success');
                    updateDashboardUser(); // Update dashboard display
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('Erreur de mise à jour de l\'abonnement', 'error');
            }
        }

        // REMPLACEZ la fonction runTool
        async function runTool(toolType) {
            const target = document.getElementById('toolTarget').value;
            if (!target) {
                showNotification('Veuillez entrer une cible à analyser', 'error');
                return;
            }
            
            const results = document.getElementById('toolResults');
            results.classList.remove('hidden');
            results.innerHTML = '<div class="glass-card p-4"><p>🔄 Analyse en cours...</p></div>';
            
            try {
                const response = await fetch(`/api/tools/${toolType}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` }, // Add Authorization header
                    body: JSON.stringify({ 
                        [toolType === 'domain' ? 'domain' : 
                        toolType === 'email' ? 'email' : 
                        toolType === 'ip' ? 'ip' : 
                        toolType === 'phone' ? 'phoneNumber' : 
                        toolType === 'social' ? 'username' : 'indicator']: target 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // AFFICHER LES VRAIES DONNÉES
                    results.innerHTML = `
                        <div class="glass-card p-4">
                            <h4 class="font-semibold mb-4 text-green-400 cyber-font">
                                <i class="fas fa-check-circle mr-2"></i>
                                Analyse terminée pour: ${target}
                            </h4>
                            <div class="bg-gray-900 p-4 rounded text-sm">
                                <pre>${JSON.stringify(data.data, null, 2)}</pre>
                            </div>
                        </div>
                    `;
                    showNotification('Analyse terminée avec succès !', 'success');
                } else {
                    results.innerHTML = `
                        <div class="glass-card p-4">
                            <h4 class="font-semibold mb-4 text-red-400">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                Erreur
                            </h4>
                            <p>${data.message}</p>
                        </div>
                    `;
                    showNotification(`Erreur lors de l'analyse: ${data.message}`, 'error');
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="glass-card p-4">
                        <h4 class="font-semibold mb-4 text-red-400">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Erreur de connexion
                        </h4>
                        <p>Impossible de contacter le serveur</p>
                    </div>
                `;
                showNotification('Erreur lors de l\'analyse', 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Apply initial settings for background animations
            const matrixEnabled = localStorage.getItem('matrixBgEnabled') !== 'false'; // Default to true
            const gridEnabled = localStorage.getItem('cyberGridEnabled') !== 'false'; // Default to true
            const decoEnabled = localStorage.getItem('cyberDecorationsEnabled') !== 'false'; // Default to true

            if (matrixEnabled) {
                createMatrixEffect();
                document.getElementById('matrixBg').style.display = 'block';
            } else {
                document.getElementById('matrixBg').style.display = 'none';
            }

            document.getElementById('cyberGrid').style.display = gridEnabled ? 'block' : 'none';
            
            const cyberDecos = document.querySelectorAll('[id^="cyberDeco"]');
            cyberDecos.forEach(deco => {
                deco.style.display = decoEnabled ? 'block' : 'none';
            });

            // AMÉLIORATION: Gestion réaliste de la session
            loadUserSession();
            
            // CORRECTION: S'assurer que les liens de navigation de base sont visibles
            setTimeout(() => {
                const homeLink = document.querySelector('.nav-link-enhanced[onclick="showPage(\'home\')"]');
                const toolsLink = document.querySelector('.nav-link-enhanced[onclick="showPage(\'tools\')"]');
                const premiumLink = document.querySelector('.nav-link-enhanced[onclick="showPage(\'premium\')"]');
                
                if (homeLink) homeLink.style.display = 'inline-block';
                if (toolsLink) toolsLink.style.display = 'inline-block';
                if (premiumLink) premiumLink.style.display = 'inline-block';
                
                console.log('Navigation links restored:', {
                    home: homeLink ? 'found' : 'not found',
                    tools: toolsLink ? 'found' : 'not found', 
                    premium: premiumLink ? 'found' : 'not found'
                });
            }, 50);
            
            // NETTOYAGE COMPLET au démarrage pour éviter les bugs
            currentSearchResults = [];
            currentPage = 1;
            
            // Attendre que le DOM soit complètement chargé avant de nettoyer
            setTimeout(() => {
                // Forcer la fermeture de toutes les modals
                const searchModal = document.getElementById('searchResultsModal');
                const toolModal = document.getElementById('toolModal');
                
                if (searchModal) {
                    // S'assurer que la modal est fermée ET qu'elle ne s'ouvre pas
                    searchModal.classList.add('hidden');
                    searchModal.style.display = 'none'; // Force en CSS inline aussi
                    console.log('Modal de recherche fermée au démarrage');
                }
                
                if (toolModal) {
                    toolModal.classList.add('hidden');
                    toolModal.style.display = 'none'; // Force en CSS inline aussi
                }
                
                // Nettoyer complètement les résultats
                const resultsBody = document.getElementById('searchResultsBody');
                if (resultsBody) {
                    resultsBody.innerHTML = '';
                }
                
                // Réinitialiser les variables globales
                currentSearchResults = [];
                currentPage = 1;
                
                // NOUVEAU: Empêcher toute fonction d'ouvrir la modal pendant l'initialisation
                window.isInitializing = true;
                setTimeout(() => {
                    window.isInitializing = false;
                }, 2000); // 2 secondes de protection
                
                console.log('Nettoyage complet effectué au démarrage');
            }, 100);
            
            function loadUserSession() {
                const savedToken = localStorage.getItem('authToken');
                const savedUserEmail = localStorage.getItem('currentUserEmail');
                const rememberMe = localStorage.getItem('rememberMe') === 'true';
                
                // Only restore session if user previously chose 'remember me'
                if (savedToken && savedUserEmail && rememberMe) {
                    // Rechercher l'utilisateur dans la base locale
                    const savedUser = users.find(u => u.email.toLowerCase() === savedUserEmail.toLowerCase());
                    
                    if (savedUser) {
                        // Restaurer la session
                        currentUser = { ...savedUser };
                        authToken = savedToken;
                        
                        // Vérifier si le token n'est pas expiré (simulation: 24h)
                        const tokenAge = Date.now() - parseInt(savedToken.split('-')[2] || '0', 36);
                        const maxAge = 24 * 60 * 60 * 1000; // 24 heures
                        
                        if (tokenAge < maxAge) {
                            updateAuthButton();
                            logAction('Session Restored', { 
                                email: savedUser.email, 
                                role: savedUser.role,
                                tokenAge: Math.round(tokenAge / (60 * 1000)) + ' minutes'
                            }, 'info');
                            showNotification(`👋 Bienvenue de retour ${savedUser.firstName}!`, 'info');
                            
                            // Redirection selon le rôle
                            if (savedUser.role === 'founder' || savedUser.role === 'admin') {
                                showPage('dashboard');
                            } else {
                                showPage('tools');
                            }
                            return;
                        } else {
                            // Token expiré
                            logAction('Session Expired', { email: savedUserEmail }, 'warning');
                            showNotification('⏰ Votre session a expiré, veuillez vous reconnecter', 'warning');
                            clearUserSession();
                        }
                    } else {
                        // Utilisateur non trouvé
                        logAction('Invalid Session', { email: savedUserEmail }, 'warning');
                        clearUserSession();
                    }
                }
                
                // Pas de session valide, aller à l'accueil
                showPage('home');
            }
            
            function clearUserSession() {
                // Clear in-memory state
                currentUser = null;
                authToken = null;

                // Clear persistent session markers
                try {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('currentUserEmail');
                    localStorage.removeItem('rememberMe');
                    // Remove any api key entries for current user placeholder
                    // (we don't know the email here since currentUser is cleared)
                    Object.keys(localStorage).forEach(k => {
                        if (k && k.startsWith('apiKey_')) localStorage.removeItem(k);
                    });
                } catch (e) { console.error('Error clearing localStorage during logout', e); }

                // Update UI: hide profile menus, show login/register, hide quick-logout
                try {
                    const navProfileMenu = document.getElementById('navProfileMenu');
                    if (navProfileMenu) navProfileMenu.classList.add('hidden');
                    const profileMenu = document.getElementById('profileMenu');
                    if (profileMenu) profileMenu.classList.remove('show');
                    const authLogoutBtn = document.getElementById('authLogoutBtn');
                    if (authLogoutBtn) authLogoutBtn.classList.add('hidden');
                    // Reset auth button to login state
                    const authButton = document.getElementById('authButton');
                    if (authButton) authButton.innerHTML = 'Connexion';
                    // Ensure register button visible
                    const registerBtn = document.querySelector('.btn-auth-register');
                    if (registerBtn) registerBtn.style.display = 'inline-block';
                } catch (e) { console.error(e); }

                // Rerender navigation and auth UI
                try { updateAuthButton(); updateNavigationVisibility(); } catch (e) { console.error(e); }
            }

            updateGlobalStats(); // Initial update of global stats

            // Update global stats every 10 seconds
            setInterval(updateGlobalStats, 10000);
            
            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                const notificationsPanel = document.getElementById('notificationsPanel');
                const profileMenu = document.getElementById('profileMenu');
                const toolModal = document.getElementById('toolModal');
                const searchResultsModal = document.getElementById('searchResultsModal');
                
                // Close notifications panel if clicking outside
                if (notificationsPanel && !notificationsPanel.classList.contains('hidden')) {
                    const bellButton = document.querySelector('[onclick="toggleNotifications()"]');
                    if (!notificationsPanel.contains(e.target) && (!bellButton || !bellButton.contains(e.target))) {
                        notificationsPanel.classList.add('hidden');
                    }
                }

                // Close profile menu if clicking outside
                if (profileMenu && profileMenu.classList.contains('show')) {
                    const profileCard = profileMenu.closest('.glass-card');
                    if (!profileCard.contains(e.target) && !e.target.closest('[onclick="toggleProfileMenu()"]')) {
                        profileMenu.classList.remove('show');
                    }
                }
                // Close navbar small profile menu if clicking outside
                const navProfileMenu = document.getElementById('navProfileMenu');
                if (navProfileMenu && !navProfileMenu.classList.contains('hidden')) {
                    const navContainer = navProfileMenu.closest('.nav-profile-container');
                    if (!navContainer.contains(e.target) && !e.target.closest('#authButton')) {
                        navProfileMenu.classList.add('hidden');
                    }
                }

                // Close tool modal if clicking outside
                if (toolModal && !toolModal.classList.contains('hidden')) {
                    const toolCard = toolModal.querySelector('.glass-card');
                    if (!toolCard.contains(e.target) && !e.target.closest('[onclick^="launchTool("]')) {
                        toolModal.classList.add('hidden');
                    }
                }

                // Close search results modal if clicking outside
                if (searchResultsModal && !searchResultsModal.classList.contains('hidden')) {
                    const modalContent = searchResultsModal.querySelector('.glass-card');
                    if (!modalContent.contains(e.target) && !e.target.closest('#homeSearchBarInput') && !e.target.closest('.home-search-bar button')) {
                        closeSearchResultsModal();
                    }
                }
            });

            // Initial logs
            logAction('System Started', { timestamp: new Date().toISOString() }, 'info');
            // Ensure auth button is wired after removing stray listeners
            try { updateAuthButton(); } catch (e) { console.error(e); }
        });

        // Fonctions pour faire fonctionner tous les boutons
        function changePassword() {
            const currentPassword = prompt('Mot de passe actuel:');
            if (!currentPassword) return;

            const newPassword = prompt('Nouveau mot de passe (min. 8 caractères):');
            if (!newPassword || newPassword.length < 8) {
                showNotification('❌ Le nouveau mot de passe doit contenir au moins 8 caractères', 'error');
                return;
            }

            const confirmPassword = prompt('Confirmer le nouveau mot de passe:');
            if (newPassword !== confirmPassword) {
                showNotification('❌ Les mots de passe ne correspondent pas', 'error');
                return;
            }

            // Vérifier le mot de passe actuel
            if (currentUser && currentUser.password === currentPassword) {
                currentUser.password = newPassword;
                showNotification('✅ Mot de passe modifié avec succès!', 'success');
                logAction('Password Changed', { user: currentUser.email }, 'success');
            } else {
                showNotification('❌ Mot de passe actuel incorrect', 'error');
                logAction('Password Change Failed', { user: currentUser ? currentUser.email : 'Unknown', reason: 'Wrong current password' }, 'error');
            }
        }

        function enable2FA() {
            showNotification('🔐 Configuration de l\'authentification 2FA...', 'info');
            
            // Simuler la génération d'un code QR
            setTimeout(() => {
                const qrCode = Math.random().toString(36).substring(2, 15).toUpperCase();
                const backupCodes = Array.from({length: 8}, () => Math.random().toString(36).substring(2, 8).toUpperCase());
                
                alert(`🔐 Authentification 2FA configurée!

Code QR: ${qrCode}

Codes de récupération (à conserver précieusement):
${backupCodes.join('\n')}

Utilisez une application comme Google Authenticator ou Authy pour scanner le code QR.`);
                
                showNotification('✅ Authentification 2FA activée avec succès!', 'success');
                logAction('2FA Enabled', { user: currentUser.email, qrCode: qrCode }, 'success');
            }, 2000);
        }

        function viewLoginHistory() {
            const mockHistory = [
                { date: new Date().toLocaleString(), ip: '192.168.1.100', location: 'Paris, France', device: 'Chrome sur Windows' },
                { date: new Date(Date.now() - 86400000).toLocaleString(), ip: '192.168.1.100', location: 'Paris, France', device: 'Firefox sur Windows' },
                { date: new Date(Date.now() - 172800000).toLocaleString(), ip: '10.0.0.50', location: 'Lyon, France', device: 'Safari sur iPhone' }
            ];

            let historyText = '📊 HISTORIQUE DES CONNEXIONS\n\n';
            mockHistory.forEach((entry, index) => {
                historyText += `${index + 1}. ${entry.date}\n`;
                historyText += `   IP: ${entry.ip}\n`;
                historyText += `   Localisation: ${entry.location}\n`;
                historyText += `   Appareil: ${entry.device}\n\n`;
            });

            alert(historyText);
            logAction('Login History Viewed', { user: currentUser.email }, 'info');
        }

        function deleteAccount() {
            if (!currentUser) return;

            const confirmation1 = confirm('⚠️ ATTENTION: Cette action est irréversible!\n\nÊtes-vous sûr de vouloir supprimer définitivement votre compte?');
            if (!confirmation1) return;

            const confirmation2 = prompt('Pour confirmer la suppression, tapez "SUPPRIMER" en majuscules:');
            if (confirmation2 !== 'SUPPRIMER') {
                showNotification('❌ Suppression annulée', 'info');
                return;
            }

            const passwordConfirm = prompt('Entrez votre mot de passe pour confirmer:');
            if (passwordConfirm !== currentUser.password) {
                showNotification('❌ Mot de passe incorrect', 'error');
                return;
            }

            // Simuler la suppression du compte
            logAction('Account Deletion Requested', { user: currentUser.email }, 'warning');
            
            setTimeout(() => {
                alert('💀 Votre compte a été supprimé définitivement.\n\nToutes vos données ont été effacées de nos serveurs.\n\nNous espérons vous revoir bientôt!');
                
                // Supprimer l'utilisateur de la liste
                const userIndex = users.findIndex(u => u.email === currentUser.email);
                if (userIndex > -1) {
                    users.splice(userIndex, 1);
                }
                
                // Déconnecter l'utilisateur
                logout();
                showNotification('Compte supprimé avec succès', 'warning');
            }, 2000);
        }

        function viewInvoices() {
            const mockInvoices = [
                { id: 'INV-2024-001', date: '2024-01-15', amount: '€49.00', plan: 'Professional', status: 'Payée' },
                { id: 'INV-2023-012', date: '2023-12-15', amount: '€49.00', plan: 'Professional', status: 'Payée' },
                { id: 'INV-2023-011', date: '2023-11-15', amount: '€19.00', plan: 'Starter', status: 'Payée' }
            ];

            let invoiceText = '🧾 HISTORIQUE DES FACTURES\n\n';
            mockInvoices.forEach(invoice => {
                invoiceText += `Facture: ${invoice.id}\n`;
                invoiceText += `Date: ${invoice.date}\n`;
                invoiceText += `Montant: ${invoice.amount}\n`;
                invoiceText += `Plan: ${invoice.plan}\n`;
                invoiceText += `Statut: ${invoice.status}\n\n`;
            });

            alert(invoiceText);
            logAction('Invoices Viewed', { user: currentUser.email }, 'info');
        }

        function managePaymentMethods() {
            const mockMethods = [
                { type: 'PayPal', email: 'user@example.com', status: 'Actif' },
                { type: 'Carte bancaire', last4: '****1234', expiry: '12/25', status: 'Actif' }
            ];

            let methodsText = '💳 MÉTHODES DE PAIEMENT\n\n';
            mockMethods.forEach((method, index) => {
                methodsText += `${index + 1}. ${method.type}\n`;
                if (method.email) methodsText += `   Email: ${method.email}\n`;
                if (method.last4) methodsText += `   Carte: ${method.last4}\n`;
                if (method.expiry) methodsText += `   Expiration: ${method.expiry}\n`;
                methodsText += `   Statut: ${method.status}\n\n`;
            });

            alert(methodsText);
            
            const action = prompt('Actions disponibles:\n1. Ajouter une méthode\n2. Supprimer une méthode\n3. Modifier une méthode\n\nEntrez le numéro de l\'action:');
            
            switch(action) {
                case '1':
                    showNotification('🔄 Redirection vers l\'ajout de méthode de paiement...', 'info');
                    break;
                case '2':
                    showNotification('🗑️ Suppression de méthode de paiement...', 'warning');
                    break;
                case '3':
                    showNotification('✏️ Modification de méthode de paiement...', 'info');
                    break;
                default:
                    showNotification('Action annulée', 'info');
            }
            
            logAction('Payment Methods Managed', { user: currentUser.email, action: action }, 'info');
        }
    </script>

    <script>
    // Extra guard: ensure clicking the auth button only toggles the profile menu when logged in
    (function() {
        document.addEventListener('click', function captureAuthClick(e) {
            const authBtn = document.getElementById('authButton');
            if (!authBtn) return;
            if (e.target === authBtn || authBtn.contains(e.target)) {
                if (window.currentUser) {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    try { toggleProfileMenu(); } catch (err) { console.error(err); }
                }
            }
        }, true); // capture phase
    })();
    </script>
<!-- ...existing code... -->

    <!-- Added: center navbar styles and plan-guarding script -->
    <style>
        /* Center the navbar links when there is no logged user while keeping logo and auth buttons visible */
        .new-navbar.center-links .max-w-7xl {
            position: relative;
            /* keep spacing for left/right items */
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
        /* Absolutely center the middle div (links) so it visually sits in the center */
        .new-navbar.center-links .max-w-7xl > div:nth-child(2) {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            pointer-events: auto;
            z-index: 30; /* ensure links sit above other content */
        }
        /* Ensure left (logo) and right (auth) groups remain visible */
        .new-navbar.center-links .max-w-7xl > div:first-child,
        .new-navbar.center-links .max-w-7xl > div:last-child {
            display: flex !important;
            align-items: center;
            gap: 0.5rem;
        }
        /* Small responsive tweak: on very small screens, fallback to stacked layout */
        @media (max-width: 640px) {
            .new-navbar.center-links .max-w-7xl > div:nth-child(2) {
                position: static;
                transform: none;
                justify-content: center;
                width: 100%;
                padding: 6px 0;
            }
        }
    </style>

    <script>
    // Helper: vérifie si l'utilisateur a un plan actif (non "free")
    function userHasActivePlan() {
        return !!(window.currentUser && window.currentUser.plan && window.currentUser.plan.toLowerCase() !== 'free');
    }

    // Ensure navbar centering toggles after existing navigation update function runs
    try {
        if (typeof updateNavigationVisibility === 'function') {
            const _origUpdateNav = updateNavigationVisibility;
            window.updateNavigationVisibility = function(...args) {
                try { _origUpdateNav.apply(this, args); } catch (e) { console.error(e); }
                const navbar = document.querySelector('.new-navbar');
                if (!window.currentUser) navbar?.classList.add('center-links');
                else navbar?.classList.remove('center-links');
            };
        }
    } catch (e) {
        console.error('updateNavigationVisibility patch failed:', e);
    }

    // Fallback: ensure correct navbar state on load
    document.addEventListener('DOMContentLoaded', () => {
        const navbar = document.querySelector('.new-navbar');
        if (!window.currentUser) navbar?.classList.add('center-links');
        else navbar?.classList.remove('center-links');
    });

    // Monkey-patch core actions to require an active plan
    ['quickSearchHome', 'quickSearch', 'runTool'].forEach(fnName => {
        try {
            const orig = window[fnName];
            if (typeof orig === 'function') {
                window[fnName] = async function(...args) {
                    // Use centralized currentUser detection
                    const user = (typeof currentUser !== 'undefined' && currentUser) ? currentUser : (window.currentUser || null);
                    if (!user) {
                        showNotification('🔒 Veuillez vous connecter pour effectuer cette action.', 'error');
                        notifications.unshift({ title: 'Action requise', message: 'Connectez-vous pour utiliser cette fonctionnalité.', timestamp: Date.now(), type: 'warning' });
                        showPage('login');
                        return;
                    }
                    // If logged in but no plan (or free), redirect to premium
                    const plan = (user.plan || 'free').toLowerCase();
                    if (!user.plan || plan === 'free') {
                        showNotification("🚫 Votre compte n'a pas de plan actif. Pour utiliser cette fonction, veuillez souscrire à un abonnement.", 'error');
                        notifications.unshift({ title: 'Plan requis', message: 'Souscrivez pour accéder à cette fonctionnalité.', timestamp: Date.now(), type: 'warning' });
                        showPage('premium');
                        return;
                    }
                    return orig.apply(this, args);
                };
            }
        } catch (e) {
            console.error(`patch for ${fnName} failed:`, e);
        }
    });
    </script>

</body>
</html>
